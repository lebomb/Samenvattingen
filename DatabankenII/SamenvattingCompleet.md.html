<!DOCTYPE html><html><head><meta charset="utf-8"><title>SamenvattingCompleet.md</title><style>@import 'https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.2.0/katex.min.css';code{color:#c7254e;background-color:#f9f2f4;border-radius:4px}code,kbd{padding:2px 4px}kbd{color:#fff;background-color:#333;border-radius:3px;box-shadow:inset 0 -1px 0 rgba(0,0,0,.25)}kbd kbd{padding:0;font-size:100%;box-shadow:none}pre{display:block;margin:0 0 10px;word-break:break-all;word-wrap:break-word;color:#333;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px}pre code{padding:0;font-size:inherit;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0}.pre-scrollable{max-height:340px;overflow-y:scroll}table{background-color:transparent}th{text-align:left}.table{width:100%;max-width:100%;margin-bottom:20px}.table>thead>tr>th{padding:8px;line-height:1.4285714;border-top:1px solid #ddd}.table>thead>tr>td,.table>tbody>tr>th,.table>tbody>tr>td,.table>tfoot>tr>th,.table>tfoot>tr>td{padding:8px;line-height:1.4285714;vertical-align:top;border-top:1px solid #ddd}.table>thead>tr>th{vertical-align:bottom;border-bottom:2px solid #ddd}.table>caption+thead>tr:first-child>th,.table>caption+thead>tr:first-child>td,.table>colgroup+thead>tr:first-child>th,.table>colgroup+thead>tr:first-child>td,.table>thead:first-child>tr:first-child>th,.table>thead:first-child>tr:first-child>td{border-top:0}.table>tbody+tbody{border-top:2px solid #ddd}.table .table{background-color:#fff}.table-condensed>thead>tr>th,.table-condensed>thead>tr>td,.table-condensed>tbody>tr>th,.table-condensed>tbody>tr>td,.table-condensed>tfoot>tr>th,.table-condensed>tfoot>tr>td{padding:5px}.table-bordered,.table-bordered>thead>tr>th,.table-bordered>thead>tr>td,.table-bordered>tbody>tr>th,.table-bordered>tbody>tr>td,.table-bordered>tfoot>tr>th,.table-bordered>tfoot>tr>td{border:1px solid #ddd}.table-bordered>thead>tr>th,.table-bordered>thead>tr>td{border-bottom-width:2px}.table-striped>tbody>tr:nth-child(odd)>td,.table-striped>tbody>tr:nth-child(odd)>th{background-color:#f9f9f9}.table-hover>tbody>tr:hover>td,.table-hover>tbody>tr:hover>th{background-color:#f5f5f5}table col[class*="col-"]{position:static;float:none;display:table-column}table td[class*="col-"],table th[class*="col-"]{position:static;float:none;display:table-cell}.table>thead>tr>td.active,.table>thead>tr>th.active,.table>thead>tr.active>td,.table>thead>tr.active>th,.table>tbody>tr>td.active,.table>tbody>tr>th.active,.table>tbody>tr.active>td,.table>tbody>tr.active>th,.table>tfoot>tr>td.active,.table>tfoot>tr>th.active,.table>tfoot>tr.active>td,.table>tfoot>tr.active>th{background-color:#f5f5f5}.table-hover>tbody>tr>td.active:hover,.table-hover>tbody>tr>th.active:hover,.table-hover>tbody>tr.active:hover>td,.table-hover>tbody>tr:hover>.active,.table-hover>tbody>tr.active:hover>th{background-color:#e8e8e8}.table>thead>tr>td.success,.table>thead>tr>th.success,.table>thead>tr.success>td,.table>thead>tr.success>th,.table>tbody>tr>td.success,.table>tbody>tr>th.success,.table>tbody>tr.success>td,.table>tbody>tr.success>th,.table>tfoot>tr>td.success,.table>tfoot>tr>th.success,.table>tfoot>tr.success>td,.table>tfoot>tr.success>th{background-color:#dff0d8}.table-hover>tbody>tr>td.success:hover,.table-hover>tbody>tr>th.success:hover,.table-hover>tbody>tr.success:hover>td,.table-hover>tbody>tr:hover>.success,.table-hover>tbody>tr.success:hover>th{background-color:#d0e9c6}.table>thead>tr>td.info,.table>thead>tr>th.info,.table>thead>tr.info>td,.table>thead>tr.info>th,.table>tbody>tr>td.info,.table>tbody>tr>th.info,.table>tbody>tr.info>td,.table>tbody>tr.info>th,.table>tfoot>tr>td.info,.table>tfoot>tr>th.info,.table>tfoot>tr.info>td,.table>tfoot>tr.info>th{background-color:#d9edf7}.table-hover>tbody>tr>td.info:hover,.table-hover>tbody>tr>th.info:hover,.table-hover>tbody>tr.info:hover>td,.table-hover>tbody>tr:hover>.info,.table-hover>tbody>tr.info:hover>th{background-color:#c4e3f3}.table>thead>tr>td.warning,.table>thead>tr>th.warning,.table>thead>tr.warning>td,.table>thead>tr.warning>th,.table>tbody>tr>td.warning,.table>tbody>tr>th.warning,.table>tbody>tr.warning>td,.table>tbody>tr.warning>th,.table>tfoot>tr>td.warning,.table>tfoot>tr>th.warning,.table>tfoot>tr.warning>td,.table>tfoot>tr.warning>th{background-color:#fcf8e3}.table-hover>tbody>tr>td.warning:hover,.table-hover>tbody>tr>th.warning:hover,.table-hover>tbody>tr.warning:hover>td,.table-hover>tbody>tr:hover>.warning,.table-hover>tbody>tr.warning:hover>th{background-color:#faf2cc}.table>thead>tr>td.danger,.table>thead>tr>th.danger,.table>thead>tr.danger>td,.table>thead>tr.danger>th,.table>tbody>tr>td.danger,.table>tbody>tr>th.danger,.table>tbody>tr.danger>td,.table>tbody>tr.danger>th,.table>tfoot>tr>td.danger,.table>tfoot>tr>th.danger,.table>tfoot>tr.danger>td,.table>tfoot>tr.danger>th{background-color:#f2dede}.table-hover>tbody>tr>td.danger:hover,.table-hover>tbody>tr>th.danger:hover,.table-hover>tbody>tr.danger:hover>td,.table-hover>tbody>tr:hover>.danger,.table-hover>tbody>tr.danger:hover>th{background-color:#ebcccc}fieldset{border:0;min-width:0}legend{display:block;width:100%;margin-bottom:20px;font-size:21px;line-height:inherit;color:#333;border-bottom:1px solid #e5e5e5}label{display:inline-block;max-width:100%;margin-bottom:5px;font-weight:700}input[type="radio"],input[type="checkbox"]{margin:4px 0 0;margin-top:1px \9;line-height:normal}input[type="file"]{display:block}input[type="range"]{display:block;width:100%}select[multiple],select[size]{height:auto}input[type="file"]:focus,input[type="radio"]:focus,input[type="checkbox"]:focus{outline:thin dotted;outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}output{padding-top:7px}output,.form-control{display:block;font-size:14px;line-height:1.4285714;color:#555}.form-control{width:100%;height:34px;padding:6px 12px;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:4px;box-shadow:inset 0 1px 1px rgba(0,0,0,.075);-webkit-transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s;transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}.form-control:focus{border-color:#66afe9;outline:0;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6)}.form-control::-moz-placeholder{color:#777;opacity:1}.form-control:-ms-input-placeholder{color:#777}.form-control::-webkit-input-placeholder{color:#777}.form-control[disabled],.form-control[readonly],fieldset[disabled] .form-control{cursor:not-allowed;background-color:#eee;opacity:1}textarea.form-control{height:auto}input[type="date"],input[type="time"],input[type="datetime-local"],input[type="month"]{line-height:34px;line-height:1.4285714 \0}input[type="date"].input-sm,.form-horizontal .form-group-sm input[type="date"].form-control,.input-group-sm>input[type="date"].form-control,.input-group-sm>input[type="date"].input-group-addon,.input-group-sm>.input-group-btn>input[type="date"].btn,input[type="time"].input-sm,.form-horizontal .form-group-sm input[type="time"].form-control,.input-group-sm>input[type="time"].form-control,.input-group-sm>input[type="time"].input-group-addon,.input-group-sm>.input-group-btn>input[type="time"].btn,input[type="datetime-local"].input-sm,.form-horizontal .form-group-sm input[type="datetime-local"].form-control,.input-group-sm>input[type="datetime-local"].form-control,.input-group-sm>input[type="datetime-local"].input-group-addon,.input-group-sm>.input-group-btn>input[type="datetime-local"].btn,input[type="month"].input-sm,.form-horizontal .form-group-sm input[type="month"].form-control,.input-group-sm>input[type="month"].form-control,.input-group-sm>input[type="month"].input-group-addon,.input-group-sm>.input-group-btn>input[type="month"].btn{line-height:30px}input[type="date"].input-lg,.form-horizontal .form-group-lg input[type="date"].form-control,.input-group-lg>input[type="date"].form-control,.input-group-lg>input[type="date"].input-group-addon,.input-group-lg>.input-group-btn>input[type="date"].btn,input[type="time"].input-lg,.form-horizontal .form-group-lg input[type="time"].form-control,.input-group-lg>input[type="time"].form-control,.input-group-lg>input[type="time"].input-group-addon,.input-group-lg>.input-group-btn>input[type="time"].btn,input[type="datetime-local"].input-lg,.form-horizontal .form-group-lg input[type="datetime-local"].form-control,.input-group-lg>input[type="datetime-local"].form-control,.input-group-lg>input[type="datetime-local"].input-group-addon,.input-group-lg>.input-group-btn>input[type="datetime-local"].btn,input[type="month"].input-lg,.form-horizontal .form-group-lg input[type="month"].form-control,.input-group-lg>input[type="month"].form-control,.input-group-lg>input[type="month"].input-group-addon,.input-group-lg>.input-group-btn>input[type="month"].btn{line-height:46px}.form-group{margin-bottom:15px}.radio,.checkbox{position:relative;display:block;min-height:20px;margin-top:10px;margin-bottom:10px}.radio label,.checkbox label{padding-left:20px;margin-bottom:0;font-weight:400;cursor:pointer}.radio input[type="radio"],.radio-inline input[type="radio"],.checkbox input[type="checkbox"],.checkbox-inline input[type="checkbox"]{position:absolute;margin-left:-20px;margin-top:4px \9}.radio+.radio,.checkbox+.checkbox{margin-top:-5px}.radio-inline,.checkbox-inline{display:inline-block;padding-left:20px;margin-bottom:0;vertical-align:middle;font-weight:400;cursor:pointer}.radio-inline+.radio-inline,.checkbox-inline+.checkbox-inline{margin-top:0;margin-left:10px}input[type="radio"][disabled],input[type="radio"].disabled,fieldset[disabled] input[type="radio"],input[type="checkbox"][disabled],input[type="checkbox"].disabled,fieldset[disabled] input[type="checkbox"],.radio-inline.disabled,fieldset[disabled] .radio-inline,.checkbox-inline.disabled,fieldset[disabled] .checkbox-inline,.radio.disabled label,fieldset[disabled] .radio label,.checkbox.disabled label,fieldset[disabled] .checkbox label{cursor:not-allowed}.form-control-static{padding-top:7px;padding-bottom:7px;margin-bottom:0}.form-control-static.input-lg,.form-horizontal .form-group-lg .form-control-static.form-control,.input-group-lg>.form-control-static.form-control,.input-group-lg>.form-control-static.input-group-addon,.input-group-lg>.input-group-btn>.form-control-static.btn,.form-control-static.input-sm,.form-horizontal .form-group-sm .form-control-static.form-control,.input-group-sm>.form-control-static.form-control,.input-group-sm>.form-control-static.input-group-addon,.input-group-sm>.input-group-btn>.form-control-static.btn{padding-left:0;padding-right:0}.input-sm,.form-horizontal .form-group-sm .form-control,.input-group-sm>.form-control{height:30px;padding:5px 10px;font-size:12px;line-height:1.5;border-radius:3px}.input-group-sm>.input-group-addon{height:30px;line-height:1.5}.input-group-sm>.input-group-btn>.btn{height:30px;padding:5px 10px;font-size:12px;line-height:1.5;border-radius:3px}select.input-sm,.form-horizontal .form-group-sm select.form-control,.input-group-sm>select.form-control,.input-group-sm>select.input-group-addon,.input-group-sm>.input-group-btn>select.btn{height:30px;line-height:30px}textarea.input-sm,.form-horizontal .form-group-sm textarea.form-control,.input-group-sm>textarea.form-control,.input-group-sm>textarea.input-group-addon,.input-group-sm>.input-group-btn>textarea.btn,select[multiple].input-sm,.form-horizontal .form-group-sm select[multiple].form-control,.input-group-sm>select[multiple].form-control,.input-group-sm>select[multiple].input-group-addon,.input-group-sm>.input-group-btn>select[multiple].btn{height:auto}.input-lg,.form-horizontal .form-group-lg .form-control,.input-group-lg>.form-control{height:46px;padding:10px 16px;font-size:18px;line-height:1.33;border-radius:6px}.input-group-lg>.input-group-addon{height:46px;line-height:1.33}.input-group-lg>.input-group-btn>.btn{height:46px;padding:10px 16px;font-size:18px;line-height:1.33;border-radius:6px}select.input-lg,.form-horizontal .form-group-lg select.form-control,.input-group-lg>select.form-control,.input-group-lg>select.input-group-addon,.input-group-lg>.input-group-btn>select.btn{height:46px;line-height:46px}textarea.input-lg,.form-horizontal .form-group-lg textarea.form-control,.input-group-lg>textarea.form-control,.input-group-lg>textarea.input-group-addon,.input-group-lg>.input-group-btn>textarea.btn,select[multiple].input-lg,.form-horizontal .form-group-lg select[multiple].form-control,.input-group-lg>select[multiple].form-control,.input-group-lg>select[multiple].input-group-addon,.input-group-lg>.input-group-btn>select[multiple].btn{height:auto}.has-feedback{position:relative}.has-feedback .form-control{padding-right:42.5px}.form-control-feedback{position:absolute;top:25px;right:0;z-index:2;display:block;width:34px;height:34px;line-height:34px;text-align:center}.input-lg+.form-control-feedback,.form-horizontal .form-group-lg .form-control+.form-control-feedback,.input-group-lg>.form-control+.form-control-feedback,.input-group-lg>.input-group-addon+.form-control-feedback,.input-group-lg>.input-group-btn>.btn+.form-control-feedback{width:46px;height:46px;line-height:46px}.input-sm+.form-control-feedback,.form-horizontal .form-group-sm .form-control+.form-control-feedback,.input-group-sm>.form-control+.form-control-feedback,.input-group-sm>.input-group-addon+.form-control-feedback,.input-group-sm>.input-group-btn>.btn+.form-control-feedback{width:30px;height:30px;line-height:30px}.has-success .help-block,.has-success .control-label,.has-success .radio,.has-success .checkbox,.has-success .radio-inline,.has-success .checkbox-inline{color:#3c763d}.has-success .form-control{border-color:#3c763d;box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}.has-success .form-control:focus{border-color:#2b542c;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #67b168}.has-success .input-group-addon{color:#3c763d;border-color:#3c763d;background-color:#dff0d8}.has-success .form-control-feedback{color:#3c763d}.has-warning .help-block,.has-warning .control-label,.has-warning .radio,.has-warning .checkbox,.has-warning .radio-inline,.has-warning .checkbox-inline{color:#8a6d3b}.has-warning .form-control{border-color:#8a6d3b;box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}.has-warning .form-control:focus{border-color:#66512c;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #c0a16b}.has-warning .input-group-addon{color:#8a6d3b;border-color:#8a6d3b;background-color:#fcf8e3}.has-warning .form-control-feedback{color:#8a6d3b}.has-error .help-block,.has-error .control-label,.has-error .radio,.has-error .checkbox,.has-error .radio-inline,.has-error .checkbox-inline{color:#a94442}.has-error .form-control{border-color:#a94442;box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}.has-error .form-control:focus{border-color:#843534;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #ce8483}.has-error .input-group-addon{color:#a94442;border-color:#a94442;background-color:#f2dede}.has-error .form-control-feedback{color:#a94442}.has-feedback label.sr-only~.form-control-feedback{top:0}.help-block{display:block;margin-top:5px;margin-bottom:10px;color:#737373}.form-horizontal .radio,.form-horizontal .checkbox,.form-horizontal .radio-inline,.form-horizontal .checkbox-inline{margin-top:0;margin-bottom:0;padding-top:7px}.form-horizontal .radio,.form-horizontal .checkbox{min-height:27px}.form-horizontal .form-group{margin-left:-15px;margin-right:-15px}.form-horizontal .form-group:before{content:" ";display:table}.form-horizontal .form-group:after{content:" ";display:table;clear:both}.form-horizontal .has-feedback .form-control-feedback{top:0;right:15px}.btn{display:inline-block;vertical-align:middle;cursor:pointer;background-image:none;border:1px solid transparent;white-space:nowrap;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.btn:focus,.btn:active:focus,.btn.active:focus{outline:thin dotted;outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}.btn:hover,.btn:focus{color:#333;text-decoration:none}.btn:active,.btn.active{outline:0;background-image:none;box-shadow:inset 0 3px 5px rgba(0,0,0,.125)}.btn.disabled,.btn[disabled],fieldset[disabled] .btn{cursor:not-allowed;pointer-events:none;opacity:.65;filter:alpha(opacity=65);box-shadow:none}.btn-default{color:#333;background-color:#fff;border-color:#ccc}.btn-default:hover,.btn-default:focus,.btn-default:active,.btn-default.active,.open>.btn-default.dropdown-toggle{color:#333;background-color:#e6e6e6;border-color:#adadad}.btn-default:active,.btn-default.active,.open>.btn-default.dropdown-toggle{background-image:none}.btn-default.disabled,.btn-default.disabled:hover,.btn-default.disabled:focus,.btn-default.disabled:active,.btn-default.disabled.active,.btn-default[disabled],.btn-default[disabled]:hover,.btn-default[disabled]:focus,.btn-default[disabled]:active,.btn-default[disabled].active,fieldset[disabled] .btn-default,fieldset[disabled] .btn-default:hover,fieldset[disabled] .btn-default:focus,fieldset[disabled] .btn-default:active,fieldset[disabled] .btn-default.active{background-color:#fff;border-color:#ccc}.btn-default .badge{color:#fff;background-color:#333}.btn-primary{color:#fff;background-color:#428bca;border-color:#357ebd}.btn-primary:hover,.btn-primary:focus,.btn-primary:active,.btn-primary.active,.open>.btn-primary.dropdown-toggle{color:#fff;background-color:#3071a9;border-color:#285e8e}.btn-primary:active,.btn-primary.active,.open>.btn-primary.dropdown-toggle{background-image:none}.btn-primary.disabled,.btn-primary.disabled:hover,.btn-primary.disabled:focus,.btn-primary.disabled:active,.btn-primary.disabled.active,.btn-primary[disabled],.btn-primary[disabled]:hover,.btn-primary[disabled]:focus,.btn-primary[disabled]:active,.btn-primary[disabled].active,fieldset[disabled] .btn-primary,fieldset[disabled] .btn-primary:hover,fieldset[disabled] .btn-primary:focus,fieldset[disabled] .btn-primary:active,fieldset[disabled] .btn-primary.active{background-color:#428bca;border-color:#357ebd}.btn-primary .badge{color:#428bca;background-color:#fff}.btn-success{color:#fff;background-color:#5cb85c;border-color:#4cae4c}.btn-success:hover,.btn-success:focus,.btn-success:active,.btn-success.active,.open>.btn-success.dropdown-toggle{color:#fff;background-color:#449d44;border-color:#398439}.btn-success:active,.btn-success.active,.open>.btn-success.dropdown-toggle{background-image:none}.btn-success.disabled,.btn-success.disabled:hover,.btn-success.disabled:focus,.btn-success.disabled:active,.btn-success.disabled.active,.btn-success[disabled],.btn-success[disabled]:hover,.btn-success[disabled]:focus,.btn-success[disabled]:active,.btn-success[disabled].active,fieldset[disabled] .btn-success,fieldset[disabled] .btn-success:hover,fieldset[disabled] .btn-success:focus,fieldset[disabled] .btn-success:active,fieldset[disabled] .btn-success.active{background-color:#5cb85c;border-color:#4cae4c}.btn-success .badge{color:#5cb85c;background-color:#fff}.btn-info{color:#fff;background-color:#5bc0de;border-color:#46b8da}.btn-info:hover,.btn-info:focus,.btn-info:active,.btn-info.active,.open>.btn-info.dropdown-toggle{color:#fff;background-color:#31b0d5;border-color:#269abc}.btn-info:active,.btn-info.active,.open>.btn-info.dropdown-toggle{background-image:none}.btn-info.disabled,.btn-info.disabled:hover,.btn-info.disabled:focus,.btn-info.disabled:active,.btn-info.disabled.active,.btn-info[disabled],.btn-info[disabled]:hover,.btn-info[disabled]:focus,.btn-info[disabled]:active,.btn-info[disabled].active,fieldset[disabled] .btn-info,fieldset[disabled] .btn-info:hover,fieldset[disabled] .btn-info:focus,fieldset[disabled] .btn-info:active,fieldset[disabled] .btn-info.active{background-color:#5bc0de;border-color:#46b8da}.btn-info .badge{color:#5bc0de;background-color:#fff}.btn-warning{color:#fff;background-color:#f0ad4e;border-color:#eea236}.btn-warning:hover,.btn-warning:focus,.btn-warning:active,.btn-warning.active,.open>.btn-warning.dropdown-toggle{color:#fff;background-color:#ec971f;border-color:#d58512}.btn-warning:active,.btn-warning.active,.open>.btn-warning.dropdown-toggle{background-image:none}.btn-warning.disabled,.btn-warning.disabled:hover,.btn-warning.disabled:focus,.btn-warning.disabled:active,.btn-warning.disabled.active,.btn-warning[disabled],.btn-warning[disabled]:hover,.btn-warning[disabled]:focus,.btn-warning[disabled]:active,.btn-warning[disabled].active,fieldset[disabled] .btn-warning,fieldset[disabled] .btn-warning:hover,fieldset[disabled] .btn-warning:focus,fieldset[disabled] .btn-warning:active,fieldset[disabled] .btn-warning.active{background-color:#f0ad4e;border-color:#eea236}.btn-warning .badge{color:#f0ad4e;background-color:#fff}.btn-danger{color:#fff;background-color:#d9534f;border-color:#d43f3a}.btn-danger:hover,.btn-danger:focus,.btn-danger:active,.btn-danger.active,.open>.btn-danger.dropdown-toggle{color:#fff;background-color:#c9302c;border-color:#ac2925}.btn-danger:active,.btn-danger.active,.open>.btn-danger.dropdown-toggle{background-image:none}.btn-danger.disabled,.btn-danger.disabled:hover,.btn-danger.disabled:focus,.btn-danger.disabled:active,.btn-danger.disabled.active,.btn-danger[disabled],.btn-danger[disabled]:hover,.btn-danger[disabled]:focus,.btn-danger[disabled]:active,.btn-danger[disabled].active,fieldset[disabled] .btn-danger,fieldset[disabled] .btn-danger:hover,fieldset[disabled] .btn-danger:focus,fieldset[disabled] .btn-danger:active,fieldset[disabled] .btn-danger.active{background-color:#d9534f;border-color:#d43f3a}.btn-danger .badge{color:#d9534f;background-color:#fff}.btn-link{color:#428bca;font-weight:400;cursor:pointer;border-radius:0}.btn-link,.btn-link:active,.btn-link[disabled],fieldset[disabled] .btn-link{background-color:transparent;box-shadow:none}.btn-link,.btn-link:hover,.btn-link:focus,.btn-link:active{border-color:transparent}.btn-link:hover,.btn-link:focus{color:#2a6496;text-decoration:underline;background-color:transparent}.btn-link[disabled]:hover,.btn-link[disabled]:focus,fieldset[disabled] .btn-link:hover,fieldset[disabled] .btn-link:focus{color:#777;text-decoration:none}.btn-lg{padding:10px 16px;font-size:18px;line-height:1.33;border-radius:6px}.btn-sm{padding:5px 10px}.btn-sm,.btn-xs{font-size:12px;line-height:1.5;border-radius:3px}.btn-xs{padding:1px 5px}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:5px}input[type="submit"].btn-block,input[type="reset"].btn-block,input[type="button"].btn-block{width:100%}.fade{opacity:0;-webkit-transition:opacity .15s linear;transition:opacity .15s linear}.fade.in{opacity:1}.collapse{display:none}.collapse.in{display:block}tr.collapse.in{display:table-row}tbody.collapse.in{display:table-row-group}.collapsing{position:relative;height:0;overflow:hidden;-webkit-transition:height .35s ease;transition:height .35s ease}.input-group{position:relative;display:table;border-collapse:separate}.input-group[class*="col-"]{float:none;padding-left:0;padding-right:0}.input-group .form-control{position:relative;z-index:2;float:left;width:100%;margin-bottom:0}.input-group-addon,.input-group-btn,.input-group .form-control{display:table-cell}.input-group-addon:not(:first-child):not(:last-child),.input-group-btn:not(:first-child):not(:last-child),.input-group .form-control:not(:first-child):not(:last-child){border-radius:0}.input-group-addon{white-space:nowrap}.input-group-addon,.input-group-btn{width:1%;vertical-align:middle}.input-group-addon{padding:6px 12px;font-size:14px;font-weight:400;line-height:1;color:#555;text-align:center;background-color:#eee;border:1px solid #ccc;border-radius:4px}.input-group-addon.input-sm,.form-horizontal .form-group-sm .input-group-addon.form-control,.input-group-sm>.input-group-addon,.input-group-sm>.input-group-btn>.input-group-addon.btn{padding:5px 10px;font-size:12px;border-radius:3px}.input-group-addon.input-lg,.form-horizontal .form-group-lg .input-group-addon.form-control,.input-group-lg>.input-group-addon,.input-group-lg>.input-group-btn>.input-group-addon.btn{padding:10px 16px;font-size:18px;border-radius:6px}.input-group-addon input[type="radio"],.input-group-addon input[type="checkbox"]{margin-top:0}.input-group .form-control:first-child,.input-group-addon:first-child,.input-group-btn:first-child>.btn,.input-group-btn:first-child>.btn-group>.btn,.input-group-btn:first-child>.dropdown-toggle,.input-group-btn:last-child>.btn:not(:last-child):not(.dropdown-toggle),.input-group-btn:last-child>.btn-group:not(:last-child)>.btn{border-bottom-right-radius:0;border-top-right-radius:0}.input-group-addon:first-child{border-right:0}.input-group .form-control:last-child,.input-group-addon:last-child,.input-group-btn:last-child>.btn,.input-group-btn:last-child>.btn-group>.btn,.input-group-btn:last-child>.dropdown-toggle,.input-group-btn:first-child>.btn:not(:first-child),.input-group-btn:first-child>.btn-group:not(:first-child)>.btn{border-bottom-left-radius:0;border-top-left-radius:0}.input-group-addon:last-child{border-left:0}.input-group-btn{font-size:0;white-space:nowrap}.input-group-btn,.input-group-btn>.btn{position:relative}.input-group-btn>.btn+.btn{margin-left:-1px}.input-group-btn>.btn:hover,.input-group-btn>.btn:focus,.input-group-btn>.btn:active{z-index:2}.input-group-btn:first-child>.btn,.input-group-btn:first-child>.btn-group{margin-right:-1px}.input-group-btn:last-child>.btn,.input-group-btn:last-child>.btn-group{margin-left:-1px}.pagination{display:inline-block;padding-left:0;margin:20px 0;border-radius:4px}.pagination>li{display:inline}.pagination>li>a,.pagination>li>span{position:relative;float:left;padding:6px 12px;line-height:1.4285714;text-decoration:none;color:#428bca;background-color:#fff;border:1px solid #ddd;margin-left:-1px}.pagination>li:first-child>a,.pagination>li:first-child>span{margin-left:0;border-bottom-left-radius:4px;border-top-left-radius:4px}.pagination>li:last-child>a,.pagination>li:last-child>span{border-bottom-right-radius:4px;border-top-right-radius:4px}.pagination>li>a:hover,.pagination>li>a:focus,.pagination>li>span:hover,.pagination>li>span:focus{color:#2a6496;background-color:#eee;border-color:#ddd}.pagination>.active>a,.pagination>.active>a:hover,.pagination>.active>a:focus,.pagination>.active>span,.pagination>.active>span:hover,.pagination>.active>span:focus{z-index:2;color:#fff;background-color:#428bca;border-color:#428bca;cursor:default}.pagination>.disabled>span,.pagination>.disabled>span:hover,.pagination>.disabled>span:focus,.pagination>.disabled>a,.pagination>.disabled>a:hover,.pagination>.disabled>a:focus{color:#777;background-color:#fff;border-color:#ddd;cursor:not-allowed}.pagination-lg>li>a,.pagination-lg>li>span{padding:10px 16px;font-size:18px}.pagination-lg>li:first-child>a,.pagination-lg>li:first-child>span{border-bottom-left-radius:6px;border-top-left-radius:6px}.pagination-lg>li:last-child>a,.pagination-lg>li:last-child>span{border-bottom-right-radius:6px;border-top-right-radius:6px}.pagination-sm>li>a,.pagination-sm>li>span{padding:5px 10px;font-size:12px}.pagination-sm>li:first-child>a,.pagination-sm>li:first-child>span{border-bottom-left-radius:3px;border-top-left-radius:3px}.pagination-sm>li:last-child>a,.pagination-sm>li:last-child>span{border-bottom-right-radius:3px;border-top-right-radius:3px}.close{float:right;font-size:21px;font-weight:700;line-height:1;color:#000;text-shadow:0 1px 0 #fff;opacity:.2;filter:alpha(opacity=20)}.close:hover,.close:focus{color:#000;text-decoration:none;cursor:pointer;opacity:.5;filter:alpha(opacity=50)}button.close{padding:0;cursor:pointer;background:0 0;border:0;-webkit-appearance:none}.modal-open,.modal{overflow:hidden}.modal{display:none;position:fixed;top:0;right:0;bottom:0;left:0;z-index:1050;-webkit-overflow-scrolling:touch;outline:0}.modal.fade .modal-dialog{-webkit-transform:translate3d(0,-25%,0);transform:translate3d(0,-25%,0);-webkit-transition:-webkit-transform .3s ease-out;transition:transform .3s ease-out;transition:transform .3s ease-out,-webkit-transform .3s ease-out}.modal.in .modal-dialog{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}.modal-open .modal{overflow-x:hidden;overflow-y:auto}.modal-dialog{position:relative;width:auto;margin:10px}.modal-content{position:relative;background-color:#fff;border:1px solid #999;border:1px solid rgba(0,0,0,.2);border-radius:6px;box-shadow:0 3px 9px rgba(0,0,0,.5);background-clip:padding-box;outline:0}.modal-backdrop{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1040;background-color:#000}.modal-backdrop.fade{opacity:0;filter:alpha(opacity=0)}.modal-backdrop.in{opacity:.5;filter:alpha(opacity=50)}.modal-header{padding:15px;border-bottom:1px solid #e5e5e5;min-height:16.4285714px}.modal-header .close{margin-top:-2px}.modal-title{margin:0;line-height:1.4285714}.modal-body{position:relative;padding:15px}.modal-footer{padding:15px;text-align:right;border-top:1px solid #e5e5e5}.modal-footer:before,.modal-footer:after{content:" ";display:table}.modal-footer:after{clear:both}.modal-footer .btn+.btn{margin-left:5px;margin-bottom:0}.modal-footer .btn-group .btn+.btn{margin-left:-1px}.modal-footer .btn-block+.btn-block{margin-left:0}.modal-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.clearfix:before,.clearfix:after{content:" ";display:table}.clearfix:after{clear:both}.center-block{display:block;margin-left:auto;margin-right:auto}.pull-right{float:right!important}.pull-left{float:left!important}.hide{display:none!important}.show{display:block!important}.invisible{visibility:hidden}.text-hide{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0}.hidden{display:none!important;visibility:hidden!important}.affix{position:fixed;-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}.hljs{display:block;overflow-x:auto;padding:.5em;background:#002b36;color:#839496;-webkit-text-size-adjust:none}.hljs-comment,.hljs-template_comment,.diff .hljs-header,.hljs-doctype,.hljs-pi,.lisp .hljs-string,.hljs-javadoc{color:#586e75}.hljs-keyword,.hljs-winutils,.method,.hljs-addition,.css .hljs-tag,.hljs-request,.hljs-status,.nginx .hljs-title{color:#859900}.hljs-number,.hljs-command,.hljs-string,.hljs-tag .hljs-value,.hljs-rules .hljs-value,.hljs-phpdoc,.hljs-dartdoc,.tex .hljs-formula,.hljs-regexp,.hljs-hexcolor,.hljs-link_url{color:#2aa198}.hljs-title,.hljs-localvars,.hljs-chunk,.hljs-decorator,.hljs-built_in,.hljs-identifier,.vhdl .hljs-literal,.hljs-id,.css .hljs-function{color:#268bd2}.hljs-attribute,.hljs-variable,.lisp .hljs-body,.smalltalk .hljs-number,.hljs-constant,.hljs-class .hljs-title,.hljs-parent,.hljs-type,.hljs-link_reference{color:#b58900}.hljs-preprocessor,.hljs-preprocessor .hljs-keyword,.hljs-pragma,.hljs-shebang,.hljs-symbol,.hljs-symbol .hljs-string,.diff .hljs-change,.hljs-special,.hljs-attr_selector,.hljs-subst,.hljs-cdata,.css .hljs-pseudo,.hljs-header{color:#cb4b16}.hljs-deletion,.hljs-important{color:#dc322f}.hljs-link_label{color:#6c71c4}.tex .hljs-formula{background:#073642}*,*:before,*:after{box-sizing:border-box}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background:0 0}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}images{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd{font-size:1em}code,kbd,pre,samp{font-family:monospace,monospace}samp{font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-appearance:textfield;box-sizing:content-box}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}.debug{background-color:#ffc0cb!important}.ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ir{background-color:transparent;border:0;overflow:hidden}.ir::before{content:'';display:block;height:150%;width:0}html{font-size:.875em;background:#fff;color:#373D49}html,body{font-family:Georgia,Cambria,serif;height:100%}body{font-size:1rem;font-weight:400;line-height:2rem}ul,ol{margin-bottom:.83999rem;padding-top:.16001rem}li{-webkit-font-feature-settings:'kern' 1,'onum' 1,'liga' 1;font-feature-settings:'kern' 1,'onum' 1,'liga' 1;margin-left:1rem}li>ul,li>ol{margin-bottom:0}p{padding-top:.66001rem;-webkit-font-feature-settings:'kern' 1,'onum' 1,'liga' 1;font-feature-settings:'kern' 1,'onum' 1,'liga' 1;margin-top:0}p,pre{margin-bottom:1.33999rem}pre{font-size:1rem;padding:.66001rem 9.5px 9.5px;line-height:2rem;background:-webkit-linear-gradient(top,#fff 0,#fff .75rem,#f5f7fa .75rem,#f5f7fa 2.75rem,#fff 2.75rem,#fff 4rem);background:linear-gradient(to bottom,#fff 0,#fff .75rem,#f5f7fa .75rem,#f5f7fa 2.75rem,#fff 2.75rem,#fff 4rem);background-size:100% 4rem;border-color:#D3DAEA}blockquote{margin:0}blockquote p{font-size:1rem;margin-bottom:.33999rem;font-style:italic;padding:.66001rem 1rem 1rem;border-left:3px solid #A0AABF}th,td{padding:12px}h1,h2,h3,h4,h5,h6{font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif;-webkit-font-feature-settings:'dlig' 1,'liga' 1,'lnum' 1,'kern' 1;font-feature-settings:'dlig' 1,'liga' 1,'lnum' 1,'kern' 1;font-style:normal;font-weight:600;margin-top:0}h1{line-height:3rem;font-size:2.0571429rem;margin-bottom:.21999rem;padding-top:.78001rem}h2{font-size:1.953125rem;margin-bottom:.1835837rem;padding-top:.8164163rem}h2,h3{line-height:3rem}h3{font-size:1.6457143rem;margin-bottom:.07599rem;padding-top:.92401rem}h4{font-size:1.5625rem;margin-bottom:.546865rem;padding-top:.453135rem}h5{font-size:1.25rem;margin-bottom:-.56251rem;padding-top:.56251rem}h6{font-size:1rem;margin-bottom:-.65001rem;padding-top:.65001rem}a{cursor:pointer;color:#35D7BB;text-decoration:none}a:hover,a:focus{border-bottom-color:#35D7BB;color:#dff9f4}img{height:auto;max-width:100%}.g{display:block}.g:after{clear:both;content:'';display:table}.g-b{float:left;margin:0;width:100%}.g{margin-left:-16px;margin-right:-16px}.g-b{padding-left:16px;padding-right:16px}.g-b--center{display:block;float:none;margin:0 auto}.g-b--right{float:right}.g-b--1of1{width:100%}.g-b--1of2,.g-b--2of4,.g-b--3of6,.g-b--4of8,.g-b--5of10,.g-b--6of12{width:50%}.g-b--1of3,.g-b--2of6,.g-b--4of12{width:33.333%}.g-b--2of3,.g-b--4of6,.g-b--8of12{width:66.666%}.g-b--1of4,.g-b--2of8,.g-b--3of12{width:25%}.g-b--3of4,.g-b--6of8,.g-b--9of12{width:75%}.g-b--1of5,.g-b--2of10{width:20%}.g-b--2of5,.g-b--4of10{width:40%}.g-b--3of5,.g-b--6of10{width:60%}.g-b--4of5,.g-b--8of10{width:80%}.g-b--1of6,.g-b--2of12{width:16.666%}.g-b--5of6,.g-b--10of12{width:83.333%}.g-b--1of8{width:12.5%}.g-b--3of8{width:37.5%}.g-b--5of8{width:62.5%}.g-b--7of8{width:87.5%}.g-b--1of10{width:10%}.g-b--3of10{width:30%}.g-b--7of10{width:70%}.g-b--9of10{width:90%}.g-b--1of12{width:8.333%}.g-b--5of12{width:41.666%}.g-b--7of12{width:58.333%}.g-b--11of12{width:91.666%}.g-b--push--1of1{margin-left:100%}.g-b--push--1of2,.g-b--push--2of4,.g-b--push--3of6,.g-b--push--4of8,.g-b--push--5of10,.g-b--push--6of12{margin-left:50%}.g-b--push--1of3,.g-b--push--2of6,.g-b--push--4of12{margin-left:33.333%}.g-b--push--2of3,.g-b--push--4of6,.g-b--push--8of12{margin-left:66.666%}.g-b--push--1of4,.g-b--push--2of8,.g-b--push--3of12{margin-left:25%}.g-b--push--3of4,.g-b--push--6of8,.g-b--push--9of12{margin-left:75%}.g-b--push--1of5,.g-b--push--2of10{margin-left:20%}.g-b--push--2of5,.g-b--push--4of10{margin-left:40%}.g-b--push--3of5,.g-b--push--6of10{margin-left:60%}.g-b--push--4of5,.g-b--push--8of10{margin-left:80%}.g-b--push--1of6,.g-b--push--2of12{margin-left:16.666%}.g-b--push--5of6,.g-b--push--10of12{margin-left:83.333%}.g-b--push--1of8{margin-left:12.5%}.g-b--push--3of8{margin-left:37.5%}.g-b--push--5of8{margin-left:62.5%}.g-b--push--7of8{margin-left:87.5%}.g-b--push--1of10{margin-left:10%}.g-b--push--3of10{margin-left:30%}.g-b--push--7of10{margin-left:70%}.g-b--push--9of10{margin-left:90%}.g-b--push--1of12{margin-left:8.333%}.g-b--push--5of12{margin-left:41.666%}.g-b--push--7of12{margin-left:58.333%}.g-b--push--11of12{margin-left:91.666%}.g-b--pull--1of1{margin-right:100%}.g-b--pull--1of2,.g-b--pull--2of4,.g-b--pull--3of6,.g-b--pull--4of8,.g-b--pull--5of10,.g-b--pull--6of12{margin-right:50%}.g-b--pull--1of3,.g-b--pull--2of6,.g-b--pull--4of12{margin-right:33.333%}.g-b--pull--2of3,.g-b--pull--4of6,.g-b--pull--8of12{margin-right:66.666%}.g-b--pull--1of4,.g-b--pull--2of8,.g-b--pull--3of12{margin-right:25%}.g-b--pull--3of4,.g-b--pull--6of8,.g-b--pull--9of12{margin-right:75%}.g-b--pull--1of5,.g-b--pull--2of10{margin-right:20%}.g-b--pull--2of5,.g-b--pull--4of10{margin-right:40%}.g-b--pull--3of5,.g-b--pull--6of10{margin-right:60%}.g-b--pull--4of5,.g-b--pull--8of10{margin-right:80%}.g-b--pull--1of6,.g-b--pull--2of12{margin-right:16.666%}.g-b--pull--5of6,.g-b--pull--10of12{margin-right:83.333%}.g-b--pull--1of8{margin-right:12.5%}.g-b--pull--3of8{margin-right:37.5%}.g-b--pull--5of8{margin-right:62.5%}.g-b--pull--7of8{margin-right:87.5%}.g-b--pull--1of10{margin-right:10%}.g-b--pull--3of10{margin-right:30%}.g-b--pull--7of10{margin-right:70%}.g-b--pull--9of10{margin-right:90%}.g-b--pull--1of12{margin-right:8.333%}.g-b--pull--5of12{margin-right:41.666%}.g-b--pull--7of12{margin-right:58.333%}.g-b--pull--11of12{margin-right:91.666%}.splashscreen{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#373D49;z-index:22}.splashscreen-dillinger{width:260px;height:auto;display:block;margin:0 auto;padding-bottom:3rem}.splashscreen p{font-size:1.25rem;padding-top:.56251rem;font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:400;text-align:center;max-width:500px;margin:0 auto;color:#FFF}.sp-center{position:relative;-webkit-transform:translateY(-50%);transform:translateY(-50%);top:50%}.open-menu>.wrapper{overflow-x:hidden}.page{margin:0 auto;position:relative;top:0;left:0;width:100%;height:100%;z-index:2;-webkit-transition:all .25s ease-in-out;transition:all .25s ease-in-out;background-color:#fff;padding-top:51px;will-change:left}.open-menu .page{left:270px}.title{line-height:1rem;font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem;font-weight:500;color:#A0AABF;letter-spacing:1px;text-transform:uppercase;padding-left:16px;padding-right:16px;margin-top:1rem}.split-preview .title{padding-left:0}.title-document{line-height:1rem;font-size:1.25rem;margin-bottom:.89999rem;padding-top:.10001rem;font-weight:400;font-family:"Ubuntu Mono",Monaco;color:#373D49;padding-left:16px;padding-right:16px;width:80%;min-width:300px;outline:0;border:none}.icon{display:block;margin:0 auto;width:36px;height:36px;border-radius:3px;text-align:center}.icon svg{display:inline-block;margin-left:auto;margin-right:auto}.icon-preview{background-color:#373D49;line-height:40px}.icon-preview svg{width:19px;height:12px}.icon-settings{background-color:#373D49;line-height:44px}.icon-settings svg{width:18px;height:18px}.icon-link{width:16px;height:16px;line-height:1;margin-right:24px;text-align:right}.navbar{background-color:#373D49;height:51px;width:100%;position:fixed;top:0;left:0;z-index:6;-webkit-transition:all .25s ease-in-out;transition:all .25s ease-in-out;will-change:left}.navbar:after{content:"";display:table;clear:both}.open-menu .navbar{left:270px}.navbar-brand{float:left;margin:0 0 0 24px;padding:0;line-height:42px}.navbar-brand svg{width:85px;height:11px}.nav-left{float:left}.nav-right{float:right}.nav-sidebar{width:100%}.menu{list-style:none;margin:0;padding:0}.menu a{border:0;color:#A0AABF;font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif;outline:none;text-transform:uppercase}.menu a:hover{color:#35D7BB}.menu .menu-item{border:0;display:none;float:left;margin:0;position:relative}.menu .menu-item>a{display:block;font-size:12px;height:51px;letter-spacing:1px;line-height:51px;padding:0 24px}.menu .menu-item--settings,.menu .menu-item--preview,.menu .menu-item--save-to.in-sidebar,.menu .menu-item--import-from.in-sidebar,.menu .menu-item--link-unlink.in-sidebar,.menu .menu-item--documents.in-sidebar{display:block}.menu .menu-item--documents{padding-bottom:1rem}.menu .menu-item.open>a{background-color:#1D212A}.menu .menu-item-icon>a{height:auto;padding:0}.menu .menu-item-icon:hover>a{background-color:transparent}.menu .menu-link.open i{background-color:#1D212A}.menu .menu-link.open g{fill:#35D7BB}.menu .menu-link-preview,.menu .menu-link-settings{margin-top:8px;width:51px}.menu-sidebar{width:100%}.menu-sidebar .menu-item{float:none;margin-bottom:1px;width:100%}.menu-sidebar .menu-item.open>a{background-color:#373D49}.menu-sidebar .open .caret{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.menu-sidebar>.menu-item:hover .dropdown a,.menu-sidebar>.menu-item:hover .settings a{background-color:transparent}.menu-sidebar .menu-link{background-color:#373D49;font-weight:600}.menu-sidebar .menu-link:after{content:"";display:table;clear:both}.menu-sidebar .menu-link>span{float:left}.menu-sidebar .menu-link>.caret{float:right;text-align:right;top:22px}.menu-sidebar .dropdown,.menu-sidebar .settings{background-color:transparent;position:static;width:100%}.dropdown{position:absolute;right:0;top:51px;width:188px}.dropdown,.settings{display:none;background-color:#1D212A}.dropdown{padding:0}.dropdown,.settings,.sidebar-list{list-style:none;margin:0}.sidebar-list{padding:0}.dropdown li{margin:32px 0;padding:0 0 0 32px}.dropdown li,.settings li{line-height:1}.sidebar-list li{line-height:1;margin:32px 0;padding:0 0 0 32px}.dropdown a{color:#D0D6E2}.dropdown a,.settings a,.sidebar-list a{display:block;text-transform:none}.sidebar-list a{color:#D0D6E2}.dropdown a:after,.settings a:after,.sidebar-list a:after{content:"";display:table;clear:both}.dropdown .icon,.settings .icon,.sidebar-list .icon{float:right}.open .dropdown,.open .settings,.open .sidebar-list{display:block}.open .dropdown.collapse,.open .collapse.settings,.open .sidebar-list.collapse{display:none}.open .dropdown.collapse.in,.open .collapse.in.settings,.open .sidebar-list.collapse.in{display:block}.dropdown .unlinked .icon,.settings .unlinked .icon,.sidebar-list .unlinked .icon{opacity:.3}.dropdown.documents li,.documents.settings li,.sidebar-list.documents li{background-image:url("../img/icons/file.svg");background-position:240px center;background-repeat:no-repeat;background-size:14px 16px;padding:3px 32px}.dropdown.documents li.octocat,.documents.settings li.octocat,.sidebar-list.documents li.octocat{background-image:url("../img/icons/octocat.svg");background-position:234px center;background-size:24px 24px}.dropdown.documents li:last-child,.documents.settings li:last-child,.sidebar-list.documents li:last-child{margin-bottom:1rem}.dropdown.documents li.active a,.documents.settings li.active a,.sidebar-list.documents li.active a{color:#35D7BB}.settings{position:fixed;top:67px;right:16px;border-radius:3px;width:288px;background-color:#373D49;padding:16px;z-index:7}.show-settings .settings{display:block}.settings .has-checkbox{float:left}.settings a{font-size:1.25rem;font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:400;-webkit-font-smoothing:antialiased;line-height:28px;color:#D0D6E2}.settings a:after{content:"";display:table;clear:both}.settings a:hover{color:#35D7BB}.settings li{border-bottom:1px solid #4F535B;margin:0;padding:16px 0}.settings li:last-child{border-bottom:none}.brand{border:none;display:block}.brand:hover g{fill:#35D7BB}.toggle{display:block;float:left;height:16px;padding:25px 16px 26px;width:40px}.toggle span:after,.toggle span:before{content:'';left:0;position:absolute;top:-6px}.toggle span:after{top:6px}.toggle span{display:block;position:relative}.toggle span,.toggle span:after,.toggle span:before{-webkit-backface-visibility:hidden;backface-visibility:hidden;background-color:#D3DAEA;height:2px;-webkit-transition:all .3s;transition:all .3s;width:20px}.open-menu .toggle span{background-color:transparent}.open-menu .toggle span:before{-webkit-transform:rotate(45deg) translate(3px,3px);transform:rotate(45deg) translate(3px,3px)}.open-menu .toggle span:after{-webkit-transform:rotate(-45deg) translate(5px,-6px);transform:rotate(-45deg) translate(5px,-6px)}.caret{display:inline-block;width:0;height:0;margin-left:6px;vertical-align:middle;position:relative;top:-1px;border-top:4px solid;border-right:4px solid transparent;border-left:4px solid transparent}.sidebar{overflow:auto;height:100%;padding-right:15px;padding-bottom:15px;width:285px}.sidebar-wrapper{-webkit-overflow-scrolling:touch;background-color:#2B2F36;left:0;height:100%;overflow-y:hidden;position:fixed;top:0;width:285px;z-index:1}.sidebar-branding{width:160px;padding:0;margin:16px auto}.header{border-bottom:1px solid #E8E8E8;position:relative}.words{line-height:1rem;font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem;font-weight:500;font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif;color:#A0AABF;letter-spacing:1px;text-transform:uppercase;z-index:5;position:absolute;right:16px;top:0}.words span{color:#000}.btn{text-align:center;display:inline-block;width:100%;text-transform:uppercase;font-weight:600;font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif;font-size:14px;text-shadow:0 1px 0 #1b8b77;padding:16px 24px;background-color:#35D7BB;border-radius:3px;margin:0 auto 16px;line-height:1;color:#fff;-webkit-transition:all .15s linear;transition:all .15s linear;-webkit-font-smoothing:antialiased}.btn--new,.btn--save{display:block;width:238px}.btn--new:hover,.btn--new:focus,.btn--save:hover,.btn--save:focus{color:#fff;border-bottom-color:transparent;box-shadow:0 1px 3px #24b59c;text-shadow:0 1px 0 #24b59c}.btn--save{background-color:#4A5261;text-shadow:0 1px 1px #1e2127}.btn--save:hover,.btn--save:focus{color:#fff;border-bottom-color:transparent;box-shadow:0 1px 5px #08090a;text-shadow:none}.btn--delete{display:block;width:238px;background-color:transparent;font-size:12px;text-shadow:none}.btn--delete:hover,.btn--delete:focus{color:#fff;border-bottom-color:transparent;text-shadow:0 1px 0 #08090a;opacity:.8}.btn--delete-modal,.btn--ok,.btn--close{border-top:0;background-color:#4A5261;text-shadow:0 1px 0 #08090a;margin:0}.btn--delete-modal:hover,.btn--delete-modal:focus,.btn--ok:hover,.btn--ok:focus,.btn--close:hover,.btn--close:focus{color:#fff;background-color:#292d36;text-shadow:none}.btn--delete-modal{display:inline;width:auto}.overlay{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(55,61,73,.8);-webkit-transition:all .25s ease-in-out;transition:all .25s ease-in-out;-webkit-transition-timing-function:ease-out;transition-timing-function:ease-out;will-change:left,opacity,visibility;z-index:5;opacity:0;visibility:hidden}.show-settings .overlay{visibility:visible;opacity:1}.switch{float:right;line-height:1}.switch input{display:none}.switch small{display:inline-block;cursor:pointer;padding:0 24px 0 0;-webkit-transition:all ease .2s;transition:all ease .2s;background-color:#2B2F36;border-color:#2B2F36}.switch small,.switch small:before{border-radius:30px;box-shadow:inset 0 0 2px 0 #14171F}.switch small:before{display:block;content:'';width:28px;height:28px;background:#fff}.switch.checked small{padding-right:0;padding-left:24px;background-color:#35D7BB;box-shadow:none}.modal--dillinger.about .modal-dialog{font-size:1.25rem;max-width:500px}.modal--dillinger.scope .modal-dialog{max-width:300px;margin:5rem auto}.modal--dillinger .modal-dialog{max-width:600px;width:auto;margin:5rem auto}.modal--dillinger .modal-content{background:#373D49;border-radius:3px;box-shadow:0 2px 5px 0 #2C3B59;color:#fff;font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:400;padding:2rem}.modal--dillinger ul{list-style-type:disc;margin:1rem 0;padding:0 0 0 1rem}.modal--dillinger li{padding:0;margin:0}.modal--dillinger .modal-header{border:0;padding:0}.modal--dillinger .modal-body{padding:0}.modal--dillinger .modal-footer{border:0;padding:0}.modal--dillinger .close{color:#fff;opacity:1}.modal-backdrop{background-color:#373D49}.pagination--dillinger{padding:0!important;margin:1.5rem 0!important;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-ms-flex-line-pack:stretch;align-content:stretch}.pagination--dillinger,.pagination--dillinger li{display:-webkit-box;display:-ms-flexbox;display:flex}.pagination--dillinger li{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;text-align:center}.pagination--dillinger li:first-child>a,.pagination--dillinger li.disabled>a,.pagination--dillinger li.disabled>a:hover,.pagination--dillinger li.disabled>a:focus,.pagination--dillinger li>a{background-color:transparent;border-color:#4F535B;border-right-color:transparent}.pagination--dillinger li.active>a,.pagination--dillinger li.active>a:hover,.pagination--dillinger li.active>a:focus{border-color:#4A5261;background-color:#4A5261;color:#fff}.pagination--dillinger li>a{float:none;color:#fff;width:100%;display:block;text-align:center;margin:0;border-right-color:transparent;padding:6px}.pagination--dillinger li>a:hover,.pagination--dillinger li>a:focus{border-color:#35D7BB;background-color:#35D7BB;color:#fff}.pagination--dillinger li:last-child a{border-color:#4F535B}.pagination--dillinger li:first-child a{border-right-color:transparent}.diNotify{position:absolute;z-index:9999;left:0;right:0;top:0;margin:0 auto;max-width:400px;text-align:center;-webkit-transition:top .5s ease-in-out,opacity .5s ease-in-out;transition:top .5s ease-in-out,opacity .5s ease-in-out;visibility:hidden}.diNotify-body{-webkit-font-smoothing:antialiased;background-color:#35D7BB;background:#666E7F;border-radius:3px;color:#fff;font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:400;overflow:hidden;padding:1rem 2rem .5rem;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:baseline;-ms-flex-align:baseline;align-items:baseline;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.diNotify-icon{display:block;width:16px;height:16px;line-height:16px;position:relative;top:3px}.diNotify-message{padding-left:1rem}.zen-wrapper{position:fixed;top:0;left:0;right:0;bottom:0;width:100%;height:100%;z-index:10;background-color:#FFF;opacity:0;-webkit-transition:opacity .25s ease-in-out;transition:opacity .25s ease-in-out}.zen-wrapper.on{opacity:1}.enter-zen-mode{background-image:url("../img/icons/enter-zen.svg");right:.5rem;top:.313rem;display:none}.enter-zen-mode,.close-zen-mode{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0;background-repeat:no-repeat;width:32px;height:32px;display:block;position:absolute}.close-zen-mode{background-image:url("../img/icons/exit-zen.svg");right:1rem;top:1rem}.zen-page{position:relative;top:0;bottom:0;z-index:11;height:100%;width:100%}#zen{font-size:1.25rem;width:300px;height:80%;margin:0 auto;position:relative;top:10%}#zen:before,#zen:after{content:"";position:absolute;height:10%;width:100%;z-index:12;pointer-events:none}#preview .table{width:auto}.split{overflow:scroll;padding:0!important}.split-editor{padding-left:0;padding-right:0;position:relative}.show-preview .split-editor{display:none}.split-preview{background-color:#fff;display:none;top:0;position:relative;z-index:4}.show-preview .split-preview{display:block}#editor{font-size:1rem;font-family:"Ubuntu Mono",Monaco;font-weight:400;line-height:2rem;width:100%;height:100%}#editor .ace_gutter{-webkit-font-smoothing:antialiased}.editor-header{width:50%;float:left;border-bottom:1px solid #E8E8E8;position:relative}.editor-header--first{border-right:1px solid #E8E8E8}.editor-header .title{display:inline-block}#preview{padding:10px}#preview a{color:#A0AABF;text-decoration:underline}.sr-only{visibility:hidden;text-overflow:110%;overflow:hidden;top:-100px;position:absolute}.mnone{margin:0!important}@media (min-width:768px){.form-inline .form-group{display:inline-block;margin-bottom:0;vertical-align:middle}.form-inline .form-control{display:inline-block;width:auto;vertical-align:middle}.form-inline .input-group{display:inline-table;vertical-align:middle}.form-inline .input-group .input-group-addon,.form-inline .input-group .input-group-btn,.form-inline .input-group .form-control{width:auto}.form-inline .input-group>.form-control{width:100%}.form-inline .control-label{margin-bottom:0;vertical-align:middle}.form-inline .radio,.form-inline .checkbox{display:inline-block;margin-top:0;margin-bottom:0;vertical-align:middle}.form-inline .radio label,.form-inline .checkbox label{padding-left:0}.form-inline .radio input[type="radio"],.form-inline .checkbox input[type="checkbox"]{position:relative;margin-left:0}.form-inline .has-feedback .form-control-feedback{top:0}.form-horizontal .control-label{text-align:right;margin-bottom:0;padding-top:7px}.form-horizontal .form-group-lg .control-label{padding-top:14.3px}.form-horizontal .form-group-sm .control-label{padding-top:6px}.modal-dialog{width:600px;margin:30px auto}.modal-content{box-shadow:0 5px 15px rgba(0,0,0,.5)}.modal-sm{width:300px}}@media (min-width:992px){.modal-lg{width:900px}}@media screen and (max-width:767px){.table-responsive{width:100%;margin-bottom:15px;overflow-y:hidden;overflow-x:auto;-ms-overflow-style:-ms-autohiding-scrollbar;border:1px solid #ddd;-webkit-overflow-scrolling:touch}.table-responsive>.table{margin-bottom:0}.table-responsive>.table>thead>tr>th,.table-responsive>.table>thead>tr>td,.table-responsive>.table>tbody>tr>th,.table-responsive>.table>tbody>tr>td,.table-responsive>.table>tfoot>tr>th,.table-responsive>.table>tfoot>tr>td{white-space:nowrap}.table-responsive>.table-bordered{border:0}.table-responsive>.table-bordered>thead>tr>th:first-child,.table-responsive>.table-bordered>thead>tr>td:first-child,.table-responsive>.table-bordered>tbody>tr>th:first-child,.table-responsive>.table-bordered>tbody>tr>td:first-child,.table-responsive>.table-bordered>tfoot>tr>th:first-child,.table-responsive>.table-bordered>tfoot>tr>td:first-child{border-left:0}.table-responsive>.table-bordered>thead>tr>th:last-child,.table-responsive>.table-bordered>thead>tr>td:last-child,.table-responsive>.table-bordered>tbody>tr>th:last-child,.table-responsive>.table-bordered>tbody>tr>td:last-child,.table-responsive>.table-bordered>tfoot>tr>th:last-child,.table-responsive>.table-bordered>tfoot>tr>td:last-child{border-right:0}.table-responsive>.table-bordered>tbody>tr:last-child>th,.table-responsive>.table-bordered>tbody>tr:last-child>td,.table-responsive>.table-bordered>tfoot>tr:last-child>th,.table-responsive>.table-bordered>tfoot>tr:last-child>td{border-bottom:0}}@media screen and (min-width:27.5em){html{font-size:.875em}body{font-size:1rem}ul,ol{margin-bottom:.83999rem;padding-top:.16001rem}p{padding-top:.66001rem}p,pre{margin-bottom:1.33999rem}pre,blockquote p{font-size:1rem;padding-top:.66001rem}blockquote p{margin-bottom:.33999rem}h1{font-size:2.0571429rem;margin-bottom:.21999rem;padding-top:.78001rem}h2{font-size:1.953125rem;margin-bottom:.1835837rem;padding-top:.8164163rem}h3{font-size:1.6457143rem;margin-bottom:.07599rem;padding-top:.92401rem}h4{font-size:1.5625rem;margin-bottom:.546865rem;padding-top:.453135rem}h5{font-size:1.25rem;margin-bottom:-.56251rem;padding-top:.56251rem}h6{font-size:1rem;margin-bottom:-.65001rem;padding-top:.65001rem}.g{margin-left:-16px;margin-right:-16px}.g-b{padding-left:16px;padding-right:16px}.g-b--m1of1{width:100%}.g-b--m1of2,.g-b--m2of4,.g-b--m3of6,.g-b--m4of8,.g-b--m5of10,.g-b--m6of12{width:50%}.g-b--m1of3,.g-b--m2of6,.g-b--m4of12{width:33.333%}.g-b--m2of3,.g-b--m4of6,.g-b--m8of12{width:66.666%}.g-b--m1of4,.g-b--m2of8,.g-b--m3of12{width:25%}.g-b--m3of4,.g-b--m6of8,.g-b--m9of12{width:75%}.g-b--m1of5,.g-b--m2of10{width:20%}.g-b--m2of5,.g-b--m4of10{width:40%}.g-b--m3of5,.g-b--m6of10{width:60%}.g-b--m4of5,.g-b--m8of10{width:80%}.g-b--m1of6,.g-b--m2of12{width:16.666%}.g-b--m5of6,.g-b--m10of12{width:83.333%}.g-b--m1of8{width:12.5%}.g-b--m3of8{width:37.5%}.g-b--m5of8{width:62.5%}.g-b--m7of8{width:87.5%}.g-b--m1of10{width:10%}.g-b--m3of10{width:30%}.g-b--m7of10{width:70%}.g-b--m9of10{width:90%}.g-b--m1of12{width:8.333%}.g-b--m5of12{width:41.666%}.g-b--m7of12{width:58.333%}.g-b--m11of12{width:91.666%}.g-b--push--m1of1{margin-left:100%}.g-b--push--m1of2,.g-b--push--m2of4,.g-b--push--m3of6,.g-b--push--m4of8,.g-b--push--m5of10,.g-b--push--m6of12{margin-left:50%}.g-b--push--m1of3,.g-b--push--m2of6,.g-b--push--m4of12{margin-left:33.333%}.g-b--push--m2of3,.g-b--push--m4of6,.g-b--push--m8of12{margin-left:66.666%}.g-b--push--m1of4,.g-b--push--m2of8,.g-b--push--m3of12{margin-left:25%}.g-b--push--m3of4,.g-b--push--m6of8,.g-b--push--m9of12{margin-left:75%}.g-b--push--m1of5,.g-b--push--m2of10{margin-left:20%}.g-b--push--m2of5,.g-b--push--m4of10{margin-left:40%}.g-b--push--m3of5,.g-b--push--m6of10{margin-left:60%}.g-b--push--m4of5,.g-b--push--m8of10{margin-left:80%}.g-b--push--m1of6,.g-b--push--m2of12{margin-left:16.666%}.g-b--push--m5of6,.g-b--push--m10of12{margin-left:83.333%}.g-b--push--m1of8{margin-left:12.5%}.g-b--push--m3of8{margin-left:37.5%}.g-b--push--m5of8{margin-left:62.5%}.g-b--push--m7of8{margin-left:87.5%}.g-b--push--m1of10{margin-left:10%}.g-b--push--m3of10{margin-left:30%}.g-b--push--m7of10{margin-left:70%}.g-b--push--m9of10{margin-left:90%}.g-b--push--m1of12{margin-left:8.333%}.g-b--push--m5of12{margin-left:41.666%}.g-b--push--m7of12{margin-left:58.333%}.g-b--push--m11of12{margin-left:91.666%}.g-b--pull--m1of1{margin-right:100%}.g-b--pull--m1of2,.g-b--pull--m2of4,.g-b--pull--m3of6,.g-b--pull--m4of8,.g-b--pull--m5of10,.g-b--pull--m6of12{margin-right:50%}.g-b--pull--m1of3,.g-b--pull--m2of6,.g-b--pull--m4of12{margin-right:33.333%}.g-b--pull--m2of3,.g-b--pull--m4of6,.g-b--pull--m8of12{margin-right:66.666%}.g-b--pull--m1of4,.g-b--pull--m2of8,.g-b--pull--m3of12{margin-right:25%}.g-b--pull--m3of4,.g-b--pull--m6of8,.g-b--pull--m9of12{margin-right:75%}.g-b--pull--m1of5,.g-b--pull--m2of10{margin-right:20%}.g-b--pull--m2of5,.g-b--pull--m4of10{margin-right:40%}.g-b--pull--m3of5,.g-b--pull--m6of10{margin-right:60%}.g-b--pull--m4of5,.g-b--pull--m8of10{margin-right:80%}.g-b--pull--m1of6,.g-b--pull--m2of12{margin-right:16.666%}.g-b--pull--m5of6,.g-b--pull--m10of12{margin-right:83.333%}.g-b--pull--m1of8{margin-right:12.5%}.g-b--pull--m3of8{margin-right:37.5%}.g-b--pull--m5of8{margin-right:62.5%}.g-b--pull--m7of8{margin-right:87.5%}.g-b--pull--m1of10{margin-right:10%}.g-b--pull--m3of10{margin-right:30%}.g-b--pull--m7of10{margin-right:70%}.g-b--pull--m9of10{margin-right:90%}.g-b--pull--m1of12{margin-right:8.333%}.g-b--pull--m5of12{margin-right:41.666%}.g-b--pull--m7of12{margin-right:58.333%}.g-b--pull--m11of12{margin-right:91.666%}.splashscreen p{font-size:1.25rem;margin-bottom:1.43749rem;padding-top:.56251rem}.title{font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem}.title-document{margin-bottom:.89999rem;padding-top:.10001rem}.title-document,.settings a{font-size:1.25rem}.words{font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem}.modal--dillinger.about .modal-dialog,#zen{font-size:1.25rem}#zen{width:400px}#editor{font-size:1rem}}@media screen and (min-width:46.25em){html{font-size:.875em}body{font-size:1rem}ul,ol{margin-bottom:.83999rem;padding-top:.16001rem}p{padding-top:.66001rem}p,pre{margin-bottom:1.33999rem}pre,blockquote p{font-size:1rem;padding-top:.66001rem}blockquote p{margin-bottom:.33999rem}h1{font-size:2.0571429rem;margin-bottom:.21999rem;padding-top:.78001rem}h2{font-size:1.953125rem;margin-bottom:.1835837rem;padding-top:.8164163rem}h3{font-size:1.6457143rem;margin-bottom:.07599rem;padding-top:.92401rem}h4{font-size:1.5625rem;margin-bottom:.546865rem;padding-top:.453135rem}h5{font-size:1.25rem;margin-bottom:-.56251rem;padding-top:.56251rem}h6{font-size:1rem;margin-bottom:-.65001rem;padding-top:.65001rem}.g{margin-left:-16px;margin-right:-16px}.g-b{padding-left:16px;padding-right:16px}.g-b--t1of1{width:100%}.g-b--t1of2,.g-b--t2of4,.g-b--t3of6,.g-b--t4of8,.g-b--t5of10,.g-b--t6of12{width:50%}.g-b--t1of3,.g-b--t2of6,.g-b--t4of12{width:33.333%}.g-b--t2of3,.g-b--t4of6,.g-b--t8of12{width:66.666%}.g-b--t1of4,.g-b--t2of8,.g-b--t3of12{width:25%}.g-b--t3of4,.g-b--t6of8,.g-b--t9of12{width:75%}.g-b--t1of5,.g-b--t2of10{width:20%}.g-b--t2of5,.g-b--t4of10{width:40%}.g-b--t3of5,.g-b--t6of10{width:60%}.g-b--t4of5,.g-b--t8of10{width:80%}.g-b--t1of6,.g-b--t2of12{width:16.666%}.g-b--t5of6,.g-b--t10of12{width:83.333%}.g-b--t1of8{width:12.5%}.g-b--t3of8{width:37.5%}.g-b--t5of8{width:62.5%}.g-b--t7of8{width:87.5%}.g-b--t1of10{width:10%}.g-b--t3of10{width:30%}.g-b--t7of10{width:70%}.g-b--t9of10{width:90%}.g-b--t1of12{width:8.333%}.g-b--t5of12{width:41.666%}.g-b--t7of12{width:58.333%}.g-b--t11of12{width:91.666%}.g-b--push--t1of1{margin-left:100%}.g-b--push--t1of2,.g-b--push--t2of4,.g-b--push--t3of6,.g-b--push--t4of8,.g-b--push--t5of10,.g-b--push--t6of12{margin-left:50%}.g-b--push--t1of3,.g-b--push--t2of6,.g-b--push--t4of12{margin-left:33.333%}.g-b--push--t2of3,.g-b--push--t4of6,.g-b--push--t8of12{margin-left:66.666%}.g-b--push--t1of4,.g-b--push--t2of8,.g-b--push--t3of12{margin-left:25%}.g-b--push--t3of4,.g-b--push--t6of8,.g-b--push--t9of12{margin-left:75%}.g-b--push--t1of5,.g-b--push--t2of10{margin-left:20%}.g-b--push--t2of5,.g-b--push--t4of10{margin-left:40%}.g-b--push--t3of5,.g-b--push--t6of10{margin-left:60%}.g-b--push--t4of5,.g-b--push--t8of10{margin-left:80%}.g-b--push--t1of6,.g-b--push--t2of12{margin-left:16.666%}.g-b--push--t5of6,.g-b--push--t10of12{margin-left:83.333%}.g-b--push--t1of8{margin-left:12.5%}.g-b--push--t3of8{margin-left:37.5%}.g-b--push--t5of8{margin-left:62.5%}.g-b--push--t7of8{margin-left:87.5%}.g-b--push--t1of10{margin-left:10%}.g-b--push--t3of10{margin-left:30%}.g-b--push--t7of10{margin-left:70%}.g-b--push--t9of10{margin-left:90%}.g-b--push--t1of12{margin-left:8.333%}.g-b--push--t5of12{margin-left:41.666%}.g-b--push--t7of12{margin-left:58.333%}.g-b--push--t11of12{margin-left:91.666%}.g-b--pull--t1of1{margin-right:100%}.g-b--pull--t1of2,.g-b--pull--t2of4,.g-b--pull--t3of6,.g-b--pull--t4of8,.g-b--pull--t5of10,.g-b--pull--t6of12{margin-right:50%}.g-b--pull--t1of3,.g-b--pull--t2of6,.g-b--pull--t4of12{margin-right:33.333%}.g-b--pull--t2of3,.g-b--pull--t4of6,.g-b--pull--t8of12{margin-right:66.666%}.g-b--pull--t1of4,.g-b--pull--t2of8,.g-b--pull--t3of12{margin-right:25%}.g-b--pull--t3of4,.g-b--pull--t6of8,.g-b--pull--t9of12{margin-right:75%}.g-b--pull--t1of5,.g-b--pull--t2of10{margin-right:20%}.g-b--pull--t2of5,.g-b--pull--t4of10{margin-right:40%}.g-b--pull--t3of5,.g-b--pull--t6of10{margin-right:60%}.g-b--pull--t4of5,.g-b--pull--t8of10{margin-right:80%}.g-b--pull--t1of6,.g-b--pull--t2of12{margin-right:16.666%}.g-b--pull--t5of6,.g-b--pull--t10of12{margin-right:83.333%}.g-b--pull--t1of8{margin-right:12.5%}.g-b--pull--t3of8{margin-right:37.5%}.g-b--pull--t5of8{margin-right:62.5%}.g-b--pull--t7of8{margin-right:87.5%}.g-b--pull--t1of10{margin-right:10%}.g-b--pull--t3of10{margin-right:30%}.g-b--pull--t7of10{margin-right:70%}.g-b--pull--t9of10{margin-right:90%}.g-b--pull--t1of12{margin-right:8.333%}.g-b--pull--t5of12{margin-right:41.666%}.g-b--pull--t7of12{margin-right:58.333%}.g-b--pull--t11of12{margin-right:91.666%}.splashscreen-dillinger{width:500px}.splashscreen p{font-size:1.25rem;margin-bottom:1.43749rem;padding-top:.56251rem}.title{font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem}.title-document{font-size:1.25rem;margin-bottom:.89999rem;padding-top:.10001rem}.menu .menu-item--save-to,.menu .menu-item--import-from{display:block}.menu .menu-item--preview,.menu .menu-item--save-to.in-sidebar,.menu .menu-item--import-from.in-sidebar{display:none}.settings a{font-size:1.25rem}.words{font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem}.modal--dillinger.about .modal-dialog{font-size:1.25rem}.enter-zen-mode{display:block}.close-zen-mode{right:3rem;top:3rem}#zen{font-size:1.25rem;width:500px}.split-editor{border-right:1px solid #E8E8E8;float:left;height:calc(100vh - 172px);-webkit-overflow-scrolling:touch;padding-right:16px;width:50%}.show-preview .split-editor{display:block}.split-preview{display:block;float:right;height:calc(100vh - 172px);-webkit-overflow-scrolling:touch;position:relative;top:0;width:50%}#editor{font-size:1rem}}@media screen and (min-width:62.5em){html{font-size:.875em}body{font-size:1rem}ul,ol{margin-bottom:.83999rem;padding-top:.16001rem}p{padding-top:.66001rem}p,pre{margin-bottom:1.33999rem}pre,blockquote p{font-size:1rem;padding-top:.66001rem}blockquote p{margin-bottom:.33999rem}h1{font-size:2.0571429rem;margin-bottom:.21999rem;padding-top:.78001rem}h2{font-size:1.953125rem;margin-bottom:.1835837rem;padding-top:.8164163rem}h3{font-size:1.6457143rem;margin-bottom:.07599rem;padding-top:.92401rem}h4{font-size:1.5625rem;margin-bottom:.546865rem;padding-top:.453135rem}h5{font-size:1.25rem;margin-bottom:-.56251rem;padding-top:.56251rem}h6{font-size:1rem;margin-bottom:-.65001rem;padding-top:.65001rem}.g{margin-left:-16px;margin-right:-16px}.g-b{padding-left:16px;padding-right:16px}.g-b--d1of1{width:100%}.g-b--d1of2,.g-b--d2of4,.g-b--d3of6,.g-b--d4of8,.g-b--d5of10,.g-b--d6of12{width:50%}.g-b--d1of3,.g-b--d2of6,.g-b--d4of12{width:33.333%}.g-b--d2of3,.g-b--d4of6,.g-b--d8of12{width:66.666%}.g-b--d1of4,.g-b--d2of8,.g-b--d3of12{width:25%}.g-b--d3of4,.g-b--d6of8,.g-b--d9of12{width:75%}.g-b--d1of5,.g-b--d2of10{width:20%}.g-b--d2of5,.g-b--d4of10{width:40%}.g-b--d3of5,.g-b--d6of10{width:60%}.g-b--d4of5,.g-b--d8of10{width:80%}.g-b--d1of6,.g-b--d2of12{width:16.666%}.g-b--d5of6,.g-b--d10of12{width:83.333%}.g-b--d1of8{width:12.5%}.g-b--d3of8{width:37.5%}.g-b--d5of8{width:62.5%}.g-b--d7of8{width:87.5%}.g-b--d1of10{width:10%}.g-b--d3of10{width:30%}.g-b--d7of10{width:70%}.g-b--d9of10{width:90%}.g-b--d1of12{width:8.333%}.g-b--d5of12{width:41.666%}.g-b--d7of12{width:58.333%}.g-b--d11of12{width:91.666%}.g-b--push--d1of1{margin-left:100%}.g-b--push--d1of2,.g-b--push--d2of4,.g-b--push--d3of6,.g-b--push--d4of8,.g-b--push--d5of10,.g-b--push--d6of12{margin-left:50%}.g-b--push--d1of3,.g-b--push--d2of6,.g-b--push--d4of12{margin-left:33.333%}.g-b--push--d2of3,.g-b--push--d4of6,.g-b--push--d8of12{margin-left:66.666%}.g-b--push--d1of4,.g-b--push--d2of8,.g-b--push--d3of12{margin-left:25%}.g-b--push--d3of4,.g-b--push--d6of8,.g-b--push--d9of12{margin-left:75%}.g-b--push--d1of5,.g-b--push--d2of10{margin-left:20%}.g-b--push--d2of5,.g-b--push--d4of10{margin-left:40%}.g-b--push--d3of5,.g-b--push--d6of10{margin-left:60%}.g-b--push--d4of5,.g-b--push--d8of10{margin-left:80%}.g-b--push--d1of6,.g-b--push--d2of12{margin-left:16.666%}.g-b--push--d5of6,.g-b--push--d10of12{margin-left:83.333%}.g-b--push--d1of8{margin-left:12.5%}.g-b--push--d3of8{margin-left:37.5%}.g-b--push--d5of8{margin-left:62.5%}.g-b--push--d7of8{margin-left:87.5%}.g-b--push--d1of10{margin-left:10%}.g-b--push--d3of10{margin-left:30%}.g-b--push--d7of10{margin-left:70%}.g-b--push--d9of10{margin-left:90%}.g-b--push--d1of12{margin-left:8.333%}.g-b--push--d5of12{margin-left:41.666%}.g-b--push--d7of12{margin-left:58.333%}.g-b--push--d11of12{margin-left:91.666%}.g-b--pull--d1of1{margin-right:100%}.g-b--pull--d1of2,.g-b--pull--d2of4,.g-b--pull--d3of6,.g-b--pull--d4of8,.g-b--pull--d5of10,.g-b--pull--d6of12{margin-right:50%}.g-b--pull--d1of3,.g-b--pull--d2of6,.g-b--pull--d4of12{margin-right:33.333%}.g-b--pull--d2of3,.g-b--pull--d4of6,.g-b--pull--d8of12{margin-right:66.666%}.g-b--pull--d1of4,.g-b--pull--d2of8,.g-b--pull--d3of12{margin-right:25%}.g-b--pull--d3of4,.g-b--pull--d6of8,.g-b--pull--d9of12{margin-right:75%}.g-b--pull--d1of5,.g-b--pull--d2of10{margin-right:20%}.g-b--pull--d2of5,.g-b--pull--d4of10{margin-right:40%}.g-b--pull--d3of5,.g-b--pull--d6of10{margin-right:60%}.g-b--pull--d4of5,.g-b--pull--d8of10{margin-right:80%}.g-b--pull--d1of6,.g-b--pull--d2of12{margin-right:16.666%}.g-b--pull--d5of6,.g-b--pull--d10of12{margin-right:83.333%}.g-b--pull--d1of8{margin-right:12.5%}.g-b--pull--d3of8{margin-right:37.5%}.g-b--pull--d5of8{margin-right:62.5%}.g-b--pull--d7of8{margin-right:87.5%}.g-b--pull--d1of10{margin-right:10%}.g-b--pull--d3of10{margin-right:30%}.g-b--pull--d7of10{margin-right:70%}.g-b--pull--d9of10{margin-right:90%}.g-b--pull--d1of12{margin-right:8.333%}.g-b--pull--d5of12{margin-right:41.666%}.g-b--pull--d7of12{margin-right:58.333%}.g-b--pull--d11of12{margin-right:91.666%}.splashscreen-dillinger{width:700px}.splashscreen p{font-size:1.25rem;margin-bottom:1.43749rem;padding-top:.56251rem}.title{font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem}.title-document{font-size:1.25rem;margin-bottom:.89999rem;padding-top:.10001rem}.menu .menu-item--export-as{display:block}.menu .menu-item--preview{display:none}.settings a{font-size:1.25rem}.words{font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem}.modal--dillinger.about .modal-dialog,#zen{font-size:1.25rem}#zen{width:700px}#editor{font-size:1rem}}@media screen and (min-width:87.5em){html{font-size:.875em}body{font-size:1rem}ul,ol{margin-bottom:.83999rem;padding-top:.16001rem}p{padding-top:.66001rem}p,pre{margin-bottom:1.33999rem}pre,blockquote p{font-size:1rem;padding-top:.66001rem}blockquote p{margin-bottom:.33999rem}h1{font-size:2.0571429rem;margin-bottom:.21999rem;padding-top:.78001rem}h2{font-size:1.953125rem;margin-bottom:.1835837rem;padding-top:.8164163rem}h3{font-size:1.6457143rem;margin-bottom:.07599rem;padding-top:.92401rem}h4{font-size:1.5625rem;margin-bottom:.546865rem;padding-top:.453135rem}h5{font-size:1.25rem;margin-bottom:-.56251rem;padding-top:.56251rem}h6{font-size:1rem;margin-bottom:-.65001rem;padding-top:.65001rem}.splashscreen-dillinger{width:800px}.splashscreen p{font-size:1.25rem;margin-bottom:1.43749rem;padding-top:.56251rem}.title{font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem}.title-document{margin-bottom:.89999rem;padding-top:.10001rem}.title-document,.settings a{font-size:1.25rem}.words{font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem}.modal--dillinger.about .modal-dialog,#zen{font-size:1.25rem}#editor{font-size:1rem}}@media screen and (max-width:46.1875em){.editor-header{display:none}.editor-header--first{display:block;width:100%}}</style></head><body id="preview">
<h1><a id="Samenvatting_Databanken_0"></a>Samenvatting Databanken</h1>
<h1><a id="Hoofdstuk_5_2"></a>Hoofdstuk 5</h1>
<h2><a id="Stored_Procedures_4"></a>Stored Procedures</h2>
<hr>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">procedure</span> usp_Customers_Delete
@custno <span class="hljs-keyword">nchar</span>(<span class="hljs-number">5</span>) = <span class="hljs-literal">NULL</span>
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">IF</span> @custno <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">BEGIN</span>
RAISERROR(<span class="hljs-string">'customerID is NULL'</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>)
<span class="hljs-keyword">RETURN</span>
<span class="hljs-keyword">END</span>
<span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> customers <span class="hljs-keyword">WHERE</span> customerid = @custno)
<span class="hljs-keyword">BEGIN</span>
RAISERROR (<span class="hljs-string">'Klant bestaat niet'</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>)
<span class="hljs-keyword">RETURN</span>
<span class="hljs-keyword">END</span>
<span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> customerid = @custno) <span class="hljs-keyword">BEGIN</span>
RAISERROR (<span class="hljs-string">'Klant heeft orders'</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>)
<span class="hljs-keyword">RETURN</span>
<span class="hljs-keyword">END</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> customers <span class="hljs-keyword">WHERE</span> customerid = @custno
</span></code></pre>
<h3><a id="Gebruik_in_MS_SQL_Server_28"></a>Gebruik in MS SQL Server</h3>
<p><strong>-exec <em>procedure</em> <em>value</em></strong></p>
<h2><a id="Functies_32"></a>Functies</h2>
<hr>
<ol>
<li>Standaard SQL Functies</li>
<li>Niet standaard built-in functions:
…* SQL Server: datediff, substring, len, round,… ( <a href="http://technet.microsoft.com/en-us/library/ms174318.aspx">library</a> )</li>
<li>User defined functies</li>
</ol>
<h3><a id="User_defined_functies_39"></a>User defined functies</h3>
<p>Manier om naast views en CTE’s SELECTS te <strong>hergebruiken</strong>, nu zelfs met <strong>parameters</strong>
Voorbeeld:</p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> GetAge
(
@birthdate <span class="hljs-keyword">AS</span> <span class="hljs-built_in">DATE</span>,
@eventdate <span class="hljs-keyword">AS</span> <span class="hljs-built_in">DATE</span>
)
<span class="hljs-keyword">RETURNS</span> <span class="hljs-built_in">INT</span>
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">BEGIN</span>
<span class="hljs-keyword">RETURN</span>
<span class="hljs-keyword">DATEDIFF</span>(<span class="hljs-keyword">year</span>, @birthdate, @eventdate)
- <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-number">100</span> * <span class="hljs-keyword">MONTH</span>(@eventdate) + <span class="hljs-keyword">DAY</span>(@eventdate)
&lt; <span class="hljs-number">100</span> * <span class="hljs-keyword">MONTH</span>(@birthdate) + <span class="hljs-keyword">DAY</span>(@birthdate)
<span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span>
<span class="hljs-keyword">END</span>;</span>
<span class="hljs-operator"><span class="hljs-keyword">END</span>;</span>
</code></pre>
<p>Gebruik:</p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">select</span> lastname,firstname,birthdate,hiredate,
dbo.GetAge(birthdate,<span class="hljs-keyword">getdate</span>()) <span class="hljs-keyword">as</span> leeftijd,
dbo.GetAge(hiredate,<span class="hljs-keyword">getdate</span>()) <span class="hljs-keyword">as</span> dienstjaren,
dbo.GetAge(birthdate,hiredate) <span class="hljs-keyword">as</span>
LeeftijdIndienttreding
<span class="hljs-keyword">from</span> Employees
</span></code></pre>
<h3><a id="Inline_Table_Valued_Function_69"></a>Inline Table Valued Function</h3>
<p>Geef per product klasse het goedkoopste product dat meer kost dan X€ en een product die die prijs heeft.</p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">minimum</span> (@grens <span class="hljs-built_in">int</span>) <span class="hljs-keyword">returns</span> <span class="hljs-keyword">table</span>
<span class="hljs-keyword">as</span>
<span class="hljs-keyword">return</span>
<span class="hljs-keyword">select</span> productclassid klasse,<span class="hljs-keyword">min</span>(price) prijs
<span class="hljs-keyword">from</span> product <span class="hljs-keyword">p</span> <span class="hljs-keyword">where</span> price &gt;= @grens
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> productclassid;</span>
<span class="hljs-comment">-- gebruik:</span>
<span class="hljs-operator"><span class="hljs-keyword">select</span> klasse,prijs,
(<span class="hljs-keyword">select</span> top <span class="hljs-number">1</span> productid <span class="hljs-keyword">from</span> product <span class="hljs-keyword">where</span>
productclassid=klasse <span class="hljs-keyword">and</span> price=prijs)
<span class="hljs-keyword">from</span> <span class="hljs-keyword">minimum</span>(<span class="hljs-number">0</span>);</span>
</code></pre>
<h3><a id="Voordelen_PSM_86"></a>Voordelen PSM</h3>
<ol>
<li>Code modularisatie.
<ul>
<li>Reduceren redundante code</li>
<li>Minder onderhoud bij schema wijzigingen</li>
<li>Vaak voor CRUD operaties</li>
</ul>
</li>
<li>Customisatie van “gesloten” systemen zoals ERP: via stored procedures en triggers kan men “ingrijpen”.</li>
<li>Security:
<ul>
<li>rechtstreekse query’s op tabellen uitsluiten</li>
<li>via SP’s vastleggen wat kan en wat niet</li>
<li>vermijd SQL-injection door gebruik input-parameters.</li>
</ul>
</li>
<li>Centrale administratie van (delen van) DB-code.</li>
</ol>
<h3><a id="Nadelen_PSM_98"></a>Nadelen PSM</h3>
<ol>
<li>Beperkte schaalbaarheid: business logica en db verwerking op zelfde server kan tot bottle-necks leiden.</li>
<li>Vendor lock-in
<ul>
<li>Syntax = Geen standaard</li>
<li>Portabiliteit heeft zijn prijs: vb built-in functions niet gebruiken</li>
</ul>
</li>
<li>Twee programmeertalen:
<ol>
<li>Java/.NET/ …</li>
<li>SD / UDF</li>
</ol>
</li>
<li>Twee Debuggingomgevingen</li>
<li>SD/UDF: Beperkte OO-ondersteuning.</li>
</ol>
<h3><a id="Vuistregels_109"></a>Vuistregels:</h3>
<ol>
<li>Vermijd PSM voor grotere business logica</li>
<li>Gebruik PSM vooral voor technische zaken:
<ul>
<li>Validatie / Logging / Auditing</li>
</ul>
</li>
<li>Maak keuze portabiliteit / Vendor Lock-in in overleg met business en corporate IT policies</li>
</ol>
<h2><a id="Stored_Procedure_115"></a>Stored Procedure</h2>
<hr>
<blockquote>
<p><strong>Een stored procedure</strong> is een benoemde verzameling SQL en control-of-flow opdrachten (programma) die opgeslagen wordt als een database object.</p>
</blockquote>
<p>Analoog aan procedures uit andere talen:</p>
<ul>
<li>Kan worden aangeroepen vanuit: programme, trigger of stored procedure</li>
<li>Wordt opgeslagen in de catalagus.</li>
<li>Accepteer in- en uitvoer parameters</li>
<li>Retourneert statusinformatie over de al dan niet correct uitvoering van de stored procedure.</li>
<li>Bevat taken die vaak worden uitgevoerd.</li>
</ul>
<h2><a id="Variabelen_126"></a>Variabelen</h2>
<hr>
<h3><a id="Lokale_variabelen_129"></a>Lokale variabelen</h3>
<p><strong>Declareren:</strong>
de naam wordt steeds voorafgegaan door <strong>@</strong></p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">DECLARE</span> @variable_name1 data_type [, @variable_name2data_type ...]
</span></code></pre>
<p><strong>Toekennen van waarde aan variabele:</strong></p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">SET</span> @variable_name = expression
<span class="hljs-keyword">SELECT</span> @variable_name = column_specification
</span></code></pre>
<p>Set en select zijn gelijkaardig, maar <strong>SET</strong> is <strong>ANSI</strong> standaard.</p>
<p>Met <strong>SELECT</strong> kan je wel <strong>meerdere variabelen in 1 keer</strong> een waarde geven. (2e SELECT hieronder)</p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">SET</span> @<span class="hljs-keyword">max</span> = (<span class="hljs-keyword">select</span> <span class="hljs-keyword">max</span>(invoiceTotal) <span class="hljs-keyword">from</span> invoices)
<span class="hljs-keyword">SELECT</span> @<span class="hljs-keyword">max</span> = <span class="hljs-keyword">max</span>(invoiceTotal) <span class="hljs-keyword">from</span> invoices

<span class="hljs-keyword">SELECT</span> @<span class="hljs-keyword">max</span> = <span class="hljs-keyword">max</span>(invoiceTotal), @nrOfInvoices = <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">from</span> invoices

PRINT string_expression
</span></code></pre>
<p>Als alternatief voor print kan je ook <strong>select</strong> gebruiken:
<em>SELECT string + variabele</em></p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">DECLARE</span> @lname <span class="hljs-built_in">varchar</span>(<span class="hljs-number">40</span>), @rijtelling <span class="hljs-built_in">int</span>
<span class="hljs-keyword">SET</span> @lname = ‘Ringer’
<span class="hljs-keyword">SELECT</span> @rijtelling = <span class="hljs-keyword">count</span>(*)
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Authors</span>
<span class="hljs-keyword">WHERE</span> au_lname=@lname
PRINT ‘Aantal werknemers met naam ‘ + @lname + ‘ = ‘ +
<span class="hljs-keyword">str</span>(@rijtelling)
</span></code></pre>
<h2><a id="Transact_SQL_165"></a>Transact SQL</h2>
<hr>
<h3><a id="Operatoren_in_Transact_SQL_167"></a>Operatoren in Transact SQL</h3>
<ul>
<li>Rekenkundige operatoren
<ul>
<li>– , +, *, /, % (Modulo)</li>
</ul>
</li>
<li>Vergelijkings operatoren
<ul>
<li>–, &lt;, &gt;, =, …, IS NULL, LIKE, BETWEEN, IN</li>
</ul>
</li>
<li>Alfanumerieke operatoren
<ul>
<li>+(String Concatenatie)</li>
</ul>
</li>
<li>Logische operatoren
<ul>
<li>AND, OR, NOT</li>
</ul>
</li>
<li>Functies
<ul>
<li>Numerieke: ROUND, POWER, COS, …</li>
<li>Datum/Tijd: DATEADD, DATEDIFF, GETDATE, DAY, MONTH…</li>
<li>Alfanumerieke: LEFT, RIGHT, LTRIM, RTRIM, TRIM, REPLACE, UPPER, LOWER, …</li>
<li>Systeemfuncties: CAST, CONVERT, ISNUMERIC, ISDATE, PRINT, …</li>
</ul>
</li>
</ul>
<h2><a id="Control_flow_in_Transact_SQL_182"></a>Control flow in Transact SQL</h2>
<p>Programma verloop kan je bepalen via:</p>
<p><strong>Instructie niveau:</strong></p>
<pre><code class="language-SQL">    <span class="hljs-operator"><span class="hljs-keyword">BEGIN</span> ... <span class="hljs-keyword">END</span>
    <span class="hljs-keyword">IF</span> ... <span class="hljs-keyword">ELSE</span>
    <span class="hljs-keyword">WHILE</span>... (BREAK / CONTINUE)
    <span class="hljs-keyword">RETURN</span>
</span></code></pre>
<p><strong>Rij-niveau:</strong></p>
<pre><code class="language-SQL">    CASE ... <span class="hljs-operator"><span class="hljs-keyword">END</span>
</span></code></pre>
<h3><a id="Commentaar_196"></a>Commentaar</h3>
<p><strong>Inline commentaar:</strong></p>
<pre><code>    -- commentaar
</code></pre>
<p><strong>Block commentaar:</strong></p>
<pre><code>    /* commentaar */
    
    /*
    ** commentaar
    */ 
</code></pre>
<h3><a id="Foutafhandeling_met_Transact_SQL_209"></a>Foutafhandeling met Transact SQL</h3>
<ul>
<li><strong>RETURN</strong> : Onmiddelijke beëindiging van de batch of procedure.</li>
<li><strong>@@error</strong> : Bevat de fout van de laatste utigevoerde instructie, indien ok value = 0.</li>
<li><strong>RAISERROR</strong> : Retourneren van een user defined fout of systeemfout</li>
</ul>
<h2><a id="CURSORS_214"></a>CURSORS</h2>
<hr>
<blockquote>
<p>SQL statements werken standaard met een complete resultaatset en niet
met individuele rijen. Cursors laten toe om met individuele rijen te werken.</p>
</blockquote>
<p><strong>Een cursor is</strong> een database object die wijst naar een resultaatset. Via de
cursor geef je aan met welke rij uit de resultaatset je wenst te werken</p>
<p><strong>5 belangrijke statements:</strong></p>
<ol>
<li><strong>DECLARE CURSOR</strong> : Creëert en definieert cursor</li>
<li><strong>OPEN</strong> : Opent de gedeclareerde cursor</li>
<li><strong>FETCH</strong> : Haalt 1 rij op</li>
<li><strong>CLOSE</strong> : Sluit de cursor</li>
<li><strong>DEALLOCATE</strong> : Verwijdert de cursor definitie</li>
</ol>
<pre><code class="language-SQL">1.  <span class="hljs-operator"><span class="hljs-keyword">DECLARE</span> &lt;cursor_name&gt; [INSENSITIVE][<span class="hljs-keyword">SCROLL</span>] <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span>
    &lt;SELECT_statement&gt;
    [<span class="hljs-keyword">FOR</span> {<span class="hljs-keyword">READ</span> <span class="hljs-keyword">ONLY</span> | <span class="hljs-keyword">UPDATE</span>[<span class="hljs-keyword">OF</span> &lt;<span class="hljs-keyword">column</span> <span class="hljs-keyword">list</span>&gt;]}]

<span class="hljs-number">2.</span>  <span class="hljs-keyword">OPEN</span> &lt;<span class="hljs-keyword">cursor</span> <span class="hljs-keyword">name</span>&gt;

<span class="hljs-number">3.</span>  <span class="hljs-keyword">FETCH</span> [<span class="hljs-keyword">NEXT</span> | <span class="hljs-keyword">PRIOR</span> | <span class="hljs-keyword">FIRST</span> | <span class="hljs-keyword">LAST</span> | {<span class="hljs-keyword">ABSOLUTE</span> | <span class="hljs-keyword">RELATIVE</span>
    &lt;<span class="hljs-keyword">row</span> <span class="hljs-built_in">number</span>&gt;}]
    <span class="hljs-keyword">FROM</span> &lt;<span class="hljs-keyword">cursor</span> <span class="hljs-keyword">name</span>&gt;  
    [<span class="hljs-keyword">INTO</span> &lt;<span class="hljs-keyword">variable</span> <span class="hljs-keyword">name</span>&gt;[,...&lt;<span class="hljs-keyword">last</span> <span class="hljs-keyword">variable</span> <span class="hljs-keyword">name</span>&gt;]] 
    
<span class="hljs-number">4.</span>  <span class="hljs-keyword">CLOSE</span> &lt;<span class="hljs-keyword">cursor</span> <span class="hljs-keyword">name</span>&gt;

<span class="hljs-number">5.</span>  <span class="hljs-keyword">DEALLOCATE</span> &lt;<span class="hljs-keyword">cursor</span> <span class="hljs-keyword">name</span>&gt;
</span></code></pre>
<h3><a id="Overzicht_voorbeeld_CURSORS_246"></a>Overzicht voorbeeld CURSORS:</h3>
<pre><code class="language-SQL">    <span class="hljs-operator"><span class="hljs-keyword">DECLARE</span> @au_lname <span class="hljs-built_in">varchar</span>(<span class="hljs-number">40</span>), @au_fname <span class="hljs-built_in">varchar</span>(<span class="hljs-number">20</span>)
    <span class="hljs-keyword">DECLARE</span> authors_cursor <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span>
    <span class="hljs-keyword">SELECT</span> au_lname, au_fname <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">authors</span>
    <span class="hljs-keyword">WHERE</span> au_lname <span class="hljs-keyword">LIKE</span> ‘B%’
    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> au_lname, au_fname
    
    <span class="hljs-keyword">OPEN</span> authors_cursor
    
    <span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-keyword">FROM</span> authors_cursor
    <span class="hljs-keyword">INTO</span> @au_lname, @au_fname
    <span class="hljs-keyword">WHILE</span> @@FETCH_STATUS = <span class="hljs-number">0</span>
        <span class="hljs-keyword">BEGIN</span>
            PRINT ‘Author: ‘ + @au_fname + ‘ ‘ + @au_lname
            <span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-keyword">FROM</span> authors_cursor
                <span class="hljs-keyword">INTO</span> @au_lname, @au_fname
        <span class="hljs-keyword">END</span>
    <span class="hljs-keyword">CLOSE</span> authors_cursor
    <span class="hljs-keyword">DEALLOCATE</span> authors_cursor
</span></code></pre>
<h3><a id="Geavanceerd_voorbeeld_CURSORS_267"></a>Geavanceerd voorbeeld CURSORS:</h3>
<pre><code class="language-SQL">    <span class="hljs-operator"><span class="hljs-keyword">DECLARE</span> @au_lname <span class="hljs-built_in">varchar</span>(<span class="hljs-number">40</span>)
    <span class="hljs-keyword">DECLARE</span> @au_fname <span class="hljs-built_in">varchar</span>(<span class="hljs-number">20</span>), @au_id <span class="hljs-keyword">id</span>
    <span class="hljs-keyword">DECLARE</span> @message <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>)
    <span class="hljs-keyword">DECLARE</span> @title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">80</span>)
    
    <span class="hljs-keyword">DECLARE</span> authors_cursor <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span>
    <span class="hljs-keyword">SELECT</span> au_id, au_fname, au_lname
    <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">authors</span>
    <span class="hljs-keyword">WHERE</span> state = <span class="hljs-string">'UT'</span>
    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> au_id
    
    <span class="hljs-keyword">OPEN</span> authors_cursor
    
    <span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-keyword">FROM</span> authors_cursor <span class="hljs-keyword">INTO</span> @au_id, @au_fname, @au_lname
        <span class="hljs-keyword">WHILE</span> @@FETCH_STATUS = <span class="hljs-number">0</span>
            <span class="hljs-keyword">BEGIN</span>
                PRINT <span class="hljs-string">' '</span>
                <span class="hljs-keyword">SELECT</span> @message = <span class="hljs-string">'----- Books by Author:
                    '</span> + @au_fname + <span class="hljs-string">' '</span> + @au_lname
                PRINT @message
                <span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-keyword">FROM</span> authors_cursor <span class="hljs-keyword">INTO</span> @au_id, @au_fname, @au_lname
            <span class="hljs-keyword">END</span>
    <span class="hljs-keyword">CLOSE</span> authors_cursor
    <span class="hljs-keyword">DEALLOCATE</span> authors_cursor
</span></code></pre>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">DECLARE</span> @au_lname <span class="hljs-built_in">varchar</span>(<span class="hljs-number">40</span>)
<span class="hljs-keyword">DECLARE</span> @au_fname <span class="hljs-built_in">varchar</span>(<span class="hljs-number">20</span>), @au_id <span class="hljs-keyword">id</span>
<span class="hljs-keyword">DECLARE</span> @message <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50</span>)
<span class="hljs-keyword">DECLARE</span> @title <span class="hljs-built_in">varchar</span>(<span class="hljs-number">80</span>)
<span class="hljs-keyword">DECLARE</span> authors_cursor <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span>
<span class="hljs-keyword">SELECT</span> au_id, au_fname, au_lname
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">authors</span>
<span class="hljs-keyword">WHERE</span> state = <span class="hljs-string">'UT'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> au_id
<span class="hljs-keyword">OPEN</span> authors_cursor
<span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-keyword">FROM</span> authors_cursor
<span class="hljs-keyword">INTO</span> @au_id, @au_fname, @au_lname
    <span class="hljs-keyword">WHILE</span> @@FETCH_STATUS = <span class="hljs-number">0</span> <span class="hljs-keyword">BEGIN</span>
        PRINT <span class="hljs-string">' '</span>
        <span class="hljs-keyword">SELECT</span> @message = <span class="hljs-string">'----- Books by Author:'</span> 
                + @au_fname + <span class="hljs-string">' '</span> + @au_lname
        PRINT @message
    <span class="hljs-comment">-- Declare an inner cursor based</span>
    <span class="hljs-comment">-- on au_id from the outer cursor.</span>
    <span class="hljs-keyword">DECLARE</span> titles_cursor <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span>
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">t</span>.title
    <span class="hljs-keyword">FROM</span> titleauthor ta <span class="hljs-keyword">join</span> titles <span class="hljs-keyword">t</span>
    <span class="hljs-keyword">ON</span> ta.title_id = <span class="hljs-keyword">t</span>.title_id <span class="hljs-keyword">AND</span>
    ta.au_id = @au_id <span class="hljs-comment">-- variable value</span>
    <span class="hljs-keyword">from</span> the <span class="hljs-keyword">outer</span> <span class="hljs-keyword">cursor</span>
    
    <span class="hljs-keyword">OPEN</span> titles_cursor
    
    <span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-keyword">FROM</span> titles_cursor <span class="hljs-keyword">INTO</span> @title
    <span class="hljs-keyword">IF</span> @@FETCH_STATUS &lt;&gt; <span class="hljs-number">0</span>
    PRINT <span class="hljs-string">' &lt;&lt;No Books&gt;&gt;'</span>
    <span class="hljs-keyword">WHILE</span> @@FETCH_STATUS = <span class="hljs-number">0</span> <span class="hljs-keyword">BEGIN</span>
        <span class="hljs-keyword">SELECT</span> @message = <span class="hljs-string">' '</span> + @title
        PRINT @message
        <span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-keyword">FROM</span> titles_cursor <span class="hljs-keyword">INTO</span>
        @title
    <span class="hljs-keyword">END</span>
    
    <span class="hljs-keyword">CLOSE</span> titles_cursor
    <span class="hljs-keyword">DEALLOCATE</span> titles_cursor
    <span class="hljs-comment">-- Get the next author.</span>
    
    <span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-keyword">FROM</span> authors_cursor
    <span class="hljs-keyword">INTO</span> @au_id, @au_fname, @au_lname
<span class="hljs-keyword">END</span> <span class="hljs-comment">-- outer while loop</span>
<span class="hljs-keyword">CLOSE</span> authors_cursor
<span class="hljs-keyword">DEALLOCATE</span> authors_cursor
</span></code></pre>
<h3><a id="Update_en_delete_via_CURSORS_344"></a>Update en delete via CURSORS</h3>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> &lt;<span class="hljs-keyword">table</span> <span class="hljs-keyword">name</span>&gt;
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">CURRENT</span> <span class="hljs-keyword">OF</span> &lt;<span class="hljs-keyword">cursor</span> <span class="hljs-keyword">name</span>&gt;

<span class="hljs-keyword">UPDATE</span> &lt;<span class="hljs-keyword">table</span> <span class="hljs-keyword">name</span>&gt;
<span class="hljs-keyword">SET</span> ...
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">CURRENT</span> <span class="hljs-keyword">OF</span> &lt;<span class="hljs-keyword">cursor</span> <span class="hljs-keyword">name</span>&gt; 
</span></code></pre>
<h3><a id="Creatie_van_SP_Stored_Procedure_353"></a>Creatie van SP (Stored Procedure)</h3>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> &lt;proc_name&gt; [parameter declaratie]
<span class="hljs-keyword">AS</span>
&lt;sql_statements&gt; 
</span></code></pre>
<h3><a id="Wijzigen_verwijderen_en_uitvoeren_van_SP_360"></a>Wijzigen, verwijderen en uitvoeren van SP</h3>
<pre><code class="language-SQL"><span class="hljs-comment">-- WIJZIGEN</span>
<span class="hljs-operator"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">PROCEDURE</span> &lt;proc_name&gt; [parameter declaratie]
<span class="hljs-keyword">AS</span>
&lt;sql_statements&gt; 

<span class="hljs-comment">-- VERWIJDEREN</span>
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">PROCEDURE</span> &lt;proc_name&gt;

<span class="hljs-comment">-- UITVOEREN</span>
<span class="hljs-keyword">EXECUTE</span> &lt;proc_name&gt; [<span class="hljs-keyword">parameters</span>] 

<span class="hljs-comment">/*
** bij eerste uitvoering: compilatie en optimalisatie
** hercompilatie forceren: wenselijk bij wijzigingen aan structuur databank
*/</span>
    <span class="hljs-keyword">execute</span> uspOrdersSelectAll <span class="hljs-keyword">with</span> recompile
    <span class="hljs-keyword">execute</span> sp_recompile uspOrdersSelectAll
</span></code></pre>
<h3><a id="Return_waarde_van_een_SP_381"></a>Return waarde van een SP</h3>
<p>Bij uitvoering keer een SP een <strong>return waarde</strong> terug, deze waarde is een int met default waarde 0</p>
<p><strong>Return Statement:</strong> uitvoering van SP wordt gestopt, laat toe om de return waarde te bepalen.</p>
<h3><a id="Voorbeeld_gebruik_van_return_waarde_386"></a>Voorbeeld gebruik van return waarde:</h3>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> usp_OrdersSelectAll <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> orders
<span class="hljs-keyword">return</span> @@ROWCOUNT
<span class="hljs-comment">-- creatie van een SP met expliciete return-waarde</span>
<span class="hljs-keyword">DECLARE</span> @returnCode <span class="hljs-built_in">int</span>
EXEC @returnCode = usp_OrdersSelectAll
PRINT ‘Er zijn ‘ + <span class="hljs-keyword">str</span>(@returnCode) + ‘ <span class="hljs-keyword">records</span>.’
<span class="hljs-comment">-- gebruik SP met return-waarde</span>
</span></code></pre>
<h3><a id="SP_met_parameters_398"></a>SP met parameters</h3>
<p>Aanroepen van de SP:</p>
<ul>
<li>Voorzie steeds keyword <strong>OUTPUT</strong> voor outputs parameters.</li>
<li>2 manieten om de actuele parameters door te geven:
<ol>
<li>Gebruik formele parmater naam (volgorde onbelangrijk)</li>
<li>Positioneel</li>
</ol>
</li>
</ul>
<pre><code class="language-SQL">    <span class="hljs-operator"><span class="hljs-keyword">DECLARE</span> @aantal <span class="hljs-built_in">int</span>
    <span class="hljs-keyword">EXECUTE</span> usp_OrdersSelectAllForCustomer
    @customerID = ‘ALFKI’,
    @<span class="hljs-keyword">count</span> = @aantal <span class="hljs-keyword">OUTPUT</span>
    PRINT @aantal
    <span class="hljs-comment">-- param doorgeven via expliciet gebruik formele param-namen</span>
    <span class="hljs-keyword">DECLARE</span> @aantal <span class="hljs-built_in">int</span>
    EXEC usp_OrdersSelectAllForCustomer <span class="hljs-string">'ALFKI'</span>, @aantal <span class="hljs-keyword">OUTPUT</span>
    PRINT @aantal
    <span class="hljs-comment">-- parameters positioneel doorgeven</span>
</span></code></pre>
<h2><a id="Error_Handling_418"></a>Error Handling</h2>
<hr>
<p><strong>@@error</strong> is en systeemfunctie die het foutnummer bevat van de laatst uitgevoerde opdracht. De waarde 0 wijst op succesvolle uitvoering.</p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> usp_ProductsInsert
    @productName <span class="hljs-keyword">nvarchar</span>(<span class="hljs-number">40</span>),
    @categoryID <span class="hljs-built_in">int</span>,
    @unitprice money
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> products(productname, categoryID, unitprice)
<span class="hljs-keyword">VALUES</span> (@productname, @categoryID, @unitprice)
<span class="hljs-keyword">IF</span> @@<span class="hljs-keyword">error</span> = <span class="hljs-number">515</span>
    PRINT <span class="hljs-string">'ERROR! productname is NULL.'</span>
<span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">IF</span> @@<span class="hljs-keyword">error</span> = <span class="hljs-number">547</span>
        PRINT <span class="hljs-string">'ERROR! CategoryID is not in CATEGORY table.'</span>
     <span class="hljs-keyword">ELSE</span> PRINT <span class="hljs-string">'ERROR! Unable to add new product.'</span>
<span class="hljs-keyword">RETURN</span> @@<span class="hljs-keyword">error</span>
<span class="hljs-comment">-- gebruik van @@error om specifieke foutboodschappen te genereren en als returnwaarde</span>
</span></code></pre>
<p>Alle foutboodschappen zitten in de systeemtabel <strong>sysmessages</strong>:</p>
<pre><code class="language-SQL">    <span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">master</span>.dbo.sysmessages
    <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">error</span> = @@<span class="hljs-keyword">ERROR</span> 
</span></code></pre>
<p>Eigen foutboodschappen genereren kan via <strong>raiserror</strong>.</p>
<pre><code class="language-SQL">    raiserror(msg, severity, state)
    <span class="hljs-comment">-- Message = Foutboodschap</span>
    <span class="hljs-comment">-- Severity = Waarde tussen 0 en 18</span>
    <span class="hljs-comment">-- State = waarde tussen 1 en 127</span>
</code></pre>
<p>Voorbeeld andere systeemfunctie <strong>@@rowcount</strong></p>
<ul>
<li>Aantal aangepaste/geselecteerde rijen door de laatst uitgevoerde instructie.</li>
</ul>
<h3><a id="Exception_handling_454"></a>Exception handling:</h3>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> dbo.TestError3 (@<span class="hljs-keyword">e</span> <span class="hljs-built_in">int</span> <span class="hljs-keyword">OUTPUT</span>)
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">BEGIN</span>
<span class="hljs-keyword">SET</span> @<span class="hljs-keyword">e</span> = <span class="hljs-number">0</span>;</span>
<span class="hljs-operator"><span class="hljs-keyword">BEGIN</span> TRY
    <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> Person.Address (AddressID) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>);</span>
<span class="hljs-operator"><span class="hljs-keyword">END</span> TRY
<span class="hljs-keyword">BEGIN</span> CATCH
    <span class="hljs-keyword">SET</span> @<span class="hljs-keyword">e</span> = ERROR_NUMBER();</span>
    PRINT N'Error Procedure = ' + ERROR_PROCEDURE();
    PRINT N'Error Message = ' + ERROR_MESSAGE();
<span class="hljs-operator"><span class="hljs-keyword">END</span> CATCH
<span class="hljs-keyword">END</span>

<span class="hljs-keyword">GO</span>
<span class="hljs-keyword">DECLARE</span> @<span class="hljs-keyword">e</span> <span class="hljs-built_in">int</span>;</span>
EXEC dbo.TestError3 @e OUTPUT;
PRINT N'Error code = ' + CAST(@e AS nvarchar(10));
</code></pre>
<p><strong>Catch block functies</strong></p>
<table class="table table-striped table-bordered">
<thead>
<tr>
<th>Functie</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>ERROR _ LINE()</td>
<td>Lijn nummer waar exception optrad</td>
</tr>
<tr>
<td>ERROR_MESSAGE()</td>
<td>Foutboodschap</td>
</tr>
<tr>
<td>ERROR_PROCEDURE()</td>
<td>SP waar fout optrad</td>
</tr>
<tr>
<td>ERROR_NUMBER()</td>
<td>Foutnummer</td>
</tr>
<tr>
<td>ERROR_SEVERITY()</td>
<td>Severity level v/d fout</td>
</tr>
</tbody>
</table>
<h2><a id="Triggers_485"></a>Triggers</h2>
<hr>
<blockquote>
<p><strong>Een trigger</strong>: een hoeveelheid code, bestaande uit
procedurele en declaratieve instructies, die opgeslagen
is in de catalogus en die geactiveerd wordt door het
DBMS indien een bepaalde operatie op de database wordt
uitgevoerd en indien een bepaalde conditie voldaan is</p>
</blockquote>
<p>Gelijkaardig aan SP maar <strong>kan niet expliciet worden opgeroepen</strong></p>
<ul>
<li>
<p>Een trigger wordt automatisch door het DBMS aangeroepen bij bepaalde
DML en DDL opdrachten</p>
<ul>
<li><strong>DML trigger</strong>: bij een <strong>insert, update of delete</strong> voor een tabel of view waar de
trigger aan is gekoppeld (wij beperken ons verder in deze cursus tot dit soort triggers).
Kunnen geactiverd worden: **before*, instead of, after **( = na IUD verwerkt en voor COMMIT) de IUD opdracht. *Niet ondersteund in SQL Server</li>
<li><strong>DDL trigger</strong>: bijvoorbeeld bij een <strong>create, alter of drop</strong> van een tabel waar een
trigger aan gekoppeld is</li>
</ul>
</li>
</ul>
<h2><a id="Procedurele_database_objecten_503"></a>Procedurele database objecten:</h2>
<hr>
<h3><a id="Procedurele_programmas_505"></a>Procedurele programma’s</h3>
<table class="table table-striped table-bordered">
<thead>
<tr>
<th>soort</th>
<th>opgeslaan als</th>
<th>uitvoering</th>
<th>ondersteunt parameters</th>
</tr>
</thead>
<tbody>
<tr>
<td>script</td>
<td>apart bestand</td>
<td>client tool (bv. Management Studio)</td>
<td>nee</td>
</tr>
<tr>
<td>stored procedure</td>
<td>database object</td>
<td>via applicatie of SQLscript</td>
<td>ja</td>
</tr>
<tr>
<td>user defined function</td>
<td>database object</td>
<td>via applicatie of SQL script</td>
<td>ja</td>
</tr>
<tr>
<td>trigger</td>
<td>database object</td>
<td>via DML statement</td>
<td>nee</td>
</tr>
</tbody>
</table>
<h3><a id="Waarvoor_Triggers_gebruiken_513"></a>Waarvoor Triggers gebruiken?</h3>
<ol>
<li>validatie van data en complexe constraints
<ul>
<li>een werknemer mag aan niet meer dan 10 projecten verbonden zijn</li>
<li>een werknemer kan enkel verbonden zijn aan een project dat toegewezen is aan zijn
departement</li>
</ul>
</li>
<li>automatische generatie van waarden
<ul>
<li>wanneer een werknemer wordt toegewezen aan een project wordt de default waarde voor de
maandelijkse bonus die hieraan verbonden is automatisch ingevuld adhv de project prioriteit
en zijn jobcategorie</li>
</ul>
</li>
<li>ondersteuning voor alerts
<ul>
<li>automatisch een e-mail sturen wanneer een werknemer van een project gehaald wordt</li>
</ul>
</li>
<li>bijhouden van audits
<ul>
<li>automatisch bijhouden wie wat doet en met welke tabel</li>
</ul>
</li>
<li>replicatie en gecontroleerd bijhouden van redundante data
<ul>
<li>bijhouden van aantal projecten toegekend aan een werknemer in de werknemer tabel</li>
<li>automatisch opvullen van datawarehouse-tabellen voor rapportering (zie hoofdstuk
“Datawarehousing”)</li>
</ul>
</li>
</ol>
<h3><a id="Voordelen_en_nadelen_531"></a>Voordelen en nadelen</h3>
<p><strong>Grote voordeel:</strong> mogelijkheid om <strong>functionaliteit in de DB</strong> op te slaan en <strong>consistent uit te voeren</strong> bij elke wijziging aan de DB.</p>
<p><strong>Dus:</strong></p>
<ul>
<li>Geen redundante code, <em>functionaliteit zit op 1 plaats in de DB</em></li>
<li>Wijzigingen aanbrengen wordt eenvoudig, <em>written &amp; tested once door ervaren DBA</em></li>
<li>Veiligheid, <em>triggers zitten in de DB dus kunnen alle beveilingsregels volgen</em></li>
<li>Meer processing power, <em>voor DBMS en DB</em></li>
<li>Past in client-server model, <em>1 aanroep naar db-server waar veel kan gebeuren zonder dat verdere communicatie vereist is</em></li>
</ul>
<p><strong>Nadelen</strong></p>
<ul>
<li>Complexiteit, <em>DB ontwerp, implementatie en onderhoud is complexer door verschuiven van functionaliteit van applicatie naar DB +  Moeilijk te debuggen.</em></li>
<li>Verborgen functionaliteit, <em>gebruiker kan confronted worden met onverwachte neveneffecten trigger. Triggers kunnen ook cascaderen; bij het ontwerp van de trigger is dit niet altijd duidelijk te voorspellen.</em></li>
<li>Performantie, <em>bij elke wijziging aan DB moet trigger conditie geëvalueerd worden</em></li>
<li>Portabiliteit, <em>je pint je vast op het dialect van DBMS</em></li>
</ul>
<h3><a id="Vergelijking_trigger_functionaliteit_547"></a>Vergelijking trigger functionaliteit</h3>
<table class="table table-striped table-bordered">
<thead>
<tr>
<th></th>
<th style="text-align:center">Oracle</th>
<th style="text-align:center">MS SQL Server</th>
<th style="text-align:center">MySQL</th>
</tr>
</thead>
<tbody>
<tr>
<td>BEFORE <em>bij validatie</em></td>
<td style="text-align:center">X</td>
<td style="text-align:center">simuleren via AFTER-Trigger+ROLLBACK</td>
<td style="text-align:center">X</td>
</tr>
<tr>
<td>AFTER</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
</tr>
<tr>
<td>INSTEAD OF <em>bij views</em></td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
</tr>
<tr>
<td>FOR EACH STATEMENT</td>
<td style="text-align:center">X</td>
<td style="text-align:center">DEFAULT</td>
<td style="text-align:center">DEFAULT</td>
</tr>
<tr>
<td>FOR EACH ROW</td>
<td style="text-align:center"><strong>X:</strong> <em>toegang tot waarden voor/na via :NEW/:OLD</em> vars</td>
<td style="text-align:center"><strong>N/A:</strong> <em>toegang to waarden voor/na per rij via deleted/inserted pseudo-tabellen</em></td>
<td style="text-align:center"><strong>X:</strong> <em>toegang tot waarden voor/na via NEW/OLD vars</em></td>
</tr>
<tr>
<td>TRANSACTIES</td>
<td style="text-align:center">COMMIT/ROLLBACK niet toegestaan</td>
<td style="text-align:center">COMMIT/ROLLBACK toegestaan</td>
<td style="text-align:center">COMMIT/ROLLBACK niet toegestaan</td>
</tr>
</tbody>
</table>
<h3><a id="Virtuele_tabellen_bij_Triggers_556"></a>“Virtuele” tabellen bij Triggers</h3>
<p>2 tijdelijke tabellen</p>
<ul>
<li><strong>Deleted Tabel</strong> : bevat kopies van de gewijzigde (update) verwijderde (delete) rijen.
<ul>
<li>Tijdens de update of delete worden rijen van de <strong>trigger tabel</strong> gekopieerd naar de <strong>deleted tabel</strong></li>
<li>Deze twee tabellen hebben geen gemeenschappelijke rijen</li>
</ul>
</li>
<li><strong>Inserted Tabel</strong> : bevat kopies van gewijzigde (update) of ingevoegde (insert) rijen
<ul>
<li>tijdens een update of insert wordt een kopie van elke rij die gewijzigd of toegevoegd wordt in de <strong>trigger tabel</strong> geplaatst in de <strong>inserted tabel</strong></li>
<li>deze twee tabellen hebben dus enkel gemeenschappelijke rijen</li>
</ul>
</li>
</ul>
<h3><a id="Creatie_van_een_after_trigger_565"></a>Creatie van een after trigger</h3>
<p>Enkel mogelijk door SysAdmin of dbo en is <strong>gebonden aan 1 tabel</strong>; niet aan een view.</p>
<p>Wordt uitgevoerd na:</p>
<ol>
<li>na uitvoering van de triggering actie, i.e. <em>insert, update, delete</em></li>
<li>Na logging van de update in de tijdelijke trigger tabellen inserted en deleted</li>
<li>Voor de commit</li>
</ol>
<pre><code class="language-SQL">    <span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> naam
    <span class="hljs-keyword">ON</span> tabel
    <span class="hljs-keyword">FOR</span> [<span class="hljs-keyword">INSERT</span>, <span class="hljs-keyword">UPDATE</span>, <span class="hljs-keyword">DELETE</span>]
    <span class="hljs-keyword">AS</span> ...
    vereenvoudigde syntax voor
    een <span class="hljs-keyword">after</span> <span class="hljs-keyword">trigger</span>
</span></code></pre>
<h2><a id="Voorbeelden_Triggers_582"></a>Voorbeelden Triggers</h2>
<hr>
<h3><a id="Insert_aftertrigger_584"></a>Insert after-trigger</h3>
<p>Triggering instructie is een <strong>insert</strong> instructie</p>
<ul>
<li><strong>Inserted:</strong>  logische tabel waarvan kolomnamen gelijk zijn an die van triggering tabel en die een copy bevat van de rij(en) die werden toegevoegd.</li>
<li><strong>Merk op:</strong> bij triggering door een INSERT-SELECT statement kunnen bij één INSERT meerdere records toegevoegd worden. De trigger zal dan slechts 1x uitgevoerd worden, maar voor elke record een mutatie record aanmaken.</li>
</ul>
<pre><code class="language-SQL">    <span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> insert_speler <span class="hljs-keyword">ON</span> SPELERS <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">insert</span>
    <span class="hljs-keyword">AS</span>
        <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> mutatie (gebruiker, mut_tijdstip, mut_snr, mut_type, mut_snr_new)
        <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">user</span>, <span class="hljs-keyword">getdate</span>(), nul, <span class="hljs-string">'i'</span>, spelersnr <span class="hljs-keyword">FROM</span> inserted
    <span class="hljs-comment">-- Automatisch bijwerken van de mutatie tabel bij toevoegen van speler</span>
</span></code></pre>
<h3><a id="Delete_aftertrigger_595"></a>Delete after-trigger</h3>
<p>Triggering instructie is een <strong>delete</strong> instructie:</p>
<ul>
<li><strong>Deleted</strong> : logische tabel waarvan kolomnamen gelijk zijn aan die van de triggering tabel en die een copy bevat van de rij(en) die werden verwijderd.</li>
<li>We maken gebruik van onderstaande stored procedure, die we zullen hergebruiken bij de update-trigger.</li>
</ul>
<pre><code class="language-SQL">    <span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> usp_mutatie_insert
        (@MSNR <span class="hljs-built_in">SMALLINT</span>,
        @MTYPE <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">1</span>),
        @MSNR_NEW <span class="hljs-built_in">SMALLINT</span>)
    <span class="hljs-keyword">AS</span>
        <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> mutatie (gebruiker, mut_tijdstip, mut_snr,mut_type, mut_snr_new)
        <span class="hljs-keyword">VALUES</span> (<span class="hljs-keyword">user</span>, <span class="hljs-keyword">getdate</span>() ,@MSNR, @MTYPE, @MSNR_NEW);</span>
        
<span class="hljs-comment">-- automatisch bijwerken van de mutatie tabel bij verwijderen van één of meerdere spelers</span>
    <span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> delete_speler
        <span class="hljs-keyword">ON</span> spelers <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">delete</span>
    <span class="hljs-keyword">AS</span>
        <span class="hljs-keyword">DECLARE</span> @old_snr <span class="hljs-built_in">smallint</span>
        <span class="hljs-keyword">DECLARE</span> del_cursor <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">SELECT</span> spelersnr <span class="hljs-keyword">FROM</span> deleted
        <span class="hljs-keyword">OPEN</span> del_cursor
        <span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-keyword">FROM</span> del_cursor <span class="hljs-keyword">INTO</span> @old_snr
        <span class="hljs-keyword">WHILE</span> @@FETCH_STATUS = <span class="hljs-number">0</span>
        <span class="hljs-keyword">BEGIN</span>
            EXEC usp_mutatie_insert @old_snr,<span class="hljs-string">'D'</span>,<span class="hljs-literal">null</span>
            <span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-keyword">FROM</span> del_cursor <span class="hljs-keyword">INTO</span> @old_snr
        <span class="hljs-keyword">END</span>
        <span class="hljs-keyword">CLOSE</span> del_cursor
        <span class="hljs-keyword">DEALLOCATE</span> del_cursor
    <span class="hljs-comment">-- Activatie van de trigger:</span>
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> spelers <span class="hljs-keyword">where</span> spelersnr &gt; <span class="hljs-number">115</span>;</span>
</code></pre>
<h3><a id="Update_aftertrigger_626"></a>Update after-trigger</h3>
<p>Triggering instructie is een <strong>update</strong> instructie</p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> update_speler <span class="hljs-keyword">ON</span> spelers <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">update</span>
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">DECLARE</span> @old_snr <span class="hljs-built_in">smallint</span>, @new_snr <span class="hljs-built_in">smallint</span>

<span class="hljs-keyword">DECLARE</span> before_cursor <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">SELECT</span> spelersnr <span class="hljs-keyword">FROM</span> deleted
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> spelersnr

<span class="hljs-keyword">DECLARE</span> after_cursor <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">SELECT</span> spelersnr <span class="hljs-keyword">FROM</span> inserted
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> spelersnr

<span class="hljs-keyword">OPEN</span> before_cursor
<span class="hljs-keyword">OPEN</span> after_cursor

<span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-keyword">FROM</span> before_cursor <span class="hljs-keyword">INTO</span> @old_snr
<span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-keyword">FROM</span> after_cursor <span class="hljs-keyword">INTO</span> @new_snr

<span class="hljs-keyword">WHILE</span> @@FETCH_STATUS = <span class="hljs-number">0</span>
<span class="hljs-keyword">BEGIN</span>
    EXEC usp_mutatie_insert @old_snr,<span class="hljs-string">'U'</span>,@new_snr
    <span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-keyword">FROM</span> before_cursor <span class="hljs-keyword">INTO</span> @old_snr
    <span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-keyword">FROM</span> after_cursor <span class="hljs-keyword">INTO</span> @new_snr
<span class="hljs-keyword">END</span>

<span class="hljs-keyword">DEALLOCATE</span> before_cursor
<span class="hljs-keyword">DEALLOCATE</span> after_cursor

<span class="hljs-comment">-- Activatie van de trigger</span>
<span class="hljs-keyword">update</span> spelers <span class="hljs-keyword">set</span> jaartoe=jaartoe + <span class="hljs-number">20</span>;</span>
<span class="hljs-comment">-- OF:</span>
<span class="hljs-operator"><span class="hljs-keyword">update</span> spelers <span class="hljs-keyword">set</span> spelersnr = spelersnr + <span class="hljs-number">100</span>;</span>
</code></pre>
<h3><a id="De_IF_UPDATE_clausule_660"></a>De IF UPDATE clausule</h3>
<p>Voorwaardelijke uitvoering van triggers: uitvoering enkel als een specifieke kolom vernoemd wordt in een update of insert</p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> update_speler <span class="hljs-keyword">ON</span> spelers <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">update</span>
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">DECLARE</span> @old_snr <span class="hljs-built_in">smallint</span>, @new_snr <span class="hljs-built_in">smallint</span>

<span class="hljs-keyword">DECLARE</span> before_cursor <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">SELECT</span> spelersnr <span class="hljs-keyword">FROM</span> deleted <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> spelersnr
<span class="hljs-keyword">OPEN</span> before_cursor
<span class="hljs-keyword">IF</span> <span class="hljs-keyword">update</span>(spelersnr)
<span class="hljs-keyword">BEGIN</span>
    <span class="hljs-keyword">DECLARE</span> after_cursor <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">SELECT</span> spelersnr <span class="hljs-keyword">FROM</span> inserted <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> spelersnr
    <span class="hljs-keyword">OPEN</span> after_cursor
<span class="hljs-keyword">END</span>

<span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-keyword">FROM</span> before_cursor <span class="hljs-keyword">INTO</span> @old_snr
<span class="hljs-keyword">IF</span> <span class="hljs-keyword">update</span>(spelersnr)
    <span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-keyword">FROM</span> after_cursor <span class="hljs-keyword">INTO</span> @new_snr
<span class="hljs-keyword">ELSE</span>
    <span class="hljs-keyword">SET</span> @new_snr = @old_snr
    
<span class="hljs-keyword">WHILE</span> @@FETCH_STATUS = <span class="hljs-number">0</span>
<span class="hljs-keyword">BEGIN</span>
    EXEC usp_mutatie_insert @old_snr,<span class="hljs-string">'U'</span>,@new_snr
    <span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-keyword">FROM</span> before_cursor <span class="hljs-keyword">INTO</span> @old_snr
    <span class="hljs-keyword">IF</span> <span class="hljs-keyword">update</span>(spelersnr)
        <span class="hljs-keyword">FETCH</span> <span class="hljs-keyword">NEXT</span> <span class="hljs-keyword">FROM</span> after_cursor <span class="hljs-keyword">INTO</span> @new_snr
    <span class="hljs-keyword">ELSE</span>
        <span class="hljs-keyword">SET</span> @new_snr = @old_snr
<span class="hljs-keyword">END</span>

<span class="hljs-keyword">DEALLOCATE</span> before_cursor
<span class="hljs-keyword">IF</span> <span class="hljs-keyword">update</span>(spelersnr)
<span class="hljs-keyword">DEALLOCATE</span> after_cursor
</span></code></pre>
<h3><a id="Andere_trigger_condities_696"></a>Andere trigger condities</h3>
<p>Ook normale condities kunnen in triggers</p>
<pre><code class="language-SQL">IF datepart(hour, getdate()) &gt;= 9
AND datepart(hour, getdate()) &lt; 19
    BEGIN ... END
-- enkel tussen 9:00 en 19:00 uur is de trigger actief… 

IF USER IN ('JAN', 'PETER', 'MARK')
    BEGIN...END
-- enkel voor specifieke gebruikers de triggercode uitvoeren … 
</code></pre>
<h3><a id="Voorbeeld_gecontroleerd_bijhouden_van_redundante_data_709"></a>Voorbeeld: gecontroleerd bijhouden van redundante data</h3>
<ul>
<li>Veronderstel dat de SPELERS-tabel een kolom SOM_BOETES bevat <strong>(redundantie)</strong>. Deze kolom bevat voor elke speler de som van zijn of haar boetes. Nu willen we triggers creëren die automatisch de waarden in deze kolom bijhouden <strong>(integriteit)</strong> . Hiervoor moeten we volgende triggers creëren</li>
<li>Creëer zelf de update en delete triggers</li>
</ul>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> boete_insert <span class="hljs-keyword">ON</span> boetes
<span class="hljs-keyword">FOR</span> <span class="hljs-keyword">INSERT</span>
<span class="hljs-keyword">AS</span>
    <span class="hljs-keyword">DECLARE</span> @boete <span class="hljs-built_in">smallint</span>, @snr <span class="hljs-built_in">smallint</span>
    <span class="hljs-keyword">SELECT</span> @boete = bedrag, @snr = spelersnr <span class="hljs-keyword">from</span> inserted
    <span class="hljs-keyword">update</span> speler <span class="hljs-keyword">set</span> som_boetes = som_boetes + @boete
    <span class="hljs-keyword">WHERE</span> spelersnr = @snr
</span></code></pre>
<p>Opmerking: deze trigger werkt enkel indien de inserts gegarandeerd één per
één gebeuren  wegens:</p>
<pre><code class="language-SQL">    <span class="hljs-operator"><span class="hljs-keyword">SELECT</span> @boete = bedrag, @snr = spelersnr <span class="hljs-keyword">FROM</span> inserted)
</span></code></pre>
<p>Mogelijke aanpak voor de update en delete triggers:</p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> boete_del_upd <span class="hljs-keyword">ON</span> boetes
<span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>, <span class="hljs-keyword">DELETE</span>
<span class="hljs-keyword">AS</span>
    <span class="hljs-keyword">DECLARE</span> @boete <span class="hljs-keyword">as</span> <span class="hljs-built_in">smallint</span>, @snr <span class="hljs-keyword">as</span> <span class="hljs-built_in">smallint</span>
    <span class="hljs-keyword">SELECT</span> @snr = spelersnr <span class="hljs-keyword">from</span> deleted
    <span class="hljs-keyword">SELECT</span> @boete = <span class="hljs-keyword">SUM</span>(bedrag) <span class="hljs-keyword">FROM</span> boetes <span class="hljs-keyword">WHERE</span> spelersnr = @snr
    <span class="hljs-keyword">UPDATE</span> spelers <span class="hljs-keyword">SET</span> som_boetes = @boete
    <span class="hljs-keyword">WHERE</span> spelersnr = @snr
</span></code></pre>
<p><strong>Opmerking:</strong> deze trigger werkt enkel indien de update of deletes gegarandeerd één per één gebeuren wegens:</p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> @snr = spelersnr <span class="hljs-keyword">from</span> deleted
</span></code></pre>
<p>Kan deze trigger ook gebruikt worden voor insert?</p>
<h3><a id="Opmerkingen_744"></a>Opmerkingen</h3>
<p>Naast verschillen in syntax; verschillen de SQL-producten tevens voor wat de <strong>functionaliteit van triggers.</strong> Enkele interessante vragen hierbij:</p>
<ul>
<li>Mogen voor één tabel en een bepaalde mutatie meerdere triggers
gedefinieerd worden?
<ul>
<li><strong>volgordeproblemen die invloed kunnen hebben op het resultaat</strong></li>
</ul>
</li>
<li>Kan de verwerking van een instructie die behoort tot een trigger-actie
leiden tot het activeren van een andere trigger?
<ul>
<li><strong>één mutatie in een applicatie kan leiden tot een waterval van mutaties, recursie</strong></li>
</ul>
</li>
<li>Wanneer wordt nu precies een trigger-actie verwerkt?
<ul>
<li><strong>direct na de mutatie of pas voor de COMMIT-instructie</strong></li>
</ul>
</li>
<li>Mogen triggers gedefinieerd worden op catalogustabellen?
<ul>
<li><strong>je kan geen trigger instellen op een catalogustabel</strong></li>
</ul>
</li>
</ul>
<h2><a id="OOBDMS_en_ORDBMS_757"></a>OOBDMS en ORDBMS</h2>
<hr>
<h3><a id="Inleiding_tot_ORDBMS_759"></a>Inleiding tot ORDBMS</h3>
<ul>
<li>relationele DBMS is dominant
<ul>
<li>markt van ong. US$10 miljard/jaar (US$25 miljard met tools e.d.)</li>
</ul>
</li>
<li>OO DBMS markt is klein
<ul>
<li>kwam snel op tussen 1995 en 2000, maar is daarna gestagneerd.</li>
<li>er wordt niet verwacht dat dit de markt van RDBMS zal overnemen</li>
</ul>
</li>
<li>RDBMS verkopers zijn zich bewust van
<ul>
<li>de mogelijkheden van OODBMS</li>
<li>de mogelijke negatieve impact op hun product</li>
<li>de nood aan extra functionaliteit in hun producten om geavanceerde DB applicaties te ontwikkelen</li>
</ul>
</li>
<li>RDBMS verkopers
<ul>
<li>geloven dat het relationeel model kan uitgebreid worden zodat complexere applicaties kunnen ontwikkeld worden</li>
<li>geloven dat deze applicaties nog performant genoeg zullen zijn</li>
<li>voegen OO kenmerken toe aan het relationeel model</li>
</ul>
</li>
</ul>
<p><strong>Enkele OO uitbreidingen</strong></p>
<ol>
<li>gebruiker gedefinieerde types</li>
<li>encapsulatie</li>
<li>overerving</li>
<li>polymorfisme</li>
<li>dynamische method binding</li>
<li>complexe objecten</li>
<li>object identiteit</li>
</ol>
<h3><a id="Realiteit_785"></a>Realiteit</h3>
<ul>
<li>er is geen standaard ‘extended’ relationeel model</li>
<li>alle modellen
<ul>
<li>hebben als basis relationele tabellen en query language</li>
<li>hebben 1 of ander concept van object</li>
<li>kunnen methodes opslaan</li>
</ul>
</li>
<li>ORDBMS behouden de opgebouwde kennis rond RDBMS</li>
<li>aantrekkelijk alternatief
<ul>
<li>sommigen voorspellen dat het aandeel van ORDBMS op de DB markt meer dan 50%
groter zal zijn dan die van RDBMS</li>
</ul>
</li>
</ul>
<h3><a id="Stonebrakers_View_796"></a>Stonebraker’s View</h3>
<p><img src="http://puu.sh/poi0k/a7890f8b7b.jpg" alt="alt text" title="Stonebrakers View"></p>
<h3><a id="Voordelen_van_ORDBMS_798"></a>Voordelen van ORDBMS</h3>
<ul>
<li>Oplossing voor de <strong>grote zwaktes van het relationele model</strong>
<ul>
<li>zwakke representatie van ‘real-world’ entiteiten</li>
<li>semantische overloading
<ul>
<li>‘relatie’ is enige constructie; hoe maak je het verschil tussen de relaties ‘heeft’, ‘bevat’, ‘beheert’,
…</li>
</ul>
</li>
<li>zwakke ondersteuning voor integriteit en andere constraints</li>
<li>homogene data structuur
<ul>
<li>atomaire waarden, geen samengestelde waarden</li>
</ul>
</li>
<li>beperkte operaties
<ul>
<li>geen zelf gedefinieerde operaties</li>
</ul>
</li>
<li>geen recursie</li>
<li>impedance mismatch (zie verder)</li>
</ul>
</li>
<li><strong>hergebruik en delen</strong>
<ul>
<li>uitbreiden van de server functionaliteit om functionaliteit centraal uit te voeren</li>
<li>de centraal gedefinieerde functionaliteit kan nu gebruikt worden door alle applicaties
<ul>
<li>voorbeeld: voor applicaties die met punten en lijnen werken bevat de server de functionaliteit om
afstanden te berekenen, dit hoeft nu niet in elke applicatie te gebeuren</li>
</ul>
</li>
</ul>
</li>
<li>met als gevolg een <strong>hogere productiviteit</strong></li>
<li>behoud van <strong>expertise en kennis</strong> van RDBMS
<strong>backwards compatibility</strong>
<ul>
<li>mogelijkheid om als business geleidelijke overstap te maken van RDBMS naar
ORDBMS
<ul>
<li>bij OODBMS is deze geleidelijke overschakeling onmogelijk</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a id="Nadelen_van_ORDBMS_823"></a>Nadelen van ORDBMS</h3>
<ul>
<li><strong>complexiteit</strong> van het OR model
<ul>
<li><strong>eenvoud en puurheid</strong> van het relationeel model gaat verloren</li>
</ul>
</li>
<li>verhoogde <strong>kosten</strong></li>
<li>enkel een klein deel van de applicaties kan gebruik maken van de object
extensies</li>
<li>het is <strong>niet puur OO</strong>
<ul>
<li>OO applicaties zijn niet zo data gecentreerd</li>
<li>in pure OO zijn objects first class citizens, geen extensies van het relationele model</li>
</ul>
</li>
<li><strong>SQL is te complex</strong> geworden</li>
</ul>
<h3><a id="Impedance_mismatch_834"></a>Impedance mismatch</h3>
<p><img src="http://puu.sh/poiC8/d53aca713e.jpg" alt="alt text" title="Impendance mismatch"></p>
<p><strong>Alternatief voor OO BDMS of OR DBMS:</strong></p>
<ul>
<li>OR-mapping, vb.
<ul>
<li>.NET: Entity Framework, NHibernate</li>
<li>JPA: Java Persistence API</li>
<li>Java: Hibernate</li>
</ul>
</li>
</ul>
<h2><a id="User_Defined_Types_843"></a>User Defined Types</h2>
<hr>
<h3><a id="UDT_845"></a>UDT</h3>
<ul>
<li>~abstract data types</li>
<li>kunnen gebruikt worden als built-in types</li>
<li>2 soorten
<ul>
<li>distinct types</li>
<li>structured types</li>
</ul>
</li>
<li>Ondanks de SQL:2008-standaard, toch heel
veel verschillen tussen DMBS’en</li>
<li>In deze cursus: enkel bestaande syntax in
grote DBMS’en.</li>
</ul>
<h3><a id="Distinct_type_856"></a>Distinct type</h3>
<p>Is gebasseerd op een <strong>basis type</strong> en laat toe <strong>onderscheid</strong> aan te brengen tussen anders gelijke basistypes.</p>
<p>Voorbeeld (MS-SQL Server):</p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TYPE</span> IDType <span class="hljs-keyword">FROM</span> <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>;</span>
<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TYPE</span> NameType <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">NVARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>;</span>
<span class="hljs-comment">-- NameType = Distinct Type</span>
<span class="hljs-comment">-- NVARCHAR(50) = Het basistype waarvan het DT is afgeleid</span>
</code></pre>
<blockquote>
<p>Het nieuwe type wordt opgeslagen in de datbank</p>
</blockquote>
<blockquote>
<p>Het distinct type kan nu gebruikt worden net zoals een built-in datatype</p>
</blockquote>
<p>Gebruik:
<img src="http://puu.sh/pojiE/d50fbb60b1.png" alt="alt text" title="Gebruik Distinct Types"></p>
<h3><a id="Structured_Types_873"></a>Structured Types</h3>
<ol>
<li>Table types</li>
<li>Abstract data types (cf. OO)</li>
</ol>
<h3><a id="Table_Types_877"></a>Table Types</h3>
<p><strong>MS SQL Server</strong></p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TYPE</span> TotaalOrdersPerJaar <span class="hljs-keyword">AS</span> <span class="hljs-keyword">TABLE</span>
(
    jaar <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,
    hoeveelheid <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
);</span>

<span class="hljs-operator"><span class="hljs-keyword">DECLARE</span> @mijnordersperjaar <span class="hljs-keyword">AS</span> TotaalOrdersPerJaar;</span>

<span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> @mijnordersperjaar
<span class="hljs-keyword">select</span> <span class="hljs-keyword">year</span>(orderdate) <span class="hljs-keyword">as</span> jaar,<span class="hljs-keyword">round</span>(<span class="hljs-keyword">sum</span>(unitprice*quantity*(<span class="hljs-number">1</span>-
discount)),<span class="hljs-number">2</span>)
<span class="hljs-keyword">from</span> orders o <span class="hljs-keyword">join</span> orderdetails od
<span class="hljs-keyword">on</span> o.OrderID=od.orderid
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">year</span>(orderdate);</span>

<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> @mijnordersperjaar;</span>

<span class="hljs-comment">-- Ook: Rechtstreeks variabele declareren:</span>
<span class="hljs-operator"><span class="hljs-keyword">DECLARE</span> @mijnordersperjaar <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">TABLE</span>
(
    jaar <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> PRIMARY <span class="hljs-keyword">KEY</span>,
    hoeveelheid <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>
);</span>

</code></pre>
<h6><a id="Tables_Types_en_Variables_906"></a>Tables Types en Variables</h6>
<ul>
<li>table types worden opgeslagen in de DB</li>
<li>table variables bestaan slechts voor de duur van de batch (sequentie van statements)</li>
</ul>
<p>Voordelen gebruik table variables:</p>
<ul>
<li>kortere en overzichtelijker code</li>
<li>table type variabelen kunnen ook als parameter doorgegeven worden aan stored procedure en functions</li>
</ul>
<h3><a id="Abstract_Data_Types_915"></a>Abstract Data Types</h3>
<ul>
<li>in het algemeen bevat een Abstract Data Type
<ul>
<li>definitie van <strong>attributen</strong></li>
<li>definitie van <strong>routines (methodes)</strong></li>
</ul>
</li>
<li>benamingen:
<ul>
<li>abstract data types (ADT)</li>
<li>user defined types (UDT)</li>
<li>object types</li>
</ul>
</li>
<li>= object-relationele aspecten</li>
</ul>
<p>Voorbeeld: (Oracle, niet beschikbaar in MS SQL Server)</p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TYPE</span> customer_typ_demo <span class="hljs-keyword">AS</span> <span class="hljs-keyword">OBJECT</span>
    ( customer_id <span class="hljs-built_in">NUMBER</span>(<span class="hljs-number">6</span>)
    , cust_first_name VARCHAR2(<span class="hljs-number">20</span>)
    , cust_last_name VARCHAR2(<span class="hljs-number">20</span>)
    , cust_address CUST_ADDRESS_TYP
    , phone_numbers PHONE_LIST_TYP
    , nls_language VARCHAR2(<span class="hljs-number">3</span>)
    , nls_territory VARCHAR2(<span class="hljs-number">30</span>)
    , credit_limit <span class="hljs-built_in">NUMBER</span>(<span class="hljs-number">9</span>,<span class="hljs-number">2</span>)
    , cust_email VARCHAR2(<span class="hljs-number">30</span>)
    , cust_orders ORDER_LIST_TYP
) ;</span>
</code></pre>
<h3><a id="Subtypes_supertypes_en_methodes_940"></a>Subtypes, supertypes en methodes</h3>
<p>Via <strong>UNDER</strong> kunnen <strong>subtypes/supertype</strong> verbanden gedefinieerd worden.</p>
<ul>
<li>geen multiple inheritance</li>
<li>subtype erft
<ul>
<li>attributen</li>
<li>methodes</li>
</ul>
</li>
<li>het subtype kan
<ul>
<li>uitgebreid worden via definitie nieuwe attributen/methodes</li>
<li>gespecialiseerd worden via overloading</li>
</ul>
</li>
<li>een supertype kan altijd door zijn subtype
gesubstitueerd worden</li>
<li>Men kan aan een ADT methodes toevoegen en deze implementeren in het CREATE TYPE BODY statement</li>
</ul>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TYPE</span> data_typ1 <span class="hljs-keyword">AS</span> <span class="hljs-keyword">OBJECT</span>
(
    <span class="hljs-keyword">year</span> <span class="hljs-built_in">NUMBER</span>,
    <span class="hljs-keyword">MEMBER</span> <span class="hljs-keyword">FUNCTION</span> prod(invent <span class="hljs-built_in">NUMBER</span>) <span class="hljs-keyword">RETURN</span> <span class="hljs-built_in">NUMBER</span>
);</span>

<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TYPE</span> <span class="hljs-keyword">BODY</span> data_typ1 <span class="hljs-keyword">IS</span>
    <span class="hljs-keyword">MEMBER</span> <span class="hljs-keyword">FUNCTION</span> prod (invent <span class="hljs-built_in">NUMBER</span>) <span class="hljs-keyword">RETURN</span> <span class="hljs-built_in">NUMBER</span> <span class="hljs-keyword">IS</span>
        <span class="hljs-keyword">BEGIN</span>
            <span class="hljs-keyword">RETURN</span> (<span class="hljs-keyword">year</span> + invent);</span>
        <span class="hljs-operator"><span class="hljs-keyword">END</span>;</span>
    <span class="hljs-operator"><span class="hljs-keyword">END</span>;</span> 
</code></pre>
<ul>
<li>Subtypes (cf. inheritance): onderstaand voorbeeld creëert het sybtype
corporate_customer_typ, afgeleid van het supertype customer_typ (zie vorige
slide) en voegt het account_mgr_id attribuut toe:</li>
</ul>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TYPE</span> corporate_customer_typ_demo 
    <span class="hljs-keyword">UNDER</span> customer_typ ( account_mgr_id <span class="hljs-built_in">NUMBER</span>(<span class="hljs-number">6</span>) );</span>
</code></pre>
<h3><a id="Structured_Types_974"></a>Structured Types</h3>
<ul>
<li>NOT FINAL: Er kunnen nog subtypes gecreëerd worden</li>
<li>FINAL (default): Er kunnen geen subtypes gecreëerd worden</li>
</ul>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TYPE</span> person_t <span class="hljs-keyword">AS</span> <span class="hljs-keyword">OBJECT</span> (<span class="hljs-keyword">name</span> VARCHAR2(<span class="hljs-number">100</span>), ssn <span class="hljs-built_in">NUMBER</span>,
<span class="hljs-keyword">MEMBER</span> <span class="hljs-keyword">FUNCTION</span> get_name <span class="hljs-keyword">RETURN</span> VARCHAR2(<span class="hljs-number">100</span>)) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">FINAL</span>;</span>

<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TYPE</span> <span class="hljs-keyword">BODY</span> person_t <span class="hljs-keyword">IS</span>
<span class="hljs-keyword">MEMBER</span> <span class="hljs-keyword">FUNCTION</span> get_name() <span class="hljs-keyword">RETURN</span> VARCHAR2(<span class="hljs-number">100</span>) <span class="hljs-keyword">IS</span>
        <span class="hljs-keyword">BEGIN</span>
            <span class="hljs-keyword">RETURN</span> <span class="hljs-keyword">name</span>;</span>
        <span class="hljs-operator"><span class="hljs-keyword">END</span>;</span>
    <span class="hljs-operator"><span class="hljs-keyword">END</span>;</span>
<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TYPE</span> employee_t <span class="hljs-keyword">UNDER</span> person_t (department_id <span class="hljs-built_in">NUMBER</span>, salary <span class="hljs-built_in">NUMBER</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">FINAL</span>;</span>

<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TYPE</span> part_time_emp_t <span class="hljs-keyword">UNDER</span> employee_t (num_hrs <span class="hljs-built_in">NUMBER</span>)
<span class="hljs-keyword">FINAL</span>;</span>
</code></pre>
<p>Gebruik:</p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> contacts (
    contact person_t,
    contact_date <span class="hljs-built_in">DATE</span> );</span>
<span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> contacts <span class="hljs-keyword">VALUES</span> (
    person_t (<span class="hljs-string">'John Smith'</span>,<span class="hljs-number">12586982</span>),
    <span class="hljs-keyword">to_date</span>(<span class="hljs-string">'24 Jun 2003'</span>, <span class="hljs-string">'dd Mon YYYY'</span>));</span>
<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">c</span>.contact.get_name() <span class="hljs-keyword">FROM</span> contacts <span class="hljs-keyword">c</span>;</span>
</code></pre>
<h2><a id="Large_Objects_1003"></a>Large Objects</h2>
<hr>
<blockquote>
<p>Een large object is een <strong>datatype die een grote
hoeveelheid aan data kan vasthouden</strong>
– tekstbestand, afbeelding, muziek, video, web-pagina</p>
</blockquote>
<p>Soorten:</p>
<ul>
<li><strong>BLOB</strong>
<ul>
<li>Binary Large OBject</li>
</ul>
</li>
<li><strong>CLOB</strong>
<ul>
<li>Character Large OBject</li>
</ul>
</li>
<li><strong>NCLOB</strong>
<ul>
<li>National Character Large OBject</li>
</ul>
</li>
</ul>
<p><strong>Probleem</strong> met LOB’s die nu in verschillende DBMS
gebruikt worden</p>
<ul>
<li>LOB’s worden aanzien als byte-stream</li>
<li><strong>DBMS</strong> kan zelf <strong>niets doen</strong> met het LOB
<ul>
<li>DBMS kent de inhoud, de interne structuur niet</li>
<li>nochtans is het LOB dikwijls heel gestructureerd
<ul>
<li>gestructureerde tekst, web-pagina, …</li>
</ul>
</li>
</ul>
</li>
<li>nadelige transfer van LOB’s op server naar client over het netwerk</li>
</ul>
<p>Voorbeeld (MS SQL Server)</p>
<ul>
<li>BLOB data types:
<ul>
<li>varbinary(max) en image (image = deprecated)</li>
</ul>
</li>
<li>CLOB data types (ASCII data):
<ul>
<li>varchar(max)</li>
</ul>
</li>
<li>NCLOB data types (unicode data):
<ul>
<li>nvarchar(max)</li>
</ul>
</li>
</ul>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> Employees
<span class="hljs-keyword">ADD</span> cv <span class="hljs-built_in">varchar</span>(<span class="hljs-keyword">max</span>);</span>
<span class="hljs-operator"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> Employees
<span class="hljs-keyword">ADD</span> foto varbinary(<span class="hljs-keyword">max</span>);</span>
</code></pre>
<hr>
<h1><a id="Hoofdstuk_6_Indexen_en_performantie_1041"></a>Hoofdstuk 6: Indexen en performantie</h1>
<hr>
<h3><a id="Space_Allocation_Door_SQL_Server_1043"></a>Space Allocation Door SQL Server</h3>
<ul>
<li>SQL Server gebruikt Random Access File</li>
<li>Space allocation in <em>extents</em> en <em>pages</em>
<ul>
<li>Page = 8kB blok aaneensluitende space</li>
<li>Extent = 8 logisch opeenvolgende pages
<ul>
<li>Uniform extents: voor 1 db-object</li>
<li>mixed extents: kunnen gedeeld worden door 8db-objecten. (=tabellen, indexen)</li>
</ul>
</li>
</ul>
</li>
<li>Nieuwe tabel of index: allocatie in mixed extent</li>
<li>Uitbreiding &gt; 8 pages: in uniform extent</li>
</ul>
<h3><a id="Table_scan_1054"></a>Table scan</h3>
<blockquote>
<p><strong>Heap:</strong> ongeordene verzameling van data-pages zonder clustered index (zie verder) (= Standaard opslag van een tabel)</p>
</blockquote>
<p>Toegang via Index Allocation Map (IAM)
Table Scan: als een query pages ophaalt --&gt; Dit is altijd te vermijden!</p>
<p><strong>Performantie issues met Heap</strong></p>
<ul>
<li><strong>Fragmentatie</strong>: tabel staat verspreid over verschillende, niet-opeenvolgende pages</li>
<li><strong>Forward pointers</strong>: als een rij met variabele lengte (vb. varchar-velden) wordt geupdatet waardoor ze langer wordt, wordt een forward pointer ingevoegd naar een andere pagina enz… -&gt; Table Scan wordt nog trager.</li>
</ul>
<p><strong>–&gt; Oplossing: Indexen</strong></p>
<h3><a id="Indexen_1066"></a>Indexen</h3>
<p><strong>Wat?:</strong>
een <em>geordende structuur</em> die op de records uit een tabel wordt gelegd en <em>snelle toegang biedt via boomstructuur</em> (B-tree)</p>
<p><strong>Waarom?:</strong> kan <em>toegang tot data versnellen</em> en kan de <em>uniciteit van rijen</em> afdwingen</p>
<p><strong>Waarom niet?:</strong> Indexen nemen opslagruimte in beslag <em>(overhead)</em> en ze kunnen de performantie ook doen dalen (bv vertragen van select en updates)</p>
<h5><a id="SQL_Optimizer_1075"></a>SQL Optimizer</h5>
<blockquote>
<p>Is een <strong>module in elk DBMS</strong> die elk SQL commando dat naar de DB gestuurd wordt, analyseert en herformuleert en beslist op basis van statistische gegevens welke indexen zullen gebruikt worden.</p>
</blockquote>
<h3><a id="Clustered_Index_1078"></a>Clustered Index:</h3>
<p>De fysische volgorde van de rijen in een tabel is deze van een clustered index. Elke tabel kan slechts 1 clustered index hebben, deze legt unieke waarden op en heeft primary key constraint.</p>
<p><strong>Voordelen t.o.v. Table Scan:</strong></p>
<ul>
<li>Dubbel gelinkte lijst zorgt voor volgorde bij het lezen van sequentiële records.</li>
<li>Geen forward pointers</li>
</ul>
<h3><a id="NonClustered_Index_1085"></a>Non-Clustered Index</h3>
<p>Deze is de <strong>default index</strong> en werkt trager dan de clustered index. Meerdere per tabel mogelijk. Elke <em>leaf</em> bevat sleutel waarde en row locator. --&gt; Naar positie in clustered index als die bestaat, anders naar heap.</p>
<p>Als een query meer velden nodig heeft dan aanweziginde index, dan moeten deze opgehaald worden uit de datapages.</p>
<p>Bij het lezen via non-clustered index:</p>
<ul>
<li><em>Ofwel:</em> RID (Row ID) lookup = bookmark lookups naar de heap adhv RID.</li>
<li><em>Ofwel:</em> Key lookup = bookmark lookups naar een clustered index.</li>
</ul>
<h3><a id="Covering_index_1095"></a>Covering index</h3>
<p>Als een non-clustered idnex een query niet volledig afdekt/covert dan moet SQL Server voor elke rij een lookup doen om de data op te halen.</p>
<blockquote>
<p><strong>Een covering index is</strong> een <em>non-clustered</em> index die alle kolommen bevat die nodig zijn voor een bepaalde query.</p>
</blockquote>
<p>Met SQL Server kan je extra komommen laten opnemen in de index (waarop niet geïndexeerd wordt)</p>
<p><strong>Covering index via include:</strong> </p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> NONCLUSTERED <span class="hljs-keyword">INDEX</span>
[IX_Covering_Person_LastName_FirstName_MiddleName] 
<span class="hljs-keyword">ON</span> [Person].[Person]
(
    [LastName] <span class="hljs-keyword">ASC</span>,
    [FirstName] <span class="hljs-keyword">ASC</span>,
    [MiddleName] <span class="hljs-keyword">ASC</span>
) <span class="hljs-keyword">INCLUDE</span> (Title);</span>
</code></pre>
<h3><a id="1_index_met_meerdere_kolommen_vs_meerdere_indexen_met_1_kolom_1115"></a>1 index met meerdere kolommen vs. meerdere indexen met 1 kolom?</h3>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> NONCLUSTERED <span class="hljs-keyword">INDEX</span> IX_Person_LastName_FirstName <span class="hljs-keyword">ON</span>
Person.Person (LastName, FirstName)
</span></code></pre>
<p><strong>Versus</strong></p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> NONCLUSTERED <span class="hljs-keyword">INDEX</span> IX_Person_LastName <span class="hljs-keyword">ON</span>
Person.Person (LastName)
<span class="hljs-comment">-- en</span>
<span class="hljs-keyword">CREATE</span> NONCLUSTERED <span class="hljs-keyword">INDEX</span> IX_Person_FirstName <span class="hljs-keyword">ON</span>
Person.Person (FirstName)
</span></code></pre>
<p><strong>Regel in SQL Server:</strong>
Bij query (bijv. where-clause) op enkel 2de en/of 3de
,
…veld van de index, wordt de index niet gebruikt.
Dus bij:</p>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> LASTNAME,FIRSTNAME
<span class="hljs-keyword">FROM</span> PERSON.PERSON
<span class="hljs-keyword">WHERE</span> FIRSTNAME = <span class="hljs-string">'Chris'</span>;</span>
</code></pre>
<p>wordt de dubbele index niet gebruikt!
<strong>Conclusie: kijk naar de meest gebruikte query’s en
stem daar je indexen op af.</strong></p>
<h3><a id="Creatie_van_indexen_algemene_syntax_1143"></a>Creatie van indexen: algemene syntax</h3>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> [<span class="hljs-keyword">UNIQUE</span>] [CLUSTERED | NONCLUSTERED] <span class="hljs-keyword">INDEX</span> index_naam 
<span class="hljs-keyword">ON</span> tabel (kolom [,...<span class="hljs-keyword">n</span>])
<span class="hljs-comment">-- UNIQUE: geeft aan dat alle waarden in geïndexeerde kolom uniek moeten zijn. </span>

<span class="hljs-comment">-- voorbeeld</span>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">index</span> rijksregNr_Index <span class="hljs-keyword">on</span> student(rijksregNr)
</span></code></pre>
<p><strong>Let op:</strong></p>
<ol>
<li>Bij het definiëren van een index mag de tabel leeg of al gevuld zijn.</li>
<li>Kolommen met een <strong>UNIQUE</strong> index moeten de not null constraint bevatten.</li>
</ol>
<h3><a id="Verwijderen_van_indexen_1158"></a>Verwijderen van indexen</h3>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">INDEX</span> table_name.<span class="hljs-keyword">index</span> [,...<span class="hljs-keyword">n</span>]

<span class="hljs-comment">--voorbeeld</span>
<span class="hljs-keyword">drop</span> <span class="hljs-keyword">index</span> student.rijksregNr_Index
</span></code></pre>
<h3><a id="Wanneer_gebruiken_1166"></a>Wanneer gebruiken?</h3>
<ul>
<li>Welke kolommen indexeren we <strong>wel</strong>?
<ul>
<li>primaire en unique kolommen worden automatisch geïndexeerd</li>
<li>vreemde sleutels vaak gebruikt in joins</li>
<li>kolommen vaak gebruikt in zoek condities of in joins</li>
<li>kolommen vaak gebruikt in ORDER BY clause</li>
</ul>
</li>
<li>Welke kolommen indexeren we <strong>niet</strong>?
<ul>
<li>kolommen die zelden voorkomen in queries</li>
<li>kolommen met een klein aantal mogelijke waarden (vb. geslacht)</li>
<li>kolommen in kleine tabellen</li>
<li>kolommen van het type bit, text of image</li>
</ul>
</li>
</ul>
<hr>
<h1><a id="Hoofdstuk_7_Transactiebeheer_1179"></a>Hoofdstuk 7: Transactiebeheer</h1>
<h3><a id="Inleiding_1180"></a>Inleiding</h3>
<hr>
<p>Een <strong>DBMS</strong> ondersteunt:</p>
<ul>
<li>Transaction Support</li>
<li>Concurrency control services</li>
<li>Recovery Services</li>
</ul>
<p>En is bedoeld om de DB in een <strong>betrouwbare</strong> en <strong>consistente</strong> toestande te houden bij zowel software als hardwarde failures, en bij gelijktijdig gebruik door meerdere gebruikers.</p>
<h3><a id="Transacties_1189"></a>Transacties</h3>
<hr>
<blockquote>
<p>Een <strong>transactie</strong> is een actie, of opeenvolging van acties op een db die <strong>1 logsich geheel</strong> vormen.</p>
</blockquote>
<p><strong>Actie:</strong> lezen of wijzigen van de inhoud van de DB.</p>
<p>Een transactie wordt uitgevoerd door een gebruiker of door een programma.</p>
<p>Het is een logische hoeveelheid van werk: volledig programma, deel van een programma, enkel opdracht. (Programma = 1 of meerdere transacties, met daartussen niet-db verwerking.</p>
<h5><a id="Voorbeelden_1199"></a>Voorbeelden:</h5>
<p><strong>Transactie:</strong> updaten van het salaris van een werknemer.
<img src="http://puu.sh/poRut/2310b75d44.png" alt="alt text" title="Voorbeeld read/write"></p>
<p>Opeenvolging van ‘high level’ acties:</p>
<ul>
<li>Notatie: read(…) en write(…)
<ul>
<li>read: lees een data item uit de DB in een lokale variabele</li>
<li>write: schrijf de waarde van een lokale variabele weg naar de DB.</li>
</ul>
</li>
<li>Er zijn 2 DB operaties en niet 1.</li>
</ul>
<hr>
<p><strong>Transactie:</strong> verwijderen van een werknemer en zijn properties aan een andere werknemer toekennen.</p>
<p><img src="http://puu.sh/poREW/a34962c08e.png" alt="alt text" title="Voorbeeld verwijderen"></p>
<p>Deze transactie brengt de DB van de ene consistente toestand naar de andere consistente toestand. <strong>! Tijdens</strong> de transactie is de DB mogelijks in een inconsistente toestand.  (bv. een aantal properties staan reeds bij newStaffNo, de andere nof bij staffNo)</p>
<h3><a id="Resultaat_van_een_Transactie_1216"></a>Resultaat van een Transactie</h3>
<h5><a id="Commited__Aborted_1217"></a>Commited / Aborted</h5>
<p><strong>Commited:</strong></p>
<ul>
<li>de transactie kent een <strong>succesvolle afloop</strong>.</li>
<li>de transactie <em>commits</em> en de DB heeft een consistente toestand bereikt.</li>
<li>commited transactie <strong>kan nooit aborted worden</strong>, wanneer de commited transactie vergissing blijkt, kan een andere compenserende transactie gebruikt worden.</li>
</ul>
<p><strong>Aborted</strong></p>
<ul>
<li>de transactie is <strong>niet succesvol</strong></li>
<li>de transactie <em>aborts</em> en DB moet teruggebracht worden naar de consistente toestand waarin ze zich bevond voor de transactie werd gestart --&gt; <strong>rollback of undo</strong></li>
<li>aborted transactie <strong>kan herstart</strong> worden: <strong>na de rollback</strong> kan een <strong>restart</strong> van de transactie gebeuren. Bij succesvolle uitvoering zal dit nu leiden tot een committed transactie.</li>
<li></li>
</ul>
<h3><a id="Aanduidingen_1228"></a>Aanduidingen</h3>
<p>We moeten duidelijk maken aan het DMBS welke acties deel uitmaken van een transactie.</p>
<p>Keywords:</p>
<pre><code class="language-SQL">- <span class="hljs-operator"><span class="hljs-keyword">BEGIN</span> <span class="hljs-keyword">TRANSACTION</span>
<span class="hljs-comment">-- soms impliciet de eerste DB actie</span>

– <span class="hljs-keyword">COMMIT</span>
– <span class="hljs-keyword">ROLLBACK</span>
</span></code></pre>
<p>Zonder genige expliciete aanduiding kan het ganse programma beschouwd worden als 1 transactie.</p>
<h3><a id="ACID_Eigenschappen_1241"></a>ACID Eigenschappen</h3>
<p><strong>Atomicity:</strong></p>
<ul>
<li>de opdrahten van een transactie worden als één ondeelbaar geheel beschouwd. --&gt; Alles of niets</li>
<li>DBMS verantwoordelijkheid: recovery subsysteem</li>
</ul>
<p><strong>Consistency:</strong></p>
<ul>
<li>een transactie brengt de DB van de ene consistente toestand naar een andere consistente toestand.</li>
<li>DBMS verantwoordelijheid én programma verantwoordelijkheid</li>
</ul>
<p><strong>Isolation:</strong></p>
<ul>
<li>transacties worden onafhankelijk van elkaar uitgevoerd</li>
<li>transacties mogen niet ongewenst interfereren met elkaar.</li>
<li>transacties mogen geen uitkomsten aan andere transacties presenteren voor de commit.</li>
<li>DBMS verantwoordelijkheid: concurrency-control subsysteem.</li>
</ul>
<p><strong>Durability:</strong></p>
<ul>
<li>Na een COMMIT zijn de aangebrachte wijzigingen gegarandeerd permanent.</li>
<li>Na een storing kunnen deze wijzigingen steeds worden gerecupureerd.</li>
<li>DBMS verantwoordelijkheid: recovery subsystem.</li>
</ul>
<h3><a id="Databank_Architectuur_1261"></a>Databank Architectuur</h3>
<p><img src="http://puu.sh/poTCC/55ec584625.jpg" alt="alt text" title="Architectuur schema"></p>
<h5><a id="Transaction_Subsysteem_1263"></a>Transaction Subsysteem</h5>
<ol>
<li><strong>Transaction manager</strong>
<ul>
<li>Coördineert transacties van programma’s</li>
</ul>
</li>
<li><strong>Scheduler</strong>
<ul>
<li>implementeert strategie voor concurrency control</li>
<li>aka lock manager bij een op locking gebaseerde strategie</li>
<li>doel: concurrency maximal</li>
</ul>
</li>
<li><strong>Recovery manager</strong>
<ul>
<li>bij failures brengt deze de db terug in consistente toestand (~vóór de transactie gestart werd)</li>
</ul>
</li>
<li><strong>Buffer manager</strong>
<ul>
<li>verantwoordelijk voor efficiënte transfer van data tussen main memory en
disk storage</li>
</ul>
</li>
</ol>
<h2><a id="Concurrency_1275"></a>Concurrency</h2>
<hr>
<h3><a id="Concurrency_control_1277"></a>Concurrency control</h3>
<blockquote>
<p><strong>Concurrency control</strong>
is het <strong>beheer van gelijktijdige</strong> acties op de db zonder
dat ze interfereren met elkaar</p>
</blockquote>
<p>Een DBMS laat toe dat <strong>merdere transacties gelijktijdig toegang</strong> hebben tot <strong>gedeelde data</strong>.</p>
<ul>
<li>Wanneer verschillende transacties <strong>enkel data lezen</strong> rijzen er <strong>geen problemen</strong>.</li>
<li>Wanneer minstens 1 transactie <strong>data wijzigt</strong> kunnen <strong>wel problemen</strong> optreden.</li>
</ul>
<p><strong>Concurrency</strong> wordt gerealiseerd door de acties van verschillende transacties te verweven.</p>
<h3><a id="Waarom_concurrency_control_1288"></a>Waarom concurrency control?</h3>
<p>–&gt; <strong>Voorkom interferentie</strong> wanneer twee of meerere transacties de databanke gelijktijdig aanspreken, en minstens 1 transactie data <strong>wijzigt</strong></p>
<p>Hoewel twee transacties op zichzelf beschouwd correct kunnen zijn, kan het verweven van hun acties leiden tot een incorrect resultaat.</p>
<h2><a id="Problemen_bij_concurrency_1293"></a>Problemen bij concurrency</h2>
<hr>
<h3><a id="Lost_update_1295"></a>Lost update</h3>
<blockquote>
<p>Het <strong>lost update probleem</strong> treedt op wanneer
een schijnbaar compleet succesvolle update van een transactie
wordt <strong>overschreven</strong> door een andere transactie</p>
</blockquote>
<h3><a id="Uncommitted_dependency_1300"></a>Uncommitted dependency</h3>
<blockquote>
<p>Het <strong>uncommitted dependency (of dirty read) probleem</strong>
treedt op wanneer
een transactie de <strong>intermediaire resultaten van een andere</strong>,
uncommitted transactie, kan zien.</p>
</blockquote>
<h3><a id="Inconsistent_Analysis_1306"></a>Inconsistent Analysis</h3>
<blockquote>
<p>Het <strong>inconsistent analysis probleem</strong> treedt op wanneer
een transactie <strong>verschillende waarden uit de db leest</strong>, terwijl een
andere transactie bezig is sommige van <strong>deze waarden te
veranderen</strong></p>
</blockquote>
<h5><a id="Gerelateerde_problemen_1312"></a>Gerelateerde problemen</h5>
<ul>
<li><strong>Non-repeatable (of fuzzy) read</strong>
<ul>
<li>twee keer lezen van eenzelfde item levert twee
verschillende waarden op
<ul>
<li>een transactie leest een data item, die het reeds eerder
uitlas, nogmaals uit en krijgt nu een andere waarde</li>
</ul>
</li>
</ul>
</li>
<li><strong>Phantom read</strong>
<ul>
<li>een transactie leest een aantal records die voldoen
aan een bepaalde voorwaarde</li>
<li>de transactie herhaalt dit later maar merkt nu dat er
ondertussen andere records zijn bijgekomen via een
andere transactie</li>
</ul>
</li>
</ul>
<h3><a id="Serializibility__Recoverability_1325"></a>Serializibility &amp; Recoverability</h3>
<ul>
<li><strong>concurrency control protocol</strong>
<ul>
<li>doel: transacties zo schedulen zodat ze niet interfereren</li>
<li>resultaat: voorgaande problemen treden niet op</li>
</ul>
</li>
<li>triviale oplossing
<ul>
<li>voer transacties serieel uit
<ul>
<li>ten allen tijde is er maar 1 transactie in uitvoering</li>
<li>groot nadeel: performantie (geen concurrency of parallellisme)</li>
</ul>
</li>
</ul>
</li>
<li><strong>serializability</strong>
<ul>
<li>bestaat er in die uitvoeringen van transacties te identificeren
waarbij geen interferentie optreedt
<ul>
<li>uitvoeringen die equivalent zijn aan een seriële uitvoering</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a id="Schedule_1338"></a>Schedule</h3>
<blockquote>
<p>Een schedule is
<strong>een sequentie van acties van een aantal concurrente
transacties</strong> die de volgorde van de acties van de individuele
transacties respecteert</p>
</blockquote>
<p><strong>Note:</strong> Voor elke transactie in een schedule is de volgorde van de operaties in
de schedule, dezelfde als de volgorde van de operaties in de
transactie zelf</p>
<h3><a id="Recoverability_1348"></a>Recoverability</h3>
<ul>
<li>de databank zelf <strong>schedules</strong> laten opstellen die zonder
interferentieproblemen concurrent kunnen worden uitgevoerd
<ul>
<li>ze garanderen de <strong>consistency en isolation</strong> eigenschap van transacties</li>
<li>dit is in de veronderstelling dat geen enkele van de transacties in de
schedule faalt</li>
</ul>
</li>
<li><strong>recoverability</strong>
<ul>
<li>wanneer een transactie faalt moeten we de effecten ongedaan kunnen maken
<ul>
<li><strong>atomiciteit</strong> van transacties</li>
</ul>
</li>
<li>wanneer een transactie commit zijn de veranderingen permanent
<ul>
<li><strong>durability</strong> eigenschap van transacties</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a id="Locking_1361"></a>Locking</h3>
<blockquote>
<p>Locking is een methode gebruikt om <strong>concurrente
toegang</strong> tot data te beheren.</p>
</blockquote>
<p>Wanneer een transactie toegang heeft tot de data kan er via een lock voor gezorgd worden dat <strong>andere transacties toegang tot de data geweigerd</strong> worden.</p>
<p><strong>Locking = Meest gebruikte manier</strong> om de consistentie te garanderen</p>
<h5><a id="Basisregels_locking_1369"></a>Basisregels locking</h5>
<ul>
<li>
<p>Een transactie kan een <strong>data item lezen of schrijven</strong> enkel en alleen als het een <strong>lock heeft verworven</strong> voor dat data element, en het bovendien deze lock nog niet heeft vrijgegeven.</p>
</li>
<li>
<p>Als een transactie een lock op een data item verwerft, dan moet het later ook <strong>lock terug vrijgeven</strong></p>
</li>
</ul>
<h5><a id="Soorten_Locks_1374"></a>Soorten Locks</h5>
<ul>
<li>Shared lock (S-lock)
<ul>
<li>Transactie met shared lock op data item kan dat data item <em>lezen</em> maar niet wijzigen</li>
<li>Meerdere transacties kunnen gelijktijdig een shared lock op eenzelfde data item bezitten.</li>
</ul>
</li>
<li>Exclusive lock (X-lock)
<ul>
<li>Transactie met exclusive lock op data item kan dat data item <strong>lezen en wijzigen</strong></li>
<li>Op elk ogenblik kan hoogstens 1 transactie een exclusive lock op een data item hebben.</li>
</ul>
</li>
</ul>
<p><strong><em>Opmerking</em>:</strong> een data item kan verwijzen naar een veld van een record, maar ook naar een tabel,
of de volledige db - zie verder: granulariteit</p>
<h5><a id="Praktisch_1385"></a>Praktisch</h5>
<ul>
<li>De transactie die toegang wil tot een data item vraagt een lock aan op dat
item
<ul>
<li>shared lock voor lezen, exclusive lock voor lezen/schrijven</li>
<li>wanneer er nog geen lock op dat item bestaat, wordt de aanvraag ingewilligd</li>
<li>Wanneer er reeds een lock op het item is, gaat het dbms
nagaan of de aangevraagde lock compatibel (zie matrix hieronder) is
<ul>
<li>aanvraag shared lock op item met shared lock: granted</li>
<li>aanvraag exclusive lock op item met lock: wait
<ul>
<li>de transactie moet wachten tot de lock op het data item wordt vrijgegeven</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>De transactie geeft een lock vrij
<ul>
<li>expliciet, of</li>
<li>impliciet als de transactie eindigt (via abort of commit)</li>
</ul>
</li>
</ul>
<p><strong>Compatibiliteitsmatrix:</strong></p>
<table class="table table-striped table-bordered">
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">Aangevraagde S-Lock</th>
<th style="text-align:center">Aangevraagde X-Lock</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>Bestaande S-Lock</strong></td>
<td style="text-align:center">Grant</td>
<td style="text-align:center">Wait</td>
</tr>
<tr>
<td style="text-align:center"><strong>Bestaande X-Lock</strong></td>
<td style="text-align:center">Wait</td>
<td style="text-align:center">Grant</td>
</tr>
</tbody>
</table>
<h3><a id="Deadlock_1406"></a>Deadlock</h3>
<blockquote>
<p>Een deadlock is een ** impasse** die kan ontstaan wanneer twee of meerdere transacties elk <strong>wachten</strong> op het vrijgeven van locks die de andere transactie heeft</p>
</blockquote>
<h5><a id="Oplossen_Deadlock_1409"></a>Oplossen Deadlock</h5>
<ul>
<li><strong>Abort en restart</strong> van 1 of meerdere transacties</li>
<li>Voorbeeld:</li>
</ul>
<p><img src="http://puu.sh/pp2F3/9bba9bfce6.png" alt="alt text" title="Voorbeeld Deadlock"></p>
<h5><a id="Technieken_om_met_deadlocks_om_te_gaan_1415"></a>Technieken om met deadlocks om te gaan:</h5>
<ul>
<li><strong>Timeouts:</strong> een transactie die een lock aanvraagt <strong>wacht voor een bepaalde vooraf gedefinieerde tijd op die lock</strong>, indien lock niet toegekend is tijdens dit interval:
<ul>
<li>Assumptie dat er een deadlock is (hoewel dit niet noodzakelijk zo is…)</li>
<li><strong>Abort en restart</strong> van de transactie</li>
</ul>
</li>
<li><strong>Deadlock prevention:</strong> gebruikmakend van <strong>transaction time-stamps</strong> ( speciale time-stamp voor deadlock detection). T wacht op locks die U vastheeft:
<ul>
<li><strong>Wait-die algoritme</strong>:
<ul>
<li>Als T ouder is dan U dan zal T wachten</li>
<li>Zoniet dan sterft T en is er een abort/restart met dezelfde timestamp.</li>
</ul>
</li>
<li><strong>Wound-wait algoritme</strong>
<ul>
<li>Als T ouder is dan U dan zal het U ‘verwonden’ (–&gt; meestal betekent dit een abort/restart van U)</li>
<li>Zoniet zal T wachten</li>
</ul>
</li>
</ul>
</li>
<li><strong>Deadlock detection and recovery:</strong>
<ul>
<li><strong>Deadlock detection</strong>
<ul>
<li>gebruik makend van een <strong>wait-for graph</strong> met transactie afhankelijkheden</li>
<li>wanneer de wait-for graph een lus bevat is er een
deadlock</li>
<li>op regelmatige tijdstippen wordt deze graph
getest op lussen</li>
</ul>
</li>
<li><strong>Recovery van deadlock detection</strong>
<ul>
<li>1 of meerdere transacties worden ge-abort</li>
</ul>
</li>
<li>Problemen
<ul>
<li><strong>Victim selection</strong>
<ul>
<li>abort die transactie waarvoor de abort een <strong>‘minimale kost’</strong> met zich meebrengt</li>
</ul>
</li>
<li>Enkele parameters die kunnen gebruikt worden:
<ul>
<li>tijd dat de transactie al aan het runnen was</li>
<li>aantal data items dat reeds werd gewijzigd door de transactie</li>
<li>aantal data items die nog moeten worden gewijzigd door de transactie --&gt; deze parameter is echter niet altijd gekend</li>
</ul>
</li>
</ul>
</li>
<li>Hoe ver moet een transactie een rollback doen
<ul>
<li>dit is niet noodzakelijk de volledige transactie</li>
</ul>
</li>
<li>Voorkomen van starvation
<ul>
<li>komt voor wanneer steeds dezelfde transactie als victim
wordt geselecteerd
– bijhouden van een teller</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><a id="Transacties_in_SQL_SERVER_1449"></a>Transacties in SQL SERVER</h2>
<hr>
<h3><a id="DB_Transacties_1451"></a>DB Transacties</h3>
<ul>
<li><strong>Impliciete</strong> transacties: INSERT, UPDATE, DELETE en elke transact SQL-opdracht</li>
<li><strong>Expliciete</strong> transacties: zelf aangeven waar transactie begint, wanneer de transactie kan
afgesloten worden, of hoe je op je stappen terugkeert om fouten op te vangen<pre><code class="language-SQL">    <span class="hljs-operator"><span class="hljs-keyword">BEGIN</span> <span class="hljs-keyword">TRANSACTION</span>
    <span class="hljs-keyword">COMMIT</span> <span class="hljs-keyword">TRANSACTION</span>
    <span class="hljs-keyword">ROLLBACK</span> <span class="hljs-keyword">TRANSACTION</span>
</span></code></pre>
</li>
<li>Alle info ivm transacties worden weggeschreven in de <strong>transactielog</strong></li>
</ul>
<h3><a id="Stored_Procedures_en_Transacties_1463"></a>Stored Procedures en Transacties</h3>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> usp_Customer_Insert
    @customerid <span class="hljs-built_in">varchar</span>(<span class="hljs-number">5</span>),
    @companyname <span class="hljs-built_in">varchar</span>(<span class="hljs-number">25</span>)
    @orderid <span class="hljs-built_in">int</span> <span class="hljs-keyword">OUTPUT</span>
<span class="hljs-keyword">AS</span>
    <span class="hljs-keyword">BEGIN</span> <span class="hljs-keyword">TRANSACTION</span>
        <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> customers(customerid, companyname)
        <span class="hljs-keyword">VALUES</span>(@customerid, @companyname)
        <span class="hljs-keyword">if</span> @@<span class="hljs-keyword">error</span> &lt;&gt; <span class="hljs-number">0</span> <span class="hljs-keyword">BEGIN</span>
            <span class="hljs-keyword">ROLLBACK</span> <span class="hljs-keyword">TRANSACTION</span>
            <span class="hljs-keyword">RETURN</span> -<span class="hljs-number">1</span>
        <span class="hljs-keyword">END</span>
        <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> orders(customerid)
        <span class="hljs-keyword">VALUES</span>(@customerid)
        <span class="hljs-keyword">if</span> @@<span class="hljs-keyword">error</span> &lt;&gt; <span class="hljs-number">0</span> <span class="hljs-keyword">BEGIN</span>
            <span class="hljs-keyword">ROLLBACK</span> <span class="hljs-keyword">TRANSACTION</span>
            <span class="hljs-keyword">RETURN</span> -<span class="hljs-number">1</span>
        <span class="hljs-keyword">END</span>
        <span class="hljs-keyword">COMMIT</span> <span class="hljs-keyword">TRANSACTION</span>
        <span class="hljs-keyword">SELECT</span> @orderid=@@<span class="hljs-keyword">IDENTITY</span>
</span></code></pre>
<h3><a id="Isolation_Levels_1487"></a>Isolation Levels</h3>
<p>Bepalen het gedrag van concurrent users die data lezen of schrijven.</p>
<ul>
<li>
<p><strong>Reader</strong>:</p>
<ul>
<li>Statement dat data leest, m.b.v. een shared lock</li>
<li>Kun je <strong>niet beinvloeden</strong> voor wat betreft de locks die ze nemen en de duur van de locks</li>
</ul>
</li>
<li>
<p><strong>Writer</strong>:</p>
<ul>
<li>Statement dat data schrijft, m.b.v. een exclusive lock.</li>
<li>Kun je <strong>wel excpliciet beinvloeden</strong> m.b.v. <strong>isolation levels</strong>, hierdoor hebben ze ook impliciete invloed op het gedrag van writers.</li>
</ul>
<p><strong>Isolation level</strong> = setting op de sessie-niveau of query-niveau.</p>
</li>
</ul>
<h5><a id="4_Isolation_Levels_in_SQL_Server_1498"></a>4 Isolation Levels in SQL Server</h5>
<p><img src="http://puu.sh/pp5sf/051d29f1fa.png" alt="alt text" title="Isolation Levels Slide"></p>
<ol>
<li><strong>Read Uncommitted</strong>
<ul>
<li>laagste isolatieniveau</li>
<li><strong>reader vraagt geen shared lock</strong></li>
<li>reader nooit in conflict met writer (die
exclusieve lock heeft)</li>
<li>reader leest uncommitted data (= dirty read)</li>
</ul>
</li>
<li><strong>Read Committed</strong>
<ul>
<li>default isolaton level, zie demo</li>
<li>laagste niveau dat dirty reads verhindert</li>
<li>reader leest enkel committed data</li>
<li><strong>reader vraagt</strong> hiervoor shared <strong>lock</strong></li>
<li><strong>als bij deze vraag een writer een
exclusive lock heeft, moet reader wachten op
shared lock</strong></li>
<li>reader houdt shared lock tot data verkregen is,
niet tot einde van zijn transactie
<ul>
<li><strong>nogmaals lezen van de data in zelfde transactie kan
ander resultaat opleveren</strong>
= non-repeatable reads of inconsistent analysis</li>
<li>acceptabel voor veel toepassingen, maar niet altijd</li>
</ul>
</li>
</ul>
</li>
<li><strong>Repeatable read</strong>
<ul>
<li>reader vraagt shared lock en <strong>houdt deze tot
einde van de transactie</strong></li>
<li>andere transactie kan geen exclusive lock
verkrijgen tot einde van de transactie van de
reader</li>
<li><strong>repeatable read = consistent analysis</strong></li>
<li>vermijdt ook lost update (kan wel bij 1 &amp; 2)
door bij begin transactie shared lock te
nemen (m.b.v. SELECT want writers kun je
niet beïnvloeden, readers wel)</li>
</ul>
</li>
<li><strong>Serializable</strong>
<ul>
<li>Repeatable read lockt enkel rijen gevonden
bij eerste SELECT</li>
<li>Zelfde SELECT in zelfde transactie kan
nieuwe rijen geven (toegevoegd door andere
transactie) = phantoms</li>
<li><strong>Serializable</strong> vermijdt phantoms</li>
<li>Lockt alle keys die beantwoorden aan
WHERE-clause, ook toekomstige</li>
</ul>
</li>
</ol>
<h3><a id="Isolation_levels_Sessie_Niveau_1543"></a>Isolation levels: Sessie Niveau</h3>
<pre><code class="language-SQL">    <span class="hljs-operator"><span class="hljs-keyword">SET</span> <span class="hljs-keyword">TRANSACTION</span> <span class="hljs-keyword">ISOLATION</span> <span class="hljs-keyword">LEVEL</span> <span class="hljs-keyword">READ</span> COMMITED
</span></code></pre>
<h3><a id="Isolation_levels_Query_Niveau_1547"></a>Isolation levels: Query Niveau</h3>
<ul>
<li>override isolation level met “table hint”:<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> ORDERS <span class="hljs-keyword">WITH</span> (READUNCOMMITTED);</span>
<span class="hljs-comment">-- of</span>
<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> ORDERS <span class="hljs-keyword">WITH</span> (NOLOCK);</span>
</code></pre>
</li>
<li>dit vermijdt dat langlopende ad-hoc query’s op
een productie-systeem updates in andere
transacties laten wachten bij READ
COMMITTED en hoger</li>
</ul>
<h5><a id="Voorbeeld_xTreme_oplossing_mbv_transacties_1559"></a>Voorbeeld xTreme: oplossing m.b.v transacties</h5>
<p>.</p>
<pre><code class="language-SQL">    <span class="hljs-operator"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">procedure</span> vb @productclassname <span class="hljs-keyword">nvarchar</span>(<span class="hljs-number">50</span>)
    <span class="hljs-keyword">as</span>
    <span class="hljs-keyword">declare</span> @<span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span>
    <span class="hljs-keyword">SET</span> <span class="hljs-keyword">TRANSACTION</span> <span class="hljs-keyword">ISOLATION</span> <span class="hljs-keyword">LEVEL</span> <span class="hljs-keyword">SERIALIZABLE</span>
    <span class="hljs-keyword">BEGIN</span> <span class="hljs-keyword">TRANSACTION</span>
    <span class="hljs-comment">-- Zorg voor shared lock op volledige tabel.</span>
    <span class="hljs-comment">-- Samen met level "repeatable" zorgt dit ervoor</span>
    <span class="hljs-comment">-- er geen records kunnen bijkomen tijdens de transactie.</span>
    <span class="hljs-comment">-- Repeatable volstaat niet:</span>
    <span class="hljs-comment">-- houdt enkel lock op reeds gelezen data</span>
    <span class="hljs-keyword">select</span> @<span class="hljs-keyword">id</span>=<span class="hljs-keyword">max</span>(productclassid) <span class="hljs-keyword">from</span> productclass
    <span class="hljs-keyword">set</span> @<span class="hljs-keyword">id</span> = @<span class="hljs-keyword">id</span> + <span class="hljs-number">1</span>
    <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> productclass <span class="hljs-keyword">values</span>(@<span class="hljs-keyword">id</span>,@productclassname)
    <span class="hljs-keyword">COMMIT</span>
    <span class="hljs-keyword">SET</span> <span class="hljs-keyword">TRANSACTION</span> <span class="hljs-keyword">ISOLATION</span> <span class="hljs-keyword">LEVEL</span> <span class="hljs-keyword">READ</span> COMMITTED
    <span class="hljs-keyword">return</span> @<span class="hljs-keyword">id</span>
</span></code></pre>
<h3><a id="Triggers_en_Transacties_1583"></a>Triggers en Transacties</h3>
<ul>
<li>een trigger maakt deel uit van de transactie die de
triggerende opdracht bevat</li>
<li>binnen de trigger kan de transactie geROLLBACKed
worden</li>
</ul>
<pre><code class="language-SQL"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> delSpeler <span class="hljs-keyword">ON</span> Speler
<span class="hljs-keyword">FOR</span> <span class="hljs-keyword">delete</span>
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">IF</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(*)
    <span class="hljs-keyword">FROM</span> deleted <span class="hljs-keyword">JOIN</span> SpelerPloeg
    <span class="hljs-keyword">ON</span> SpelerPloeg.snr = deleted.snr) &gt; <span class="hljs-number">0</span>
<span class="hljs-keyword">BEGIN</span>
    <span class="hljs-keyword">ROLLBACK</span> <span class="hljs-keyword">TRANSACTION</span>
    PRINT ‘Je mag geen speler verwijderen als hij behoort tot een ploeg.<span class="hljs-string">' 
</span></span></code></pre>
<h2><a id="Recovery_1600"></a>Recovery</h2>
<hr>
<blockquote>
<p><strong>Recovery</strong> is het proces waarbij
een <strong>DB wordt teruggebracht naar een correcte toestand</strong>
wanneer er zich een failure voordoet</p>
</blockquote>
<p><strong>Waar zit de data?:</strong></p>
<ul>
<li>Main Memory, - Magnetic Disk, - Tape, - Optical Disk</li>
</ul>
<p><img src="http://puu.sh/ppcTx/0a28767312.png" alt="alt text" title="Schema Data"></p>
<ul>
<li><strong>Stabiele opslag:</strong> replicatie op verschillende plaatsen met onafhankelijke failure modes.</li>
</ul>
<h3><a id="Soorten_Failures_1613"></a>Soorten Failures</h3>
<ul>
<li><strong>system crash</strong>
<ul>
<li>hardware of software errors</li>
<li>verlies van gegevens in main memory</li>
</ul>
</li>
<li><strong>media failure</strong>
<ul>
<li>vb. disk head crash</li>
<li>verlies van gegevens in secondary storage</li>
</ul>
</li>
<li><strong>software error in application</strong>
<ul>
<li>vb. logische fout die transactie doet falen</li>
</ul>
</li>
<li><strong>natuurlijke ‘rampen’</strong>
<ul>
<li>vb. brand, aardbeving</li>
</ul>
</li>
<li><strong>slordigheid</strong>
<ul>
<li>vb. onopzettelijk wissen van gegevens door gebruiker of db administrator</li>
</ul>
</li>
<li><strong>sabotage</strong>
<ul>
<li>vb. opzettelijk wissen of corrupteren van gegevens of infrastructuur (sw/hw)</li>
</ul>
</li>
</ul>
<h3><a id="Transactions_en_recovery_1629"></a>Transactions en recovery</h3>
<ul>
<li>eenheid voor recovery is een transactie</li>
<li><strong>recovery manager</strong> staat in voor
<ul>
<li>atomiciteit (<strong>A</strong>CID)</li>
<li>duurzaamheid (ACI<strong>D</strong>)</li>
</ul>
</li>
<li>moeilijkheid
<ul>
<li>schrijven naar een db is <strong>niet atomair</strong>
<ul>
<li>transactie kan committen zonder dat alle effecten al
(permanent) in de db geregistreerd zijn</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a id="High_level_vs_low_level_operaties_1639"></a>High level vs low level operaties</h3>
<ul>
<li><strong>Voorbeeld</strong></li>
</ul>
<p><img src="http://puu.sh/ppdHr/93640a3f0f.png" alt="alt text" title="High level vs low level schema"></p>
<h3><a id="Undo_en_redo_1644"></a>Undo en redo</h3>
<ul>
<li>Enkel bij een ‘flush’ van de buffer is data
permanent
<ul>
<li>flushing: data van primary storage overhevelen
naar disk storage</li>
</ul>
</li>
<li><strong>Expliciete</strong> flush
<ul>
<li>force-writing</li>
<li>dit gebeurt via een commando, bv. bij commit</li>
</ul>
</li>
<li><strong>Impliciete</strong> flush
<ul>
<li>wanneer de buffers vol zijn</li>
</ul>
</li>
<li>Wat bij failure tussen schrijven naar buffer
en flushing?
<ul>
<li>transactie was <strong>reeds ge-commit</strong>
<ul>
<li>durability: <strong>redo</strong> de wijzigingen</li>
<li>aka rollforward</li>
</ul>
</li>
<li>transactie was <strong>nog niet ge-commit</strong>
<ul>
<li>atomicity: <strong>undo</strong> de wijzigingen
<ul>
<li>partiële undo: undo van 1 transactie</li>
<li>globale undo: undo van alle actieve transacties</li>
</ul>
</li>
<li>aka rollback</li>
</ul>
</li>
</ul>
</li>
<li><strong>Voorbeeld:</strong>
<img src="http://puu.sh/ppesT/df8ddd38c4.png" alt="alt text" title="Voorbeeld undo en redo"></li>
</ul>
<h3><a id="Buffer_management_1667"></a>Buffer management</h3>
<ul>
<li>Buffer management omvat het <strong>beheer van
transfer van buffers</strong> tussen main memory en
disk</li>
<li>Praktisch:
<ul>
<li>inlezen tot buffer vol</li>
<li><strong>replacement strategie</strong> voor force-write</li>
</ul>
</li>
<li>FIFO first-in-first-out</li>
<li>LRU least recently used</li>
<li><strong><em>Merk op:</em></strong> een pagina aanwezig in een buffer wordt nooit gelezen van disk</li>
</ul>
<h3><a id="Recovery_faciliteiten_1678"></a>Recovery faciliteiten</h3>
<p>Het DBMS biedt volgende diensten aan</p>
<ul>
<li><strong>Back-up</strong> mechanisme
<ul>
<li>periodische back-ups van de db</li>
</ul>
</li>
<li><strong>Logging</strong> mogelijkheden
<ul>
<li>op de hoogte blijven van de huidige toestand van
transacties en db wijzigingen</li>
</ul>
</li>
<li><strong>Checkpoint</strong> mogelijkheden
<ul>
<li>om lopende wijzigingen in de db permanent te maken</li>
</ul>
</li>
<li><strong>Recovery manager</strong>
<ul>
<li>om de db in een consistente toestand te brengen na een failure</li>
</ul>
</li>
</ul>
<h3><a id="Backup_mechanisme_1690"></a>Back-up mechanisme</h3>
<ul>
<li>Op regelmatige basis worden er
automatisch <strong>reservekopieën</strong> van de db en
de logfile aangemaakt
<ul>
<li>dit gebeurt zonder systeem te moeten stoppen</li>
<li>de kopieën worden bewaard op offline storage</li>
</ul>
</li>
<li>Mogelijke benaderingen
<ul>
<li><strong>complete</strong> back-up</li>
<li><strong>incrementele</strong> back-up</li>
</ul>
</li>
</ul>
<h3><a id="Logging_1699"></a>Logging</h3>
<ul>
<li><strong>Log</strong> bevat mogelijks
<ul>
<li><strong>Transaction records</strong>
<ul>
<li>transaction id</li>
<li>type van log record (transaction start, insert, update, delete, abort (rollback), commit)</li>
<li>id van het gewijzigde data item (enkel bij insert, update, en delete operaties)</li>
<li>before-image
<ul>
<li>waarde data item vóór wijziging (enkel bij update en delete operaties)</li>
</ul>
</li>
<li>after-image
<ul>
<li>waarde data item na wijziging (enkel bij update en insert operaties)</li>
</ul>
</li>
<li>log management info
<ul>
<li>bv. pointers naar previous/next record van die transactie</li>
</ul>
</li>
</ul>
</li>
<li><strong>Checkpoint records</strong></li>
</ul>
</li>
<li>Log wordt ook gebruikt voor andere doeleinden
<ul>
<li>performance monitoring, auditing</li>
<li>hiervoor is nog <strong>extra info</strong> in de log opgeslagen</li>
</ul>
</li>
<li>Log is heel belangrijk
<ul>
<li>wordt in <strong>twee- of drievoud</strong> bijgehouden</li>
<li>ook offline</li>
</ul>
</li>
<li>Log moet snel toegankelijk zijn
<ul>
<li>minor failures moeten direct opgelost worden</li>
<li>bevindt zich dus liefst ook op <strong>online storage</strong>
<ul>
<li>indien de grootte dit toestaat</li>
</ul>
</li>
</ul>
</li>
<li>Voorbeeld log: <img src="http://puu.sh/ppgmP/e3a0d207bc.png" alt="alt text" title="Voorbeeld Logging"></li>
</ul>
<h3><a id="Checkpointing_1724"></a>Checkpointing</h3>
<blockquote>
<p>Een <strong>checkpoint</strong> is een <strong>synchronisatiepunt</strong> tussen de databank en de log, op dit punt worden alle buffers ge-flushed</p>
</blockquote>
<p>Checkpoints worden voorzien op vooraf ingestelde intervallen (bv. Om de 15 minuten).</p>
<p>Een checkpoint omvat:</p>
<ol>
<li>Alle log records in main memory wegschrijven naar disk</li>
<li>De gewijzigde delen van de buffers wegschrijven naar disk</li>
<li>Een checkpoint in de log registreren. ( Dit record bevat id van alle transacties die actief zijn op het moment van checkpointing).</li>
</ol>
<p><strong>Voorbeeld:</strong> recovery met checkpointing
<img src="http://puu.sh/ppgWo/b4ffb00a5d.png" alt="alt text" title="Voorbeeld checkpointing"></p>
<h2><a id="Recovery_Technieken_1737"></a>Recovery Technieken</h2>
<hr>
<p>Soort recovery procedure die gevolgd wordt hangt af van de ernst van het probleem:</p>
<ul>
<li>Serieuze (fysische) problemen
<ul>
<li>back-up restoren</li>
<li>wijzigingen van committed transacties (sedert de backup) die verloren
gingen, herstellen adhv de log</li>
</ul>
</li>
<li>Problemen van inconsistentie
<ul>
<li>kan zonder back-up</li>
<li>undo/redo adhv de log’s before en after images</li>
</ul>
</li>
</ul>
<h3><a id="Deferred_update_1748"></a>Deferred update</h3>
<blockquote>
<p>Bij een <strong>deferred recovery protocol</strong> worden
wijzigingen van een transactie niet weggeschreven naar de DB zolang de transactie niet het commit-punt bereikt</p>
</blockquote>
<ol>
<li><strong>Start</strong> van de transactie: registreer de transactie start record in log</li>
<li>Bij een <strong>write</strong> actie: registreer dit in een log-record (<strong>enkel after-image</strong>, geen before image nodig). <strong>Registreer dit niet in de DB</strong></li>
<li><strong>Commit</strong> van de transactie: registreer transactie commit record in log. Schrijf alle log records weg naar disk (<strong>flush voor de volgende stap!</strong>) bij eerstvolgende checkpoint. Commit <strong>update de DB adhv de log records.</strong></li>
<li><strong>Abort</strong> van de transactie: <strong>negeer de log records, schrijf niets naar disk</strong></li>
</ol>
<h3><a id="Immediate_update_1757"></a>Immediate update</h3>
<blockquote>
<p>Bij een <strong>immediate update recovery protocol</strong> worden
wijzigingen van een transactie direct weggeschreven naar de db</p>
</blockquote>
<ol>
<li><strong>Start</strong> van de transactie: registreer transaction start record in log</li>
<li>Bij een <strong>write</strong> actie: schrijf het <strong>log-record naar disk</strong> (het log-record bevat <strong>before-image, en after-image</strong>), bij flush van de buffers (bij eerstvolgende checkpoint) wordt de wijziging naar de db
geschreven</li>
<li><strong>Commit</strong> van de transactie: schrijf een transaction commit log record naar disk</li>
<li><strong>Abort</strong> van de transactie: gebruik <strong>before images voor undo</strong></li>
</ol>
<h6><a id="Voorbeeld_1767"></a><strong>Voorbeeld</strong></h6>
<p><img src="http://puu.sh/ppioj/b2ccf0f897.png" alt="alt text" title="Voorbeeld Recovery Technieken"></p>
<table class="table table-striped table-bordered">
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">Deferred</th>
<th style="text-align:center">Immediate</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">T1</td>
<td style="text-align:center">niets</td>
<td style="text-align:center">UNDO via Before-Images</td>
</tr>
<tr>
<td style="text-align:center">T2</td>
<td style="text-align:center">niets</td>
<td style="text-align:center">niets</td>
</tr>
<tr>
<td style="text-align:center">T3</td>
<td style="text-align:center">niets</td>
<td style="text-align:center">niets</td>
</tr>
<tr>
<td style="text-align:center">T4</td>
<td style="text-align:center">REDO adhv After-Images</td>
<td style="text-align:center">REDO adhv After-Images</td>
</tr>
<tr>
<td style="text-align:center">T5</td>
<td style="text-align:center">REDO adhv After-Images</td>
<td style="text-align:center">REDO adhv After-Images</td>
</tr>
<tr>
<td style="text-align:center">T6</td>
<td style="text-align:center">niets</td>
<td style="text-align:center">UNDO via Before-Images</td>
</tr>
</tbody>
</table>
<hr>
<h1><a id="Hoofdstuk_8_Datawarehousing__Business_Intelligence_1782"></a>Hoofdstuk 8: Datawarehousing &amp; Business Intelligence</h1>
<h3><a id="Inleiding_1783"></a>Inleiding</h3>
<hr>
<p>Data warehousing zit in de lift</p>
<ul>
<li>Groeiende nood aan flexibele business
rapportering toegankelijk voor de business</li>
<li>Data die in DWH zit groeit exponentieel
<ul>
<li>terabytes aan data in een DW is ‘gewoon’ geworden</li>
</ul>
</li>
<li>Applicaties die gebruik maken van die data worden
complexer
<ul>
<li>traditionele rapportage</li>
<li>geavanceerde analyses</li>
</ul>
</li>
<li>Traditionele DBMS bieden allemaal DWH faciliteiten aan</li>
</ul>
<h3><a id="Data_Warehouse_1796"></a>Data Warehouse</h3>
<blockquote>
<p>Een <strong>data warehouse</strong> is een geïntegreerde, subject georiënteerde,
tijd variante en niet vluchtige verzameling van data ter
ondersteuning van beslissingen die genomen moeten worden op
management niveau</p>
</blockquote>
<h3><a id="Eigenschappen_1802"></a>Eigenschappen:</h3>
<p><strong>Geïntegreerd</strong></p>
<ul>
<li>Data is afkomstig uit verschillende bronnen (data uit verschillende bronnen is dikwijls inconsistent, in het DW is alles consistent geïntegreerd).</li>
</ul>
<p><strong>Tijd</strong></p>
<ul>
<li>Data in het DW is accuraat en geldig op een bepaald punt in de tijd of
over een bepaald tijdsinterval</li>
<li>Data wordt over heel lange periodes bijgehouden</li>
<li>Tijd kan expliciet of impliciet geassocieerd zijn met de data
<ul>
<li>vb. Eenheidsprijs van een product kan in de tijd (historisch) worden bijgehouden of
kan een momentopname zijn</li>
<li>DW zal, door geregelde kopieën te nemen, de historiek opbouwen</li>
</ul>
</li>
<li>Mogelijkheid om terug te gaan naar een momentopname</li>
</ul>
<p><strong>Niet vluchtig (non volatiel)</strong></p>
<ul>
<li>Data wordt niet real-time ge-update maar op regelmatige basis
bijgewerkt met data uit operationele systemen</li>
<li>Nieuwe data komt incrementeel bovenop oude data</li>
</ul>
<p><strong>Geaggregeerde data</strong></p>
<ul>
<li>Afkomstig van bijv. GROUP BY</li>
</ul>
<h3><a id="Doelstellingen_DWH_1824"></a>Doelstellingen DWH</h3>
<ul>
<li>Rapportering</li>
<li>Analyse van events in verleden of heden</li>
<li>Voorspellingen op basis van trendanalyse, historisch</li>
<li>Multidimensionele rapportering</li>
<li>Eindgebruiker vereenvoudigde rapporteringsomgeving bieden
(empowerment)</li>
<li>Data mining</li>
</ul>
<h3><a id="Voordelen_1833"></a>Voordelen</h3>
<p><strong>Hoge Return on Investment (ROI)</strong>: het opzetten van een Datawarehouse is een zware investering maar levert een hoge ROI na een relatief korte periode.</p>
<p><strong>Concurrentieel voordeel:</strong> doordat beleidsmakers toegang hebben tot voorheen niet beschikbare, ongekende of ongebruikte informatie over bv. klanten, trends, …</p>
<p><strong>Verhoogde productiviteit:</strong> de beleidsmaker krijgt één grote consisente view op de onderneming doordat het DW data uit verschillende bronnen integreert tot een consistent geheel, dat subject georiënteerd is en waar historiek zit ingebakken. Ze kunnen ook meer substantiële, nauwkeurigere en consistentere analyses maken (via tools kan de data automatisch tot bruikbare informatie omgevorm worden).</p>
<h3><a id="Vergelijk_OnLine_Transaction_Processing_en_DW_1841"></a>Vergelijk On-Line Transaction Processing en DW</h3>
<h4><a id="aka_OLTP_en_OLAP_OnLine_Analytical_Processing_1842"></a>aka OLTP en OLAP (On-Line Analytical Processing)</h4>
<table class="table table-striped table-bordered">
<thead>
<tr>
<th>Eigenschap</th>
<th>OLTP</th>
<th>DW</th>
</tr>
</thead>
<tbody>
<tr>
<td>Hoofddoel</td>
<td>ondersteuning van operationele verwerking</td>
<td>ondersteuning analytische verwerking</td>
</tr>
<tr>
<td>Leeftijd van de data</td>
<td>actueel</td>
<td>historisch (maar trend naar meer actueel)</td>
</tr>
<tr>
<td>Data wachttijd</td>
<td>real-time</td>
<td>afhankelijk van hoe frequent het DW wordt bevoorraad (maar trend naar real-time)</td>
</tr>
<tr>
<td>Data granulariteit</td>
<td>detail</td>
<td>detail, maar ook in kleine of hoge mate samengevat</td>
</tr>
<tr>
<td>Data processing</td>
<td>voorspelbare insert, delete, update en select opdrachten, veel transacties per tijdseenheid</td>
<td>onvoorspelbare selects, relatief laag aantal transacties per tijdseenheid</td>
</tr>
<tr>
<td>Rapportage</td>
<td>voorspelbaar, eendimensionaal, relatief statisch</td>
<td>onvoorspelbaar, multidimensioneel, dynamisch</td>
</tr>
<tr>
<td>Gebruikers</td>
<td>groot aantal gebruikers op operationele niveau</td>
<td>klein aantal gebruikers opmanagement niveau (maar trend naar ondersteuning voor analytische behoeften van operationele gebruikers</td>
</tr>
</tbody>
</table>
<h2><a id="Architectuur_1855"></a>Architectuur</h2>
<hr>
<h3><a id="Architectuur_van_een_DWH_1857"></a>Architectuur van een DWH</h3>
<p><img src="http://puu.sh/pppKy/67445e577f.jpg" alt="alt text" title="Architectuur schema"></p>
<ul>
<li>Operationele data</li>
<li>Bronnen van data
<ul>
<li>mainframe (hiërarchisch, netwerk)</li>
<li>departementale data in bestanden en
RDBM systemen</li>
<li>privé data op werkstations en privé
servers</li>
<li>externe systemen
<ul>
<li>internet</li>
<li>commerciële DB</li>
<li>DB die bij de klanten of leveranciers gebruikt worden</li>
</ul>
</li>
</ul>
</li>
<li>Operationele data source</li>
<li>Repository
<ul>
<li>huidige, geïntegreerde data</li>
<li>voorbereidende stap in ontwikkeling van
het DWH, of,</li>
<li>ondersteuning van reporting services bij
legacy systemen</li>
</ul>
</li>
<li>ETL manager
<ul>
<li>ondersteunt alle operaties voor ETL
(Extraction, Transformation and Load) van data
<ul>
<li>rechtstreeks vanuit operationele
gegevensbronnen</li>
<li>vanuit de operationele data store</li>
</ul>
</li>
</ul>
</li>
<li>Warehouse manager
<ul>
<li>voor het beheer van data in het DWH
<ul>
<li>analyse van data om consistentie te
garanderen</li>
<li>transformatie en samenvoegen van
brongegevens van tijdelijke opslag in DWH
tabellen</li>
<li>creatie van indexen en views</li>
<li>eventuele denormalisatie</li>
<li>aanmaken van aggregaten (samenvoegen
van data)</li>
<li>back-up en archivering van de data</li>
</ul>
</li>
</ul>
</li>
<li>Query manager
<ul>
<li>beheer van gebruikersqueries</li>
<li>gebruik van juiste tabellen</li>
<li>uitvoeren/schedulen van queries</li>
<li>generatie van profielen</li>
<li>voorstellen voor aggregaten en indexen
maken</li>
</ul>
</li>
<li>Gedetailleerde data
<ul>
<li>dikwijls niet online opgeslagen maar
beschikbaar door aggregatie van de data
in een hoger niveau van detail</li>
<li>deze data wordt op regelmatige basis aan
het DWH toegevoegd</li>
</ul>
</li>
<li>Samengevatte data
<ul>
<li>voorgedefinieerde samengevatte data</li>
<li>onderhevig aan veranderingen zodat kan
ingespeeld worden op verschillende
soorten queries</li>
<li>zorgt voor verhoogde performantie bij
query-uitvoering</li>
</ul>
</li>
<li>Archive/back-up data
<ul>
<li>voor zowel gedetailleerde als
samengevatte data
<ul>
<li>samengevatte data kan bv. een langere
levensduur kennen dan de gedetailleerde  data</li>
</ul>
</li>
</ul>
</li>
<li>Meta data
<ul>
<li>nodig voor ETL</li>
<li>nodig voor de DWH manager</li>
<li>nodig door de Query manager</li>
</ul>
</li>
<li>Meerdere kopieën van metadata die elk
afgestemd zijn op een bepaald proces</li>
<li>Laten steeds toe de herkomst van een
item in het DWH volledig te bepalen</li>
<li>End user access tools
<ul>
<li>reporting and querying</li>
<li>application development tools</li>
<li>OLAP tools</li>
<li>data mining tools</li>
</ul>
</li>
</ul>
<h3><a id="Data_Marts_1934"></a>Data Marts</h3>
<blockquote>
<p>Een DB die bestaat uit een <strong>deelverzameling van bedrijfsgegevens</strong> ter ondersteuning van de behoeften van een bepaalde bedrijfsunit om <strong>analyses</strong> te kunnen uitvoeren, of, om gebruikers te ondersteunen die dezelfde behoeften hebben om bepaalde <strong>bedrijfsprocessen</strong> te analyseren</p>
</blockquote>
<p><img src="http://puu.sh/ppqhT/763b11889d.jpg" alt="alt text" title="Data Marts"></p>
<p><strong>Waarom een datamart?</strong></p>
<ul>
<li>om gebruikers toegang te geven tot de data die ze meest analyseren</li>
<li>om data aan te bieden in een vorm die overeenkomt met de collectieve view van een groep van
gebruikers in een departement of van een groep gebruikers binnen eenzelfde bedrijfsproces</li>
<li>om response tijd te verhogen door kleinere volumes van data aan te bieden</li>
<li>om data aan te bieden in een vorm die past bij de tools die de eindgebruikers gebruiken (OLAP,
data-mining tools)</li>
<li>reductie van complexiteit in het ETL proces</li>
<li>reductie van de kost tov het opzetten van een enterprise wide DWH</li>
</ul>
<h3><a id="Data_Mining_Applications_1949"></a>Data Mining Applications</h3>
<ul>
<li><strong>Data mining</strong> applicaties worden gebruikt
om:
<ul>
<li>what-if analyses te doen</li>
<li>voorspellingen te doen</li>
<li>het beslissingsproces te faciliteren</li>
</ul>
</li>
<li>Data mining applicaties maken gebruik van
gesofesticeerde statische en wiskundige
technieken</li>
<li>Rapporten zijn minder kritisch</li>
</ul>
<h3><a id="Problemen_met_DWH_1960"></a>Problemen met DWH</h3>
<ul>
<li><strong>Kosten voor ETL worden onderschat</strong>
<ul>
<li>extraction, transformation en loading van data in het DWH neemt groot deel van ontwikkeltijd in
beslag</li>
<li>Projecten duren meestal jaren</li>
</ul>
</li>
<li><strong>Verborgen problemen met de bron of ETL systemen</strong>
<ul>
<li>worden soms pas na jaren ontdekt</li>
<li>oplossen gebeurt in DWH en/of operationele DB</li>
<li>vb. velden die null-waarden toelaten, in sommige kantoren laten ze die altijd op null staan,
hoewel de gegevens wel beschikbaar en nuttig zijn</li>
</ul>
</li>
<li><strong>Nodige data wordt niet bijgehouden</strong>
<ul>
<li>verandering in huidige systeem of apart systeem voor deze data</li>
<li>vb. de datum waarop een klant zich registreert wordt momenteel niet bijgehouden</li>
</ul>
</li>
<li><strong>Verhoogde eisen van de eindgebruikers</strong>
<ul>
<li>hoe meer gebruikers zich bewust worden van de mogelijkheden van het systeem,
hoe meer ze zullen eisen
<ul>
<li>meer druk op Information System personeel</li>
<li>vraag naar meer gebruiksvriendelijke, krachtige, gesofistikeerde tools</li>
<li>betere training voor eindgebruikers</li>
</ul>
</li>
</ul>
</li>
<li><strong>Data homogenisatie</strong>
<ul>
<li>men poogt gelijkenissen tussen data te accentueren en dit kan het nut van de data verlagen</li>
<li>bv. gelijkenissen tussen verkoop en verhuur van eigendommen</li>
</ul>
</li>
<li><strong>Nood aan meerdere (historische) versies naast mekaar</strong>
<ul>
<li>Vb. als DWH wordt gebruikt voor financiële en operationele rapportering -&gt; consistentie</li>
<li>Het beheer van diverse historische versies naast mekaar is een uitdaging</li>
<li>Grote DB volumes -&gt; performantie</li>
<li>Archivering…</li>
</ul>
</li>
<li><strong>Hoge vraag naar resources</strong>
<ul>
<li>bv. disk space</li>
</ul>
</li>
<li><strong>Data ownership</strong>
<ul>
<li>data die voorheen gevoelig was, die voorbehouden was voor bepaalde afdelingen kan nu ook
aangeboden worden aan andere gebruikers</li>
<li>Beheer rechten in DWH vraagt bijzondere aanpak</li>
</ul>
</li>
<li><strong>Hoog onderhoud</strong>
<ul>
<li>elke verandering in de business processen of in de bronsystemen heeft invloed op het DWH
(zowel DWH structuur als ETL)</li>
</ul>
</li>
<li><strong>Lange duur</strong>
<ul>
<li>ontwikkeling kan jaren duren</li>
<li>wordt soms opgelost via de ontwikkeling en integratie van data marts</li>
</ul>
</li>
<li><strong>DWH ontstaat uit verwachting om de gebruikers te ‘empoweren’:</strong>
<ul>
<li>Zelf rapporten, analyses maken</li>
<li>Meer onafhankelijkheid van IT</li>
<li>Nood aan metadata dictionary die data in DWH beschrijft en toegankelijk maakt</li>
<li>Maar toch grote afhankelijkheid van enkele specialisten.</li>
</ul>
</li>
<li><strong>Complexiteit van de integratie</strong>
<ul>
<li>hoe kunnen alle nodige DWH tools zinvol en efficiënt samenwerken</li>
</ul>
</li>
<li><strong>Complex change en versie management</strong>
<ul>
<li>Consistentie in rapportering</li>
<li>Impact op oude versies</li>
</ul>
</li>
<li><strong>DWH kan fungeren als input voor een management decision system</strong>
<ul>
<li>Vb. historische verkoopsforecast met ingave van nieuwe data</li>
<li>Combinatie van rapportering en online data</li>
</ul>
</li>
<li><strong>Nacht dikwijls te kort voor afhandelen DWH ETL</strong>
<ul>
<li>Zeker bij maand- en jaarsluiting</li>
<li>Als er iets fout gaat in een ander systeem</li>
<li>ETL stoppen of laten doorlopen?
<ul>
<li>Onvolledig DWH versus performantie killer</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a id="DWH_Technologien_2017"></a>DWH Technologieën</h3>
<ul>
<li>Microsoft:
<ul>
<li>Microsoft reporting server</li>
<li>DTS (Data Transformation Services)</li>
</ul>
</li>
<li>Cognos (nu IBM)
<ul>
<li>ETL</li>
<li>Rapporteringstools</li>
</ul>
</li>
<li>Business Objects (nu SAP)
<ul>
<li>Rapportering</li>
<li>ETL</li>
</ul>
</li>
<li>SAP Business Warehouse
<ul>
<li>Kubus</li>
</ul>
</li>
<li>Datastage ETL</li>
<li>Cliqview rapportering</li>
</ul>
<h2><a id="Ontwerp_2032"></a>Ontwerp</h2>
<hr>
<h5><a id="Thanks_Sofie_2034"></a>Thanks Sofie</h5>
<p>Er zijn 2 ontwikkel methodologieën</p>
<ul>
<li><strong>Inmon</strong>:
creatie van een data model gebasseerd op alle gegevens van de organisatie → Enterprise Data Warehouse (EDW)
<ul>
<li>Van hieruit worden data-marts voor elk departement gedistilleerd</li>
<li>Gebruik van ERD en tabellen in normaalvorm voor de beschrijving van het EDW</li>
</ul>
</li>
<li><strong>Kimball</strong>: identificatie van informatie behoeften en business processen van de organisatie → Data Warehouse Business Matrix
<ul>
<li>Selectie en ontwikkeling van een eerste data mart voor de behoeften van een groep gebruikers.</li>
<li>Via integratie van data marts komen we tot het EDW</li>
<li>Gebruik van sterschema en varianten</li>
</ul>
</li>
</ul>
<h3><a id="Kimballs_Business_Dimensional_Lifecycle_2046"></a>Kimball’s Business Dimensional Lifecycle</h3>
<p><strong>Focus</strong> op het voldoen aan de informatiebehoeften van de organisatie via het bouwen van enkele, geïntegreerde, makkelijk bruikbare en selle informatie structuur. Deze structuur wordt op een incrementele, iteratieve manier gebouwd.</p>
<p><strong>Doel</strong>: opleveren van een volledige oplossing waarbij</p>
<ul>
<li>DWH</li>
<li>ad-hoc query tools</li>
<li>reporting applicaties</li>
<li>geavanceerde analytische tools</li>
<li>training en support voor de gebruikers</li>
</ul>
<p>zijn inbegrepen.</p>
<p><strong>3 tracks</strong></p>
<ul>
<li>technologie</li>
<li>data track</li>
<li>business intelligence applications</li>
</ul>
<h3><a id="Dimensionality_modelling_2063"></a>Dimensionality modelling</h3>
<blockquote>
<p><strong>Dimensionality modeling</strong> is een techniek om een logisch ontwerp te maken.</p>
</blockquote>
<p>Men streeft er naar om de data te presenteren in een standaard, intuïtieve vorm, die toegankelijk is met een hoge performantie.</p>
<h4><a id="Dreamhome_DWH_voorbeeld_2068"></a>Dreamhome DWH: voorbeeld</h4>
<p>Management wil analyse van verkoop van huizen</p>
<p><strong>Voorbeeld queries</strong></p>
<ul>
<li>wat was het totaal aan inkomsten van verkoop van eigendommen in het derde kwartaal van 2008?</li>
<li>welke zijn de drie meest populaire gebieden in elke stad voor het verhuren van eigendommen in 2008; en hoe is dit in vergelijking met de resultaten van de twee vorige jaren?</li>
<li>wat zou het effect zijn van een verhoging van de juridische kosten met 3.5% en een verlaging van de belastingen met 1.5% op de verkoop van eigendommen die meer waard zijn dan 200000 Euro?</li>
<li>welke soorten eigendommen worden verkocht voor prijzen die boven de gemiddelde prijs van eigendommen in de grootste steden liggen en hoe hangt dit samen met de demografische gegevens</li>
<li>wat is het verband tussen de jaarlijkse inkomsten van elke kantoor en het aantal verkoopsmensen die in elk kantoor werken?</li>
</ul>
<p><strong>ERD</strong>
<img src="http://puu.sh/ppz4F/a1cba72b39.PNG" alt="alt text" title="Voorbeeld Dimensionaal model"></p>
<h4><a id="Sterschema_2081"></a>Sterschema</h4>
<blockquote>
<p>Een <strong>ster schema</strong> is een dimensioneel model die een feitentabel heeft, die omgeven is door gedenormaliseerde dimensietabellen.</p>
</blockquote>
<p><img src="http://puu.sh/ppz5x/94409d7e78.PNG" alt="alt text" title="Voorbeeld sterschema"></p>
<ul>
<li><strong>fact table</strong> met samengestelde primaire sleutel</li>
<li><strong>dimension tables</strong> met een niet samengestelde primaire sleutel</li>
</ul>
<p>Elke PK van een dimension table komt overeen met een deel van de PK van de fact table. Elk deel van de PK van de fact table is een FK die naar één van de dimensies refereert.</p>
<p><strong><em>Opmerking</em></strong></p>
<ul>
<li>de natuurlijke sleutels uit het operationeel systeem worden opgenomen maar niet als sleutel in het sterschema gebruikt</li>
<li>surrogaatsleutels zijn simpele integer-sleutels</li>
<li>ze zorgen voor onafhankelijkheid van data tussen OLTP en DWH</li>
</ul>
<h5><a id="Feitentabel_2097"></a>Feitentabel</h5>
<p>bevat data over feiten
bv. feitelijke data over de verkoop van een eigendom.<br>
Feiten worden gegenereerd oor gebeurtenissen die zich hebben voorgedaan. Ze zullen hoogstwaarschijnlijk nooit veranderen, ongeacht de manier waarop men ze analyseert.</p>
<ul>
<li>grote bulk van data in DWH dus tabel kan extreem groot zijn</li>
<li>feitelijke data wordt beschouwd als read-only data, die niet verandert in tijd</li>
<li>bevatten één of meerdere numerieke waarden, feiten die voor elk record toepasbaar zijn<br>
Meestal zijn feiten additief, ze worden zelden maar voor 1 record geraadpleegd</li>
</ul>
<p><strong>Voorbeeld</strong></p>
<p><img src="http://puu.sh/ppz5T/d49dacfa72.PNG" alt="alt text" title="Voorbeeld feitentabel"></p>
<h5><a id="Dimensietabellen_2111"></a>Dimensietabellen</h5>
<p>bevat de referentie-informatie; beschrijvende, op tekst gebaseerde, informatie<br>
bv. het eigendom, de koper, de verkoper, …</p>
<ul>
<li>attributen worden gebruikt als constraints bij DWH queries<br>
bv. queries die gaan over verkopen van eigendommen in ‘Glasgow’</li>
</ul>
<p>Sterschema’s kunnen query performantie aanzienlijk verhogen door referentie-informatie te denormaliseren en bij te houden in één enkele dimensietabel<br>
zie bv. city, region, country</p>
<p><strong>Voorbeeld</strong></p>
<p><img src="http://puu.sh/ppz69/ced07c54bc.PNG" alt="alt text" title="Voorbeeld dimensietabellen"></p>
<h4><a id="Sneeuwvlok_schema_2124"></a>Sneeuwvlok schema</h4>
<blockquote>
<p>Een  <strong>sneeuwvlokschema</strong> is een variant op het sterschema waarbij dimensies worden bijgehouden in genormaliseerde dimensietabellen</p>
</blockquote>
<p><img src="http://puu.sh/ppz58/b6605c5742.PNG" alt="alt text" title="Voorbeeld sneuuwvlokschema"></p>
<p><strong><em>Opmerking</em></strong><br>
ook andere dimensietabellen zullen nu refereren naar City en Region tabellen</p>
<p>Indien een combinatie van genormaliseerde en niet genormaliseerde dimensietabellen wordt gebruikt spreekt men van een <strong>ster-vlok schema</strong></p>
<h3><a id="Voordelen_2134"></a>Voordelen</h3>
<p>de voorspelbare en standaardvormvan het dimensioneelmodel levert enkele voordelen op:</p>
<ul>
<li>efficiëntie
<ul>
<li>de consistenteDB-structuur laat toe dat tools op efficiëntere maniertoegang tot de data kunnen krijgen</li>
</ul>
</li>
<li>veranderendebehoeften
<ul>
<li>het model kan zich aanpassen aan veranderende behoeften daar elke dimensie equivalent is t.o.v. de feitentabel</li>
<li>goed model voor ad-hoc queries</li>
</ul>
</li>
<li>uitbreidbaarheid
<ul>
<li>toevoegen van nieuwe feiten(met de juiste granulariteit)</li>
<li>toevoegen van nieuwe dimensies</li>
<li>toevoegen van attributen aand imensies</li>
<li>dimensies naar een kleinere granulariteit overzetten vanaf een bepaald punt in de tijd</li>
</ul>
</li>
<li>mogelijkheid om standaard business situaties te modelleren</li>
<li>voorspelbare query processing
<ul>
<li>de manier waarop de tabellen gebruikt worden in queries is voorspelbaar(de queries niet!)</li>
</ul>
</li>
</ul>
<h3><a id="DM_en_ER_modellen_2150"></a>DM en ER modellen</h3>
<ul>
<li>
<p>Entity Relationship Diagrammen</p>
<ul>
<li>gebruikt om de DB voor OLTLP systemen te ontwerpen</li>
<li>basis: de relaties tussen entiteiten modelleren, met als doel redundantie weg te werken
<ul>
<li>redendantie is nadelig voor OLTP systemen</li>
</ul>
</li>
<li>ad-hoc queries kunnen moeilijker behndeld worden
<ul>
<li>leiden tot enoerm veel joins van enorm veel tabellen</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Dimensionaal Modeleren</p>
<ul>
<li>gebruikt om de DB van een DWH (of datamart) te ontwerpen</li>
<li>intuïtieve opslag met een hoge graad aan performantie bij raadpleging van de gegevens</li>
</ul>
</li>
</ul>
<p>Eén ERD wordt uitgesplitst over meerdere DM-en, deze DM-en hangen samen via gedeelde dimensies</p>
<h3><a id="Dimensional_Modeling_Stage_2164"></a>Dimensional Modeling Stage</h3>
<p><strong>DOEL</strong></p>
<ul>
<li>creatie van een DM voor een data mart</li>
<li>dimensionaliseren van het relationeel model van een bestaande OLTP DB</li>
</ul>
<p>Dit gebeurt in 2 fasen:</p>
<ol>
<li>creatie van een high-level DM</li>
<li>toevoegen van detail aan het model via identificatie van attributen voor de dimensies</li>
</ol>
<h3><a id="FASE_1_creatie_van_een_highlevel_DM_2173"></a>FASE 1: creatie van een high-level DM</h3>
<p><img src="http://puu.sh/ppAzL/798001cdc4.PNG" alt="alt text"></p>
<h5><a id="STAP_1_selecteer_een_business_process_2176"></a>STAP 1: selecteer een business process</h5>
<p>Het business process refereert naar het thema voor een welbepaalde datamart<br>
Voor de erste datamart kiezen we liefst één die</p>
<ul>
<li>hoogstwaarschijnlijk op tijd zal kunnen opgeleverd worden,</li>
<li>binnen het budget valt,</li>
<li>een antwoord geeft op commercieel belangrijke business vragen<br>
Dikwijls is deze gerelateerd aan verkoop financiën.</li>
</ul>
<h5><a id="STAP_2_bepaal_de_granulariteit_2183"></a>STAP 2: bepaal de granulariteit</h5>
<p>Dit bepaalt wat een feit in de feitentabel exact gaat voorstellen:</p>
<ul>
<li>elk individueel record overnemen uit operationele gegevens of</li>
<li>groeperen</li>
</ul>
<p>Leidraad:</p>
<ul>
<li>hoe kunnen we tegemoetkomen aan de business requirements?</li>
<li>wat is mogelijk met de beschikbare data source?</li>
</ul>
<p>Granulariteit bepaalt de dimensies (volgende stap) en de granulariteit van de dimensies.</p>
<h5><a id="STAP_3_kies_de_dimensies_2193"></a>STAP 3: kies de dimensies</h5>
<p>Dit bepaalt de context binnen dewelke we de feiten in de feitentabel zullen kunnen bevragen.<br>
Elke dimensie die meer dan 1 DM, dus meer dan 1 datamart, voorkomt, noemen we een <strong>conformed dimension</strong>.<br>
Conformed dimensions zijn exact gelijk aan elkaar of de een is een subset van de andere.</p>
<h5><a id="STAP_4_identificeer_feiten_2198"></a>STAP 4: identificeer feiten</h5>
<p>De granulariteit van de feitentabel bepaalt welke feiten er in de datamart kunnen gebruikt worden.<br>
Feiten zijn nummeriek en additief.<br>
Onbruikbare feiten zijn:</p>
<ul>
<li>niet numerieke waarden</li>
<li>niet additieve waarden</li>
<li>feiten met een granulariteit die verschilt van de granulariteit van de andere feiten in de feitentabel</li>
</ul>
<h3><a id="FASE_2_identificieer_alle_attributen_voor_de_gekozen_dimensies_2206"></a>FASE 2: identificieer alle attributen voor de gekozen dimensies</h3>
<p>Tekstuele omschrijving: intuïtief, zelfverklarend</p>
<p>Bruikbaarheid van de datamart hangt grotendeels af van de scope en aard van de attributen die in de dimensietabellen zitten.</p>
<h3><a id="Aandachtspunten_2211"></a>Aandachtspunten</h3>
<ul>
<li>de duur van de DB bepaalt hoe ver terug in de tijd de fettentabel gaat</li>
<li>langzaam veranderende dimensies<br>
wanneer een dimensie verandert moet je er mogelijks voor zorgen dat je de nieuwe waarden niet gebruikt bij analyses an oudere transacties.
<ul>
<li>type 1: het attribuut dat verandert wordt gewoon overschreven</li>
<li>type 2: wanneer een attribuut verandert wordt een nieuw record in de dimensietabel toegevoegd</li>
<li>type 3: zorg dat de oude en de nieuwe waarde voor het attribuut beschikbaar zijn in het record</li>
</ul>
</li>
</ul>
<p>Op het einde van deze life-cycle zullen we een datamert hebben die voldoet aan 1 van de business requirements. Deze datamart zal geïntegreerd worden met andere datamarts om te komen tot een enterprise wide DWH.</p>
<p>Een DM waarbij meer dan 1 feitentabel 1 of meer dimensies deelt noemen we een <strong>feitenconstellatie</strong>.</p>
<h3><a id="Voorbeeld_Dimensional_Modeling_Stage_2222"></a>Voorbeeld Dimensional Modeling Stage</h3>
<p><strong>DreamHome</strong></p>
<h5><a id="STAP_1_selecteer_een_business_process_2224"></a>STAP 1: selecteer een business process</h5>
<p>Wat zijn de business processen?</p>
<ul>
<li>verkoop van eigendommen</li>
<li>verhuur van eigendommen</li>
<li>tonen van eigendommen</li>
<li>adverteren van eigendommen</li>
<li>onderhoud van eigendommen</li>
</ul>
<p>ERD van DreamHome met de belangrijkste entiteiten voor elk business process ingekleurd
<img src="http://puu.sh/ppYcV/1bf0a2bdd5.PNG" alt="alt text" title="ERD"></p>
<p>We kiezen een business process:<br>
<strong>verkoop van eigendommen</strong></p>
<p><img src="http://puu.sh/ppYiF/031bea87e3.PNG" alt="alt text" title="business processen"></p>
<h5><a id="STAP_2_bepaal_de_granulariteit_2240"></a>STAP 2: bepaal de granulariteit</h5>
<p>keuze: PropertySale - verkoop van elke eigendom<br>
Nu kunnen we dimensies kiezen:</p>
<ul>
<li>Branch, Staff, ClientBuyer, PropertyForSale, Promotion</li>
<li>extra kern dimensie steeds aanwezig in een DM is tijd</li>
</ul>
<h5><a id="STAP_3_kies_de_dimensies_2246"></a>STAP 3: kies de dimensies</h5>
<p><img src="http://puu.sh/ppYoJ/57b1466499.PNG" alt="alt text"></p>
<h4><a id="STAP_4_identificeer_feiten_2249"></a>STAP 4: identificeer feiten</h4>
<p>PropertySale:</p>
<ul>
<li>offerPrice</li>
<li>sellingprice</li>
<li>saleCommission</li>
<li>saleRevenue</li>
</ul>

</body></html>
